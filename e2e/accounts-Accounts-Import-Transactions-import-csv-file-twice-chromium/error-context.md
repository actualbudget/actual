# Test info

- Name: Accounts >> Import Transactions >> import csv file twice
- Location: /__w/actual/actual/packages/desktop-client/e2e/accounts.test.ts:140:9

# Error details

```
Error: locator.click: Target page, context or browser has been closed
Call log:
  - waiting for getByRole('button', { name: 'Create a local account' })
    - locator resolved to <button data-rac="" tabindex="0" type="button" class="css-189odvl" data-focused="true" id="react-aria8905079882-«rp»">Create a local account</button>
  - attempting click action
    - waiting for element to be visible, enabled and stable
  - element was detached from the DOM, retrying

    at Navigation.createAccount (/__w/actual/actual/packages/desktop-client/e2e/page-models/navigation.ts:86:8)
    at /__w/actual/actual/packages/desktop-client/e2e/accounts.test.ts:111:21
```

# Page snapshot

```yaml
- button "Test Budget":
  - text: Test Budget
  - img
- button "Unpin sidebar":
  - img
- link "Budget":
  - /url: /budget
  - img
  - text: Budget
- link "Reports":
  - /url: /reports
  - img
  - text: Reports
- link "Schedules":
  - /url: /schedules
  - img
  - text: Schedules
- button "More":
  - img
  - text: More
- link "All accounts 43,108.00":
  - /url: /accounts
- link "On budget 20,918.00":
  - /url: /accounts/onbudget
- link "Bank of America 190.00":
  - /url: /accounts/fd76fcd6-00a2-4d88-ae15-500def61a7c2
- link "Ally Savings 7,653.00":
  - /url: /accounts/7bbd086c-892e-4c79-8cf2-761ed1a92e38
- link "Capital One Checking 5,265.00":
  - /url: /accounts/59ba81d2-e0d0-4c88-be0e-187c5fe98869
- link "HSBC 7,810.00":
  - /url: /accounts/8736f34e-6a76-4024-b17d-e220e43ccc49
- link "Off budget 22,190.00":
  - /url: /accounts/offbudget
- link "Vanguard 401k 2,945.00":
  - /url: /accounts/e0e8b29a-633b-4395-ac8d-a7c3fc438f30
- link "Mortgage -312,500.00":
  - /url: /accounts/6c7057f7-d724-49ee-9be1-f93efeea577b
- link "House Asset 328,800.00":
  - /url: /accounts/fa5cd3fd-f3a6-4791-85bc-5a612f3140b4
- link "Roth IRA 2,945.00":
  - /url: /accounts/f4da56fe-231f-4b36-bc92-660dc8898021
- button "Add account":
  - img
  - text: Add account
- img
- img
- img
- button "Enable privacy mode":
  - img
- button "No server"
- button "Help":
  - img
  - text: Help
- button:
  - img
- button:
  - img
- text: Aug 2016 Sep Oct Nov Dec Jan 2017 Feb Mar Apr May Jun
- button:
  - img
- button "Collapse month summary":
  - img
- text: December
- button "View notes":
  - img
- button "Menu":
  - img
- text: "14,125.00 -864.00 -9,231.00 -4,030.00 Available funds Overspent in Nov Budgeted For next month To Budget: 0.00"
- button "Collapse month summary":
  - img
- text: January
- button "View notes":
  - img
- button "Menu":
  - img
- text: "4,445.00 -1,404.00 -3,030.00 -11.00 Available funds Overspent in Dec Budgeted For next month To Budget: 0.00"
- button "Collapse month summary":
  - img
- text: February
- button "View notes":
  - img
- button "Menu":
  - img
- text: "11.00 -60.00 --0.00 -0.00 Available funds Overspent in Jan Budgeted For next month Overbudgeted: -49.00"
- button "Expand":
  - img
- text: Category
- button "Menu":
  - img
- text: Budgeted 3,030.00 Spent -135.00 Balance 20,907.00
- img
- text: Usual Expenses 1,505.00 -135.00 19,382.00 Food
- button:
  - img
- text: 400.00 -45.00 1,155.00 Restaurants
- button:
  - img
- text: 300.00 0.00 900.00 Entertainment
- button:
  - img
- text: 100.00 0.00 300.00 Clothing
- button:
  - img
- text: 30.00 -90.00 -60.00 General
- button:
  - img
- text: 500.00 0.00 1,500.00 Gift
- button:
  - img
- text: 75.00 0.00 225.00 Medical
- button:
  - img
- text: 100.00 0.00 300.00 Savings
- button:
  - img
- text: 0.00 0.00 15,062.00
- img
- text: Bills 1,525.00 0.00 1,525.00 Cell
- button:
  - img
- text: 75.00 0.00 75.00 Internet
- button:
  - img
- text: 60.00 0.00 60.00 Mortgage
- button:
  - img
- text: 1,200.00 0.00 1,200.00 Water
- button:
  - img
- text: 90.00 0.00 90.00 Power
- button:
  - img
- text: 100.00 0.00 100.00
- button "Add group"
- text: Received
- img
- text: Income 415.00 Starting Balances 0.00 Misc 0.00 Income 415.00
```

# Test source

```ts
   1 | import { type Page } from '@playwright/test';
   2 |
   3 | import { AccountPage } from './account-page';
   4 | import { PayeesPage } from './payees-page';
   5 | import { ReportsPage } from './reports-page';
   6 | import { RulesPage } from './rules-page';
   7 | import { SchedulesPage } from './schedules-page';
   8 | import { SettingsPage } from './settings-page';
   9 |
   10 | type AccountEntry = {
   11 |   name: string;
   12 |   balance: number;
   13 |   offBudget: boolean;
   14 | };
   15 |
   16 | export class Navigation {
   17 |   readonly page: Page;
   18 |
   19 |   constructor(page: Page) {
   20 |     this.page = page;
   21 |   }
   22 |
   23 |   async goToAccountPage(accountName: string) {
   24 |     await this.page
   25 |       .getByRole('link', { name: new RegExp(`^${accountName}`) })
   26 |       .click();
   27 |
   28 |     return new AccountPage(this.page);
   29 |   }
   30 |
   31 |   async goToReportsPage() {
   32 |     await this.page.getByRole('link', { name: 'Reports' }).click();
   33 |
   34 |     return new ReportsPage(this.page);
   35 |   }
   36 |
   37 |   async goToSchedulesPage() {
   38 |     await this.page.getByRole('link', { name: 'Schedules' }).click();
   39 |
   40 |     return new SchedulesPage(this.page);
   41 |   }
   42 |
   43 |   async goToRulesPage() {
   44 |     const rulesLink = this.page.getByRole('link', { name: 'Rules' });
   45 |
   46 |     // Expand the "more" menu only if it is not already expanded
   47 |     if (!(await rulesLink.isVisible())) {
   48 |       await this.page.getByRole('button', { name: 'More' }).click();
   49 |     }
   50 |
   51 |     await rulesLink.click();
   52 |
   53 |     return new RulesPage(this.page);
   54 |   }
   55 |
   56 |   async goToPayeesPage() {
   57 |     const payeesLink = this.page.getByRole('link', { name: 'Payees' });
   58 |
   59 |     // Expand the "More" menu only if the Payees link is not visible
   60 |     if (!(await payeesLink.isVisible())) {
   61 |       await this.page.getByRole('button', { name: 'More' }).click();
   62 |     }
   63 |
   64 |     await payeesLink.click();
   65 |
   66 |     return new PayeesPage(this.page);
   67 |   }
   68 |
   69 |   async goToSettingsPage() {
   70 |     const settingsLink = this.page.getByRole('link', { name: 'Settings' });
   71 |
   72 |     // Expand the "more" menu only if it is not already expanded
   73 |     if (!(await settingsLink.isVisible())) {
   74 |       await this.page.getByRole('button', { name: 'More' }).click();
   75 |     }
   76 |
   77 |     await settingsLink.click();
   78 |
   79 |     return new SettingsPage(this.page);
   80 |   }
   81 |
   82 |   async createAccount(data: AccountEntry) {
   83 |     await this.page.getByRole('button', { name: 'Add account' }).click();
   84 |     await this.page
   85 |       .getByRole('button', { name: 'Create a local account' })
>  86 |       .click();
      |        ^ Error: locator.click: Target page, context or browser has been closed
   87 |
   88 |     // Fill the form
   89 |     await this.page.getByLabel('Name:').fill(data.name);
   90 |     await this.page.getByLabel('Balance:').fill(String(data.balance));
   91 |
   92 |     if (data.offBudget) {
   93 |       await this.page.getByLabel('Off budget').click();
   94 |     }
   95 |
   96 |     await this.page
   97 |       .getByRole('button', { name: 'Create', exact: true })
   98 |       .click();
   99 |     return new AccountPage(this.page);
  100 |   }
  101 |
  102 |   async clickOnNoServer() {
  103 |     await this.page.getByRole('button', { name: 'No server' }).click();
  104 |   }
  105 | }
  106 |
```