import{j as e,r as g,a5 as j,cp as H,T as b,t as x,dS as z,V as y,aa as L,dT as E,dU as Z,dV as w,dW as O,a9 as R,dH as U,bV as X,dX as _,dY as P,aO as G,aI as q,s as J,ap as I,z as S,M as K,dh as C,dZ as Q,aY as v,ae as ee,aW as te,aX as se,d_ as A,d$ as D,e0 as ne,dm as B,v as M,Z as ae,e1 as le,e2 as re,e3 as ie,n as oe}from"./index.QBmZrK2W.js";const V=t=>e.jsx("svg",{...t,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",style:{color:"inherit",...t.style},children:e.jsx("path",{d:"m12 12 8-8V0H0v4l8 8v8l4-4v-4z",fill:"currentColor"})}),ue=g.forwardRef((t,n)=>e.jsx(j,{ref:n,variant:"bare","aria-label":"Menu",...t,children:e.jsx(H,{width:15,height:15,style:{transform:"rotateZ(90deg)"}})}));ue.displayName="MenuButton";function de({conditionsOp:t,onChange:n,conditions:s}){return s.length>1?e.jsxs(b,{style:{color:x.pageText,marginTop:11,marginRight:5},children:[e.jsx(z,{style:{display:"inline-flex"},fields:[["and","all"],["or","any"]],value:t,onChange:n}),"of:"]}):e.jsx(y,{})}function ce({onPress:t}){return e.jsx(j,{variant:"bare",onPress:t,style:{minWidth:20},children:e.jsx(V,{width:15,height:15,style:{width:15,height:15,flexShrink:0}})})}function fe({onPress:t}){return e.jsxs(j,{variant:"bare",onPress:t,children:[e.jsx(V,{style:{width:12,height:12,marginRight:5,flexShrink:0}})," ","Filter"]})}function F({op:t,isSelected:n,style:s,onPress:r}){return e.jsx(j,{variant:"bare",style:s,className:L({backgroundColor:x.pillBackground,marginBottom:5,...n&&{color:x.buttonNormalSelectedText,"&,:hover,:active":{backgroundColor:x.buttonNormalSelectedBackground,color:x.buttonNormalSelectedText}}}),onPress:r,children:E(t)})}function N({field:t,options:n,value:s}){if(t==="date"&&typeof s=="string"){if(s.length===7)return"month";if(s.length===4)return"year"}if(t==="amount"){if(n&&n.inflow)return"amount-inflow";if(n&&n.outflow)return"amount-outflow"}return t}function pe(t,n){let s;switch(t){case"amount":switch(n){case"amount-inflow":s={inflow:!0};break;case"amount-outflow":s={outflow:!0};break}break;case"date":switch(n){case"month":s={month:!0};break;case"year":s={year:!0};break}break}return s}function $(t,n){switch(n.type){case"set-op":{const s=w.get(t.field);let r=t.value;return(s==="id"||s==="string")&&(n.op==="contains"||n.op==="matches"||n.op==="is"||n.op==="doesNotContain"||n.op==="isNot"||n.op==="hasTags")&&(r=null),{...t,op:n.op,value:r}}case"set-value":{const{value:s}=Z(n.value,{type:w.get(t.field)});return{...t,value:s}}default:throw new Error(`Unhandled action type: ${n.type}`)}}let T=!1;const he=["date","account","payee","notes","category","amount","cleared","reconciled","saved"].map(t=>[t,O(t)]);function W({field:t,initialSubfield:n=t,op:s,value:r,dispatch:u,onApply:f}){const{t:i}=R(),[p,d]=g.useState(n),c=g.useRef(),m=g.useRef(null);g.useEffect(()=>{m.current!==s&&c.current&&c.current.focus(),m.current=s},[s]);const a=w.get(t);let o=P(t).filter(l=>l!=="isbetween");return(p==="month"||p==="year")&&(o=["is"]),e.jsxs(Q,{children:[e.jsx(y,{style:{marginBottom:10},children:e.jsxs(v,{direction:"row",align:"flex-start",children:[t==="amount"||t==="date"?e.jsx(ee,{options:t==="amount"?[["amount",i("Amount")],["amount-inflow",i("Amount (inflow)")],["amount-outflow",i("Amount (outflow)")]]:t==="date"?[["date",i("Date")],["month",i("Month")],["year",i("Year")]]:null,value:p,onChange:l=>{d(l),(l==="month"||l==="year")&&u({type:"set-op",op:"is"})}}):C(O(t)),e.jsx(y,{style:{flex:1}})]})}),e.jsx(y,{style:{color:x.pageTextLight,marginBottom:10},children:t==="saved"&&i("Existing filters will be cleared")}),e.jsx(v,{direction:"row",align:"flex-start",spacing:1,style:{flexWrap:"wrap"},children:a==="boolean"?e.jsxs(e.Fragment,{children:[e.jsx(F,{op:"true",isSelected:r===!0,onPress:()=>{u({type:"set-op",op:"is"}),u({type:"set-value",value:!0})}},"true"),e.jsx(F,{op:"false",isSelected:r===!1,onPress:()=>{u({type:"set-op",op:"is"}),u({type:"set-value",value:!1})}},"false")]}):e.jsxs(e.Fragment,{children:[e.jsx(v,{direction:"row",align:"flex-start",spacing:1,style:{flexWrap:"wrap"},children:o.slice(0,3).map(l=>e.jsx(F,{op:l,isSelected:l===s,onPress:()=>u({type:"set-op",op:l})},l))}),e.jsx(v,{direction:"row",align:"flex-start",spacing:1,style:{flexWrap:"wrap"},children:o.slice(3,o.length).map(l=>e.jsx(F,{op:l,isSelected:l===s,onPress:()=>u({type:"set-op",op:l})},l))})]})}),e.jsxs(te,{onSubmit:l=>{l.preventDefault(),f({field:t,op:s,value:r,options:pe(t,p)})},children:[a!=="boolean"&&e.jsx(se,{inputRef:c,field:t,subfield:p,type:a==="id"&&(s==="contains"||s==="matches"||s==="doesNotContain"||s==="hasTags")?"string":a,value:r,multi:s==="oneOf"||s==="notOneOf",style:{marginTop:10},onChange:l=>{u({type:"set-value",value:l})}}),e.jsxs(v,{direction:"row",justify:"flex-end",align:"center",style:{marginTop:15},children:[e.jsx(y,{style:{flex:1}}),e.jsx(j,{variant:"primary",type:"submit",children:e.jsx(I,{children:"Apply"})})]})]})]})}function me({onApply:t,compact:n,hover:s,exclude:r}){const{t:u}=R(),f=U(),i=g.useRef(null),p=X()||"MM/dd/yyyy",[d,c]=g.useReducer((a,o)=>{switch(o.type){case"select-field":return{...a,fieldsOpen:!0,condOpen:!1};case"configure":{const{field:l}=_(o.field),h=w.get(l),Y=P(l);return{...a,fieldsOpen:!1,condOpen:!0,field:o.field,op:Y[0],value:h==="boolean"?!0:null}}case"close":return{fieldsOpen:!1,condOpen:!1,value:null};default:return $(a,o)}},{fieldsOpen:!1,condOpen:!1,field:null,value:null});async function m(a){if(a=A({...a,type:w.get(a.field)}),a.type==="date"&&a.options){if(a.options.month){const h=D(a.value,ne(p),new Date);if(B(h))a.value=M(h,"yyyy-MM");else{alert(u("Invalid date format"));return}}else if(a.options.year){const h=D(a.value,"yyyy",new Date);if(B(h))a.value=M(h,"yyyy");else{alert(u("Invalid date format"));return}}}const{error:o}=a.field!=="saved"&&await ae("rule-validate",{conditions:[a],actions:[]}),l=f.find(h=>a.value===h.id);if(o&&o.conditionErrors.length>0){const h=C(O(a.field));alert(h+": "+le(o.conditionErrors[0]))}else t(l||a),c({type:"close"})}return G("f",()=>c({type:"select-field"}),{scopes:["app"]}),e.jsxs(y,{children:[e.jsx(y,{ref:i,children:e.jsx(q,{style:{...J.tooltip,lineHeight:1.5,padding:"6px 10px"},content:e.jsx(b,{children:e.jsx(I,{children:"Filters"})}),placement:"bottom start",triggerProps:{isDisabled:!s},children:n?e.jsx(ce,{onPress:()=>c({type:"select-field"})}):e.jsx(fe,{onPress:()=>c({type:"select-field"})})})}),e.jsx(S,{triggerRef:i,placement:"bottom start",isOpen:d.fieldsOpen,onOpenChange:()=>c({type:"close"}),"data-testid":"filters-select-tooltip",children:e.jsx(K,{onMenuSelect:a=>{c({type:"configure",field:a})},items:he.filter(a=>r?!r.includes(a[0]):!0).sort().map(([a,o])=>({name:a,text:C(o)}))})}),e.jsx(S,{triggerRef:i,placement:"bottom start",isOpen:d.condOpen,onOpenChange:()=>{c({type:"close"})},shouldCloseOnInteractOutside:a=>a.dataset.pikaYear?(T=!0,!1):T?(T=!1,!1):!0,style:{width:275,padding:15,color:x.menuItemText},"data-testid":"filters-menu-tooltip",children:d.field&&e.jsx(W,{field:d.field,op:d.op,value:d.value,dispatch:c,onApply:m})})]})}function xe({field:t,op:n,value:s,options:r,onSave:u,onClose:f}){const[i,p]=g.useReducer((d,c)=>{switch(c.type){case"close":return f(),d;default:return $(d,c)}},{field:t,op:n,value:s,options:r});return e.jsx(W,{field:i.field,initialSubfield:N({field:t,options:r,value:s}),op:i.op,value:i.value,options:i.options,dispatch:p,onApply:d=>{d=A({...d,type:w.get(d.field)}),u(d),f()}})}let k=!1;function ge({field:t,customName:n,op:s,value:r,options:u,style:f,onChange:i,onDelete:p}){const{t:d}=R(),[c,m]=g.useState(!1),a=g.useRef(null),o=N({field:t,value:r});return e.jsxs(y,{style:{backgroundColor:x.pillBackground,borderRadius:4,flexDirection:"row",alignItems:"center",marginRight:10,marginTop:10,...f},children:[e.jsx(j,{ref:a,variant:"bare",isDisabled:n!=null,onPress:()=>m(!0),style:{maxWidth:"calc(100% - 26px)",whiteSpace:"nowrap",display:"block"},children:e.jsx("div",{style:{paddingBlock:1,paddingLeft:5,paddingRight:2,overflow:"hidden",textOverflow:"ellipsis"},children:n?e.jsx(b,{style:{color:x.pageTextPositive},children:n}):e.jsxs(e.Fragment,{children:[e.jsx(b,{style:{color:x.pageTextPositive},children:O(o,u)})," ",e.jsx(b,{children:E(s,null)})," ",e.jsx(re,{value:r,field:o,inline:!0,valueIsRaw:s==="contains"||s==="matches"||s==="doesNotContain"||s==="hasTags"})]})})}),e.jsx(j,{variant:"bare",onPress:p,"aria-label":d("Delete filter"),children:e.jsx(ie,{style:{width:8,height:8,margin:4}})}),e.jsx(S,{triggerRef:a,placement:"bottom start",isOpen:c,onOpenChange:()=>m(!1),shouldCloseOnInteractOutside:l=>l instanceof HTMLElement&&l.dataset.pikaYear?(k=!0,!1):k?(k=!1,!1):!0,style:{width:275,padding:15,color:x.menuItemText},"data-testid":"filters-menu-tooltip",children:e.jsx(xe,{field:t,op:s,value:o==="amount"&&typeof r=="number"?oe(r):r,options:u,onSave:i,onClose:()=>m(!1)})})]})}function je({conditions:t,onUpdate:n,onDelete:s,conditionsOp:r,onConditionsOpChange:u}){return e.jsxs(y,{style:{flexDirection:"row",alignItems:"flex-start",flexWrap:"wrap"},children:[e.jsx(de,{conditionsOp:r,onChange:u,conditions:t}),t.map((f,i)=>e.jsx(ge,{customName:f.customName,field:f.field,op:f.op,value:f.value,options:f.options,onChange:p=>n(f,p),onDelete:()=>s(f)},i))]})}export{je as A,me as F,ue as M};
//# sourceMappingURL=AppliedFilters.17tc5E9n.chunk.js.map
