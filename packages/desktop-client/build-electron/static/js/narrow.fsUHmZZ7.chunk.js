import{j as e,r as c,V as r,t as x,y as et,b1 as re,al as we,am as ke,a5 as R,b5 as tt,b6 as te,b7 as Re,aP as Me,b8 as K,E as $e,b9 as L,ba as G,bb as M,aS as Pe,bc as J,aq as O,bd as E,T as z,D as We,s as D,af as De,be as Le,bf as Z,bg as nt,bh as st,bi as it,ac as at,aH as q,aj as ne,bj as Ge,au as Ee,bk as ot,bl as N,bm as F,n as rt,x as ve,bn as He,bo as lt,bp as dt,aa as Ne,a$ as Oe,bq as ct,a4 as ut,br as Ve,bs as xt,bt as gt,bu as mt,bv as ht,bw as ft,Z as ee,bx as Ie,by as bt,bz as Ae,bA as pt,bB as yt,bC as Se,O as jt,bD as St,bE as Ct,bF as wt,bG as kt,av as vt,bH as Te,bI as _e,bJ as Qe,bK as Ue,bL as qe,bM as Tt,bN as Bt,bO as Ye,bP as Ze,bQ as Pt,bR as It,bS as At,an as zt,bT as Ft,bU as Rt,bV as Mt,bW as $t,bX as Wt,bY as Dt,bZ as Lt,b_ as Gt,b$ as Et,c0 as Ht,c1 as Nt,c2 as Ot,c3 as Vt,c4 as _t,c5 as Qt,c6 as Ut,c7 as qt,c8 as Yt,ah as Zt,c9 as Jt}from"./index.QBmZrK2W.js";import{u as Kt}from"./usePreviewTransactions.wSNV9Sg-.chunk.js";const Xt=t=>e.jsx("svg",{...t,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",style:{color:"inherit",...t.style},children:e.jsx("path",{d:"M10 7H2v6h8v5l8-8-8-8v5z",fill:"currentColor"})}),en=t=>e.jsx("svg",{...t,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",style:{color:"inherit",...t.style},children:e.jsx("path",{d:"m3.828 9 6.071-6.071-1.414-1.414L0 10l.707.707 7.778 7.778 1.414-1.414L3.828 11H20V9H3.828z",fill:"currentColor"})});function tn({onSync:t,children:n}){const[i,a]=c.useState(!1);async function u(){a(!0),await t(),a(!1)}return e.jsx(e.Fragment,{children:n({refreshing:i,onRefresh:u})})}const Be=c.forwardRef(({children:t,...n},i)=>e.jsx(r,{...n,ref:i,style:{marginTop:15,marginLeft:5,marginRight:5,borderRadius:6,backgroundColor:x.cardBackground,borderColor:x.cardBorder,boxShadow:"0 1px 2px #9594A8",...n.style},children:e.jsx(r,{style:{borderRadius:6,overflow:"hidden"},children:t})}));Be.displayName="Card";const nn=50,be=({children:t,style:n,...i})=>e.jsx(r,{style:{height:nn,borderBottomWidth:1,borderColor:x.tableBorder,flexDirection:"row",alignItems:"center",paddingLeft:5,paddingRight:5,zIndex:1,...n},...i,children:t}),Ce={borderRadius:16,color:x.pillText,backgroundColor:x.pillBackgroundLight};function V({show3Cols:t,isSidebar:n=!1,offset:i=0}={}){return n?t?`${35+i}vw`:`${45+i}vw`:t?`${20+i}vw`:`${25+i}vw`}function sn({toBudget:t,onPress:n,show3Cols:i}){const a=Z(t),u=K(),g=V({show3Cols:i,isSidebar:!0});return e.jsx(r,{style:{flexDirection:"row",justifyContent:"flex-start",alignItems:"center",width:g},children:e.jsxs(R,{variant:"bare",onPress:n,children:[e.jsxs(r,{children:[e.jsx(J,{title:a<0?"Overbudgeted":"To Budget",style:{...a<0?D.smallText:{},color:x.formInputText,flexShrink:0,textAlign:"left"}}),e.jsx(G,{binding:t,type:"financial",children:({type:d,value:h})=>e.jsx(r,{children:e.jsx(O,{children:e.jsx(E,{as:z,minFontSizePx:6,maxFontSizePx:12,mode:"oneline",style:{fontSize:12,fontWeight:"700",color:a<0?x.errorText:x.formInputText},children:u(h,d)},h)})})})]}),e.jsx(te,{style:{flexShrink:0,color:x.mobileHeaderTextSubdued,marginLeft:5},width:14,height:14})]})})}function an({projected:t,onPress:n,show3Cols:i}){const a=t?M.totalBudgetedSaved:M.totalSaved,u=Z(a)||0,g=K(),d=u<0,h=V({show3Cols:i,isSidebar:!0});return e.jsx(r,{style:{flexDirection:"row",justifyContent:"flex-start",alignItems:"center",width:h},children:e.jsxs(R,{variant:"bare",onPress:n,children:[e.jsxs(r,{style:{alignItems:"flex-start"},children:[t?e.jsx(r,{children:e.jsx(E,{as:J,minFontSizePx:6,maxFontSizePx:12,mode:"oneline",title:"Projected Savings",style:{color:x.formInputText,textAlign:"left",fontSize:12}})}):e.jsx(J,{title:d?"Overspent":"Saved",style:{color:x.formInputText,textAlign:"left"}}),e.jsx(G,{binding:a,type:"financial",children:({type:b,value:f})=>e.jsx(r,{children:e.jsx(O,{children:e.jsx(E,{as:z,minFontSizePx:6,maxFontSizePx:12,mode:"oneline",style:{textAlign:"left",fontSize:12,fontWeight:"700",color:t?x.warningText:d?x.errorTextDark:x.formInputText},children:g(f,b)},f)})})})]}),e.jsx(te,{style:{flexShrink:0,color:x.mobileHeaderTextSubdued,marginLeft:5},width:14,height:14})]})})}function Je({name:t,binding:n,style:i,category:a,month:u,onBudgetAction:g,children:d,...h}){const b=V(),f=ne(),y=K(),{showUndoNotification:p}=Ge(),[o="rollover"]=q("budgetType"),T=`${o==="rollover"?"envelope":"tracking"}-budget-menu`,s=ct(a.id),v=()=>{f(F(T,{categoryId:a.id,month:u,onUpdateBudget:C=>{g(u,"budget-amount",{category:a.id,amount:C})},onCopyLastMonthAverage:()=>{g(u,"copy-single-last",{category:a.id}),p({message:`${a.name} budget has been set last to month’s budgeted amount.`})},onSetMonthsAverage:C=>{C!==3&&C!==6&&C!==12||(g(u,`set-single-${C}-avg`,{category:a.id}),p({message:`${a.name} budget has been set to ${C===12?"yearly":`${C} month`} average.`}))},onApplyBudgetTemplate:()=>{g(u,"apply-single-category-template",{category:a.id}),p({message:`${a.name} budget templates have been applied.`,pre:s})}}))};return e.jsx(G,{binding:n,type:"financial","aria-label":`Budgeted amount for ${a.name} category`,...h,children:({type:C,name:$,value:w})=>d?.({type:C,name:$,value:w,onPress:v})||e.jsx(R,{variant:"bare",style:{...Ce,maxWidth:b,...He(w)},onPress:v,"aria-label":`Open budget menu for ${a.name} category`,children:e.jsx(r,{children:e.jsx(O,{children:e.jsx(E,{as:z,minFontSizePx:6,maxFontSizePx:12,mode:"oneline",style:{maxWidth:b,textAlign:"right",fontSize:12},children:y(w,C)},w)})})})})}const on=c.memo(function({type:n,category:i,isHidden:a,goal:u,longGoal:g,budgeted:d,spent:h,balance:b,carryover:f,index:y,blank:p,style:o,month:S,onEdit:T,onBudgetAction:s,show3Cols:v,showBudgetedCol:C}){const $=p?0:1,w=at("goalTemplatesEnabled"),A=Z(u),_=w?A:null,[B="rollover"]=q("budgetType"),P=B==="rollover"?"envelope":"tracking",W=ne(),{showUndoNotification:U}=Ge(),{list:X}=Ee(),I=ot(X),Q=c.useCallback(m=>{s(S,"carryover",{category:i.id,flag:m}),W(N(`${P}-balance-menu`))},[P,i.id,W,S,s]),H=Z(n==="rollover"?L.catBalance(i.id):M.catBalance(i.id)),Y=Z(d),le=Z(b),de=Z(g)===1,pe=w?de?le:Y:null,ce=c.useCallback(()=>{W(F("transfer",{title:i.name,categoryId:i.id,month:S,amount:H,onSubmit:(m,k)=>{s(S,"transfer-category",{amount:m,from:i.id,to:k}),W(N(`${P}-balance-menu`)),U({message:`Transferred ${rt(m)} from ${i.name} to ${I[k].name}.`})},showToBeBudgeted:!0}))},[P,H,I,i.id,i.name,W,S,s,U]),se=c.useCallback(()=>{W(F("cover",{title:i.name,month:S,categoryId:i.id,onSubmit:m=>{s(S,"cover-overspending",{to:i.id,from:m}),W(N(`${P}-balance-menu`)),U({message:`Covered ${i.name} overspending from ${I[m].name}.`})}}))},[P,I,i.id,i.name,W,S,s,U]),ue=c.useCallback(()=>{W(F(`${P}-balance-menu`,{categoryId:i.id,month:S,onCarryover:Q,...B==="rollover"&&{onTransfer:ce,onCover:se}}))},[P,B,i.id,W,S,Q,se,ce]),xe=c.useRef(),ie=K(),ae=ve(),ye=c.useCallback(()=>{ae(`/categories/${i.id}?month=${S}`)},[i.id,S,ae]),ge=V({show3Cols:v,isSidebar:!0}),l=V({show3Cols:v}),j=e.jsxs(be,{style:{backgroundColor:"transparent",borderBottomWidth:0,borderTopWidth:y>0?1:0,opacity:a?.5:void 0,...o},"data-testid":"category-row",innerRef:xe,children:[e.jsx(r,{style:{flex:1,justifyContent:"center",alignItems:"flex-start"},children:e.jsx(R,{variant:"bare",style:{maxWidth:ge},onPress:()=>T?.(i.id),children:e.jsxs(r,{style:{flexDirection:"row",alignItems:"center",justifyContent:"flex-start"},children:[e.jsx(z,{style:{...D.lineClamp(2),width:ge,textAlign:"left",...D.smallText},"data-testid":"category-name",children:i.name}),e.jsx(te,{style:{flexShrink:0,color:x.tableTextSubdued},width:14,height:14})]})})}),e.jsxs(r,{style:{justifyContent:"center",alignItems:"center",flexDirection:"row",opacity:$},children:[e.jsx(r,{style:{...!v&&!C&&{display:"none"},width:l,justifyContent:"center",alignItems:"flex-end"},children:e.jsx(Je,{binding:d,type:"financial",category:i,month:S,onBudgetAction:s},`${v}|${C}`)}),e.jsx(r,{style:{...!v&&C&&{display:"none"},width:l,justifyContent:"center",alignItems:"flex-end"},children:e.jsx(G,{binding:h,type:"financial","aria-label":`Spent amount for ${i.name} category`,children:({type:m,value:k})=>e.jsx(R,{variant:"bare",style:{...Ce},onPress:ye,"aria-label":`Show transactions for ${i.name} category`,children:e.jsx(O,{children:e.jsx(E,{as:z,minFontSizePx:6,maxFontSizePx:12,mode:"oneline",style:{...He(k),maxWidth:l,textAlign:"right",fontSize:12},children:ie(k,m)},`${k}|${v}|${C}`)})})})}),e.jsx(r,{style:{width:l,justifyContent:"center",alignItems:"flex-end"},children:e.jsx(lt,{"aria-label":`Balance for ${i.name} category`,type:"financial",carryover:f,balance:b,goal:u,budgeted:d,longGoal:g,CarryoverIndicator:({style:m})=>e.jsx(r,{style:{position:"absolute",right:"-3px",top:"-5px",borderRadius:"50%",backgroundColor:m?.color??x.pillText},children:e.jsx(Xt,{width:11,height:11,style:{color:x.pillBackgroundLight}})}),children:({type:m,value:k})=>e.jsx(R,{variant:"bare",style:{...Ce,maxWidth:l},onPress:ue,"aria-label":`Open balance menu for ${i.name} category`,children:e.jsx(O,{children:e.jsx(E,{as:z,minFontSizePx:6,maxFontSizePx:12,mode:"oneline",style:{maxWidth:l,...dt(k,_,pe),textAlign:"right",fontSize:12},children:ie(k,m)},k)})})})})]})]});return e.jsx(r,{children:j})}),rn=c.memo(function({group:n,budgeted:i,spent:a,balance:u,editMode:g,onEdit:d,blank:h,show3Cols:b,showBudgetedCol:f,collapsed:y,onToggleCollapse:p}){const o=h?0:1,S=c.useRef(),T=K(),s=V({show3Cols:b,isSidebar:!0,offset:-3.5}),C={width:V({show3Cols:b}),fontSize:12,fontWeight:"500",paddingLeft:5,textAlign:"right"},$=e.jsxs(be,{style:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",backgroundColor:x.tableRowHeaderBackground,opacity:n.hidden?.5:void 0,paddingLeft:0},"data-testid":"category-group-row",innerRef:S,children:[e.jsxs(r,{style:{flex:1,flexDirection:"row",justifyContent:"flex-start",width:s},children:[e.jsx(R,{variant:"bare",className:Ne({flexShrink:0,color:x.pageTextSubdued,"&[data-pressed]":{backgroundColor:"transparent"}}),onPress:()=>p?.(n.id),children:e.jsx(Oe,{width:8,height:8,style:{flexShrink:0,transition:"transform .1s",transform:y?"rotate(-90deg)":""}})}),e.jsx(R,{variant:"bare",style:{maxWidth:s},onPress:()=>d?.(n.id),children:e.jsxs(r,{style:{flexDirection:"row",alignItems:"center",justifyContent:"flex-start"},children:[e.jsx(z,{style:{...D.lineClamp(2),width:s,textAlign:"left",...D.smallText,fontWeight:"500"},"data-testid":"category-group-name",children:n.name}),e.jsx(te,{style:{flexShrink:0,color:x.tableTextSubdued},width:14,height:14})]})})]}),e.jsxs(r,{style:{flexDirection:"row",justifyContent:"flex-end",alignItems:"center",opacity:o,paddingRight:5},children:[e.jsx(r,{style:{...!b&&!f&&{display:"none"}},children:e.jsx(G,{binding:i,type:"financial",children:({type:w,value:A})=>e.jsx(r,{children:e.jsx(O,{children:e.jsx(E,{as:z,minFontSizePx:6,maxFontSizePx:12,mode:"oneline",style:C,children:T(A,w)},A)})})})}),e.jsx(r,{style:{...!b&&f&&{display:"none"}},children:e.jsx(G,{binding:a,type:"financial",children:({type:w,value:A})=>e.jsx(r,{children:e.jsx(O,{children:e.jsx(E,{as:z,minFontSizePx:6,maxFontSizePx:12,mode:"oneline",style:C,children:T(A,w)},A)})})})}),e.jsx(G,{binding:u,type:"financial",children:({type:w,value:A})=>e.jsx(r,{children:e.jsx(O,{children:e.jsx(E,{as:z,minFontSizePx:6,maxFontSizePx:12,mode:"oneline",style:C,children:T(A,w)},A)})})})]})]});return $}),ln=c.memo(function({group:n,budgeted:i,balance:a,onEdit:u,collapsed:g,onToggleCollapse:d}){const h=c.useRef(),b=K(),f=V({isSidebar:!0,offset:-13.5}),y=V();return e.jsxs(be,{style:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",backgroundColor:x.tableRowHeaderBackground,opacity:n.hidden?.5:void 0,paddingLeft:0},innerRef:h,"data-testid":"category-group-row",children:[e.jsxs(r,{style:{flex:1,flexDirection:"row",justifyContent:"flex-start",width:f},children:[e.jsx(R,{variant:"bare",className:Ne({flexShrink:0,color:x.pageTextSubdued,"&[data-pressed]":{backgroundColor:"transparent"}}),onPress:()=>d?.(n.id),children:e.jsx(Oe,{width:8,height:8,style:{flexShrink:0,transition:"transform .1s",transform:g?"rotate(-90deg)":""}})}),e.jsx(R,{variant:"bare",style:{maxWidth:f},onPress:()=>u?.(n.id),children:e.jsxs(r,{style:{flexDirection:"row",alignItems:"center",justifyContent:"flex-start"},children:[e.jsx(z,{style:{...D.lineClamp(2),width:f,textAlign:"left",...D.smallText},"data-testid":"category-group-name",children:n.name}),e.jsx(te,{style:{flexShrink:0,color:x.tableTextSubdued},width:14,height:14})]})})]}),e.jsxs(r,{style:{flexDirection:"row",justifyContent:"flex-end",alignItems:"center",paddingRight:5},children:[i&&e.jsx(G,{binding:i,type:"financial",children:({type:p,value:o})=>e.jsx(r,{children:e.jsx(O,{children:e.jsx(E,{as:z,minFontSizePx:6,maxFontSizePx:12,mode:"oneline",style:{width:y,justifyContent:"center",alignItems:"flex-end",paddingLeft:5,textAlign:"right",fontSize:12,fontWeight:"500"},children:b(o,p)},o)})})}),e.jsx(G,{binding:a,type:"financial",children:({type:p,value:o})=>e.jsx(r,{children:e.jsx(O,{children:e.jsx(E,{as:z,minFontSizePx:6,maxFontSizePx:12,mode:"oneline",style:{width:y,justifyContent:"center",alignItems:"flex-end",paddingLeft:5,textAlign:"right",fontSize:12,fontWeight:"500"},children:b(o,p)},o)})})})]})]})}),dn=c.memo(function({index:n,category:i,budgeted:a,balance:u,month:g,style:d,onEdit:h,onBudgetAction:b}){const f=c.useRef(),y=K(),p=V({isSidebar:!0,offset:-10}),o=V();return e.jsxs(be,{style:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",backgroundColor:"transparent",borderBottomWidth:0,borderTopWidth:n>0?1:0,opacity:i.hidden?.5:void 0,...d},"data-testid":"category-row",innerRef:f,children:[e.jsx(r,{style:{flex:1,justifyContent:"center",alignItems:"flex-start",width:p},children:e.jsx(R,{variant:"bare",style:{maxWidth:p},onPress:()=>h?.(i.id),children:e.jsxs(r,{style:{flexDirection:"row",alignItems:"center",justifyContent:"flex-start"},children:[e.jsx(z,{style:{...D.lineClamp(2),width:p,textAlign:"left",...D.smallText},"data-testid":"category-name",children:i.name}),e.jsx(te,{style:{flexShrink:0,color:x.tableTextSubdued},width:14,height:14})]})})}),e.jsxs(r,{style:{flexDirection:"row",justifyContent:"flex-end",alignItems:"center"},children:[a&&e.jsx(r,{style:{width:o,justifyContent:"center",alignItems:"flex-end"},children:e.jsx(Je,{binding:a,type:"financial",category:i,month:g,onBudgetAction:b})}),e.jsx(G,{binding:u,type:"financial","aria-label":`Balance for ${i.name} category`,children:({type:S,value:T})=>e.jsx(r,{children:e.jsx(O,{children:e.jsx(E,{as:z,minFontSizePx:6,maxFontSizePx:12,mode:"oneline",style:{width:o,justifyContent:"center",alignItems:"flex-end",textAlign:"right",fontSize:12,paddingRight:5},children:y(T,S)},T)})})})]})]})}),cn=c.memo(function({type:n,group:i,editMode:a,onEditGroup:u,onEditCategory:g,month:d,onAddCategory:h,onBudgetAction:b,showBudgetedCol:f,show3Cols:y,showHiddenCategories:p,collapsed:o,onToggleCollapse:S}){function T(s){return s}return e.jsxs(Be,{style:{marginTop:4,marginBottom:4},children:[e.jsx(rn,{group:i,showBudgetedCol:f,budgeted:n==="report"?M.groupBudgeted(i.id):L.groupBudgeted(i.id),spent:n==="report"?M.groupSumAmount(i.id):L.groupSumAmount(i.id),balance:n==="report"?M.groupBalance(i.id):L.groupBalance(i.id),show3Cols:y,editMode:a,onAddCategory:h,onEdit:u,collapsed:o,onToggleCollapse:S}),i.categories.filter(s=>!o&&(!s.hidden||p)).map((s,v)=>e.jsx(on,{index:v,show3Cols:y,type:n,category:s,isHidden:!!s.hidden||i.hidden,goal:n==="report"?M.catGoal(s.id):L.catGoal(s.id),longGoal:n==="report"?M.catLongGoal(s.id):L.catLongGoal(s.id),budgeted:n==="report"?M.catBudgeted(s.id):L.catBudgeted(s.id),spent:n==="report"?M.catSumAmount(s.id):L.catSumAmount(s.id),balance:n==="report"?M.catBalance(s.id):L.catBalance(s.id),carryover:n==="report"?M.catCarryover(s.id):L.catCarryover(s.id),style:{backgroundColor:x.tableBackground},showBudgetedCol:f,editMode:a,onEdit:g,month:d,onBudgetAction:b},s.id))]})});function un({type:t,group:n,month:i,onAddCategory:a,showHiddenCategories:u,editMode:g,onEditGroup:d,onEditCategory:h,onBudgetAction:b,collapsed:f,onToggleCollapse:y}){const p=V();return e.jsxs(r,{children:[e.jsxs(r,{style:{flexDirection:"row",alignItems:"center",justifyContent:"flex-end",marginTop:50,marginBottom:5,marginRight:15},children:[t==="report"&&e.jsx(J,{title:"Budgeted",style:{width:p}}),e.jsx(J,{title:"Received",style:{width:p}})]}),e.jsxs(Be,{style:{marginTop:0},children:[e.jsx(ln,{group:n,budgeted:t==="report"?M.groupBudgeted(n.id):null,balance:t==="report"?M.groupSumAmount(n.id):L.groupSumAmount(n.id),onAddCategory:a,editMode:g,onEdit:d,collapsed:f,onToggleCollapse:y}),n.categories.filter(o=>!f&&(!o.hidden||u)).map((o,S)=>e.jsx(dn,{index:S,category:o,month:i,type:t,budgeted:t==="report"?M.catBudgeted(o.id):null,balance:t==="report"?M.catSumAmount(o.id):L.catSumAmount(o.id),style:{backgroundColor:x.tableBackground},editMode:g,onEdit:h,onBudgetAction:b},o.id))]})]})}function xn(){const t=Z(nt());return t===null||t<=0?null:e.jsx(r,{style:{padding:5,paddingBottom:2},children:e.jsxs(st,{variant:"button",type:"button",buttonVariant:"primary",to:"/accounts/uncategorized",style:{border:0,justifyContent:"flex-start",padding:"1.25em"},children:[t," uncategorized ",t===1?"transaction":"transactions",e.jsx(r,{style:{flex:1}}),e.jsx(Le,{width:"15",height:"15"})]})})}function gn({type:t,categoryGroups:n,onEditGroup:i,onEditCategory:a,editMode:u,gestures:g,month:d,onSaveCategory:h,onDeleteCategory:b,onAddCategory:f,onReorderCategory:y,onReorderGroup:p,onBudgetAction:o,showBudgetedCol:S,show3Cols:T,showHiddenCategories:s}){const v=it(B=>({incomeGroup:B.find(P=>P.is_income),expenseGroups:B.filter(P=>!P.is_income)})),{incomeGroup:C,expenseGroups:$}=v(n),[w=[],A]=re("budget.collapsed"),_=B=>{A(w.includes(B)?w.filter(P=>P!==B):[...w,B])};return e.jsxs(r,{"data-testid":"budget-groups",style:{flex:"1 0 auto",overflowY:"auto",paddingBottom:15},children:[$.filter(B=>!B.hidden||s).map(B=>e.jsx(cn,{type:t,group:B,showBudgetedCol:S,gestures:g,month:d,editMode:u,onEditGroup:i,onEditCategory:a,onSaveCategory:h,onDeleteCategory:b,onAddCategory:f,onReorderCategory:y,onReorderGroup:p,onBudgetAction:o,show3Cols:T,showHiddenCategories:s,collapsed:w.includes(B.id),onToggleCollapse:_},B.id)),C&&e.jsx(un,{type:t,group:C,month:d,onAddCategory:f,onSaveCategory:h,onDeleteCategory:b,showHiddenCategories:s,editMode:u,onEditGroup:i,onEditCategory:a,onBudgetAction:o,collapsed:w.includes(C.id),onToggleCollapse:_})]})}function mn({type:t,categoryGroups:n,month:i,monthBounds:a,onPrevMonth:u,onNextMonth:g,onSaveGroup:d,onDeleteGroup:h,onAddCategory:b,onSaveCategory:f,onDeleteCategory:y,onReorderCategory:p,onReorderGroup:o,onShowBudgetSummary:S,onBudgetAction:T,onRefresh:s,onEditGroup:v,onEditCategory:C,onOpenBudgetPageMenu:$,onOpenBudgetMonthMenu:w}){const{width:A}=et(),_=A>=360,[B=!1,P]=re("mobile.showSpentColumn");function W(){P(!B)}const[U=!1]=re("budget.showHiddenCategories");return e.jsxs(we,{padding:0,header:e.jsx(ke,{title:e.jsx(fn,{month:i,monthBounds:a,onOpenMonthMenu:w,onPrevMonth:u,onNextMonth:g}),leftContent:e.jsxs(R,{variant:"bare",style:{margin:10},onPress:$,"aria-label":"Budget page menu",children:[e.jsx(tt,{style:{color:x.mobileHeaderText},width:"20",height:"20"}),e.jsx(te,{style:{flexShrink:0,color:x.mobileHeaderTextSubdued},width:"14",height:"14"})]})}),children:[e.jsx(hn,{type:t,month:i,show3Cols:_,showSpentColumn:B,toggleSpentColumn:W,onShowBudgetSummary:S}),e.jsx(Re,{onRefresh:s,children:e.jsxs(r,{"data-testid":"budget-table",style:{backgroundColor:x.pageBackground,paddingBottom:Me},children:[e.jsx(xn,{}),e.jsx(gn,{type:t,categoryGroups:n,showBudgetedCol:!B,show3Cols:_,showHiddenCategories:U,month:i,onEditGroup:v,onEditCategory:C,onSaveCategory:f,onDeleteCategory:y,onAddCategory:b,onSaveGroup:d,onDeleteGroup:h,onReorderCategory:p,onReorderGroup:o,onBudgetAction:T})]})})]})}function hn({show3Cols:t,type:n,month:i,onShowBudgetSummary:a,showSpentColumn:u,toggleSpentColumn:g}){const d=K(),h={padding:0,backgroundColor:"transparent",borderRadius:"unset"},b=V({show3Cols:t,isSidebar:!0}),f=V({show3Cols:t}),y={color:x.formInputText,textAlign:"right",fontSize:12,fontWeight:"500"};return e.jsxs(r,{"data-testid":"budget-table-header",style:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",flexShrink:0,padding:"10px 15px",paddingLeft:10,backgroundColor:x.tableRowHeaderBackground,borderBottomWidth:1,borderColor:x.tableBorder},children:[e.jsx(r,{style:{width:b,flexDirection:"row",justifyContent:"flex-start",alignItems:"center"},children:n==="report"?e.jsx(an,{projected:i>=$e(),onPress:a,show3Cols:t}):e.jsx(sn,{toBudget:L.toBudget,onPress:a,show3Cols:t})}),e.jsxs(r,{style:{flexDirection:"row",justifyContent:"flex-end",alignItems:"center"},children:[(t||!u)&&e.jsx(G,{binding:n==="report"?M.totalBudgetedExpense:L.totalBudgeted,type:"financial",children:({type:p,value:o})=>e.jsx(R,{variant:"bare",isDisabled:t,onPress:g,style:{...h,width:f},children:e.jsxs(r,{style:{flex:1,alignItems:"flex-end"},children:[e.jsxs(r,{style:{flexDirection:"row",alignItems:"center"},children:[!t&&e.jsx(Pe,{width:12,height:12,style:{flexShrink:0,color:x.pageTextSubdued,marginRight:5}}),e.jsx(J,{title:"Budgeted",style:{color:x.formInputText,paddingRight:4}})]}),e.jsx(r,{children:e.jsx(O,{children:e.jsx(E,{as:z,minFontSizePx:6,maxFontSizePx:12,mode:"oneline",style:{...y,paddingRight:4},children:d(n==="report"?o:-o,p)},o)})})]})})}),(t||u)&&e.jsx(G,{binding:n==="report"?M.totalSpent:L.totalSpent,type:"financial",children:({type:p,value:o})=>e.jsx(R,{variant:"bare",isDisabled:t,onPress:g,style:{...h,width:f},children:e.jsxs(r,{style:{flex:1,alignItems:"flex-end"},children:[e.jsxs(r,{style:{flexDirection:"row",alignItems:"center"},children:[!t&&e.jsx(Pe,{width:12,height:12,style:{flexShrink:0,color:x.pageTextSubdued,marginRight:5}}),e.jsx(J,{title:"Spent",style:{color:x.formInputText,paddingRight:4}})]}),e.jsx(r,{children:e.jsx(O,{children:e.jsx(E,{as:z,minFontSizePx:6,maxFontSizePx:12,mode:"oneline",style:{...y,paddingRight:4},children:d(o,p)},o)})})]})})}),e.jsx(G,{binding:n==="report"?M.totalLeftover:L.totalBalance,type:"financial",children:({type:p,value:o})=>e.jsx(r,{style:{width:f},children:e.jsxs(r,{style:{flex:1,alignItems:"flex-end"},children:[e.jsx(J,{title:"Balance",style:{color:x.formInputText}}),e.jsx(r,{children:e.jsx(O,{children:e.jsx(E,{as:z,minFontSizePx:6,maxFontSizePx:12,mode:"oneline",style:{...y},children:d(o,p)},o)})})]})})})]})]})}function fn({month:t,monthBounds:n,onOpenMonthMenu:i,onPrevMonth:a,onNextMonth:u}){const g=t>n.start,d=t<We(n.end,1),h={padding:10,margin:2};return e.jsxs(r,{style:{flex:1,justifyContent:"center",alignItems:"center",flexDirection:"row"},children:[e.jsx(R,{"aria-label":"Previous month",variant:"bare",onPress:()=>{g&&a()},style:{...h,opacity:g?1:.6},children:e.jsx(en,{width:"15",height:"15",style:{margin:-5}})}),e.jsx(R,{variant:"bare",style:{textAlign:"center",fontSize:16,fontWeight:500,margin:"0 5px"},onPress:()=>{i?.(t)},"data-month":t,children:e.jsx(z,{style:D.underlinedText,children:De(t,"MMMM ‘yy")})}),e.jsx(R,{"aria-label":"Next month",variant:"bare",onPress:()=>{d&&u()},style:{...h,opacity:d?1:.6},children:e.jsx(Le,{width:"15",height:"15",style:{margin:-5}})})]})}function bn(t){return["rollover","report"].includes(t)}function Pn(){const{list:t,grouped:n}=Ee(),[i]=q("budgetType"),a=bn(i)?i:"rollover",u=ut(),g=$e(),[d=g,h]=re("budget.startMonth"),[b,f]=c.useState({start:d,end:d}),[y,p]=c.useState(!1),[o]=q("numberFormat"),S=o||"comma-dot",[T]=q("hideFraction"),s=ne();c.useEffect(()=>{async function l(){const{start:m,end:k}=await ee("get-budget-bounds");f({start:m,end:k}),await Se(a,u,d),p(!0)}l();const j=Ve("sync-event",({type:m,tables:k})=>{m==="success"&&(k.includes("categories")||k.includes("category_mapping")||k.includes("category_groups"))&&s(xt())});return()=>j()},[a,d,s,u]);const v=c.useCallback(async(l,j,m)=>{s(gt(l,j,m))},[s]),C=c.useCallback(()=>{s(a==="report"?F("tracking-budget-summary",{month:d}):F("envelope-budget-summary",{month:d,onBudgetAction:v}))},[a,s,v,d]),$=c.useCallback(()=>{s(F("new-category-group",{onValidate:l=>l?null:"Name is required.",onSubmit:async l=>{s(N("budget-page-menu")),s(mt(l))}}))},[s]),w=c.useCallback((l,j)=>{s(F("new-category",{onValidate:m=>m?null:"Name is required.",onSubmit:async m=>{s(N("category-group-menu")),s(ht(m,l,j,!1))}}))},[s]),A=c.useCallback(l=>{s(ft(l))},[s]),_=c.useCallback(async l=>{const j=n?.find(k=>k.id===l);if(!j)return;let m=!1;for(const k of j.categories??[])if(await ee("must-category-transfer",{id:k.id})){m=!0;break}m?s(F("confirm-category-delete",{group:l,onDelete:k=>{s(N("category-group-menu")),s(Ie(l,k))}})):(s(N("category-group-menu")),s(Ie(l)))},[n,s]),B=c.useCallback(l=>{const j=n.find(m=>m.id===l);A({...j,hidden:!j.hidden}),s(N("category-group-menu"))},[n,s,A]),P=c.useCallback(l=>{s(bt(l))},[s]),W=c.useCallback(async l=>{await ee("must-category-transfer",{id:l})?s(F("confirm-category-delete",{category:l,onDelete:m=>{l!==m&&(s(N("category-menu")),s(Ae(l,m)))}})):(s(N("category-menu")),s(Ae(l)))},[s]),U=c.useCallback(l=>{const j=t.find(m=>m.id===l);P({...j,hidden:!j.hidden}),s(N("category-menu"))},[t,s,P]),X=c.useCallback((l,{inGroup:j,aroundCategory:m})=>{let k,me;if(j)k=j;else if(m){const{id:Ke,position:Xe}=m;let he=Ke;const oe=n.find(fe=>fe.categories?.find(je=>je.id===he));if(Xe==="bottom"){const fe=oe?.categories?.findIndex(je=>je.id===he)??-1;he=oe?.categories&&fe<oe.categories.length-1?oe.categories[fe+1].id:null}k=oe?.id,me=he}s(pt(l,k,me))},[n,s]),I=c.useCallback((l,j,m)=>{if(m==="bottom"){const k=n.findIndex(me=>me.id===j);j=k<n.length-1?n[k+1].id:null}s(yt(l,j))},[n,s]),Q=c.useCallback(async()=>{const l=We(d,1);await Se(a,u,l),h(l),p(!0)},[a,h,u,d]),H=c.useCallback(async()=>{const l=jt(d,1);await Se(a,u,l),h(l),p(!0)},[a,h,u,d]),Y=c.useCallback(async(l,j)=>{await ee("notes-save",{id:l,note:j})},[]),le=c.useCallback(l=>{const j=n.find(m=>m.id===l);s(F("notes",{id:l,name:j.name,onSave:Y}))},[n,s,Y]),de=c.useCallback(l=>{const j=t.find(m=>m.id===l);s(F("notes",{id:l,name:j.name,onSave:Y}))},[t,s,Y]),pe=c.useCallback(l=>{const j=n.find(m=>m.id===l);s(F("category-group-menu",{groupId:j.id,onSave:A,onAddCategory:w,onEditNotes:le,onDelete:_,onToggleVisibility:B}))},[n,s,_,le,w,A,B]),ce=c.useCallback(l=>{const j=t.find(m=>m.id===l);s(F("category-menu",{categoryId:j.id,onSave:P,onEditNotes:de,onDelete:W,onToggleVisibility:U,onBudgetAction:v}))},[t,s,v,W,de,P,U]),[se,ue]=re("budget.showHiddenCategories"),xe=c.useCallback(()=>{ue(!se),s(N("budget-page-menu"))},[s,ue,se]),ie=c.useCallback(l=>{s(F("notes",{id:`budget-${l}`,name:De(l,"MMMM ‘yy"),onSave:Y}))},[s,Y]),ae=c.useCallback(()=>{s(F("budget-list"))},[s]),ye=c.useCallback(l=>{s(F(`${a==="report"?"tracking":"envelope"}-budget-month-menu`,{month:l,onBudgetAction:v,onEditNotes:ie}))},[a,s,v,ie]),ge=c.useCallback(()=>{s(F("budget-page-menu",{onAddCategoryGroup:$,onToggleHiddenCategories:xe,onSwitchBudgetFile:ae}))},[s,$,ae,xe]);return!n||!y?e.jsx(r,{style:{flex:1,backgroundColor:x.mobilePageBackground,alignItems:"center",justifyContent:"center",marginBottom:25},children:e.jsx(St,{width:25,height:25})}):e.jsx(Ct.Provider,{value:wt(d),children:e.jsx(tn,{onSync:async()=>{s(kt())},children:({onRefresh:l})=>e.jsx(mn,{categoryGroups:n,type:a,month:d,monthBounds:b,onShowBudgetSummary:C,onPrevMonth:Q,onNextMonth:H,onSaveGroup:A,onDeleteGroup:_,onAddCategory:w,onSaveCategory:P,onDeleteCategory:W,onReorderCategory:X,onReorderGroup:I,onBudgetAction:v,onRefresh:l,onEditGroup:pe,onEditCategory:ce,onOpenBudgetPageMenu:ge,onOpenBudgetMonthMenu:ye},`${S}${T}`)})})}function ze({name:t,amount:n,style:i={}}){return e.jsxs(r,{style:{flex:1,flexDirection:"row",marginTop:10,marginRight:10,color:x.pageTextLight,width:"100%",...i},children:[e.jsx(r,{style:{flex:1},children:e.jsx(z,{style:{...D.text,fontSize:14},"data-testid":"name",children:t})}),e.jsx(G,{binding:n,type:"financial",children:a=>e.jsx(Ze,{...a,style:{...D.text,fontSize:14}})})]})}function Fe({account:t,updated:n,connected:i,pending:a,failed:u,getBalanceQuery:g,onSelect:d}){return e.jsxs(R,{onPress:()=>d(t.id),style:{border:`1px solid ${x.pillBorder}`,borderRadius:6,boxShadow:`0 1px 1px ${x.mobileAccountShadow}`,marginTop:10},"data-testid":"account",children:[e.jsx(r,{style:{flex:1,margin:"10px 0"},children:e.jsxs(r,{style:{flexDirection:"row",alignItems:"center"},children:[t.bankId&&e.jsx(r,{style:{backgroundColor:a?x.sidebarItemBackgroundPending:u?x.sidebarItemBackgroundFailed:x.sidebarItemBackgroundPositive,marginRight:"8px",width:8,flexShrink:0,height:8,borderRadius:8,opacity:i?1:0}}),e.jsx(Pt,{style:{...D.text,fontSize:17,fontWeight:600,color:n?x.mobileAccountText:x.pillText,paddingRight:30},"data-testid":"account-name",children:t.name})]})}),e.jsx(G,{binding:g(t),type:"financial",children:h=>e.jsx(Ze,{...h,style:{fontSize:16,color:"inherit",...It(h.value)},"data-testid":"account-balance"})})]})}function pn(){return e.jsx(r,{style:{flex:1,padding:30},children:e.jsx(z,{style:D.text,children:"For Actual to be useful, you need to add an account. You can link an account to automatically download transactions, or manage it locally yourself."})})}function yn({accounts:t,updatedAccounts:n,getBalanceQuery:i,getOnBudgetBalance:a,getOffBudgetBalance:u,onAddAccount:g,onSelectAccount:d,onSync:h}){const b=qe(),f=Te(o=>o.account.accountsSyncing),y=t.filter(o=>o.offbudget===0),p=t.filter(o=>o.offbudget===1);return e.jsxs(we,{header:e.jsx(ke,{title:"Accounts",rightContent:e.jsx(R,{variant:"bare","aria-label":"Add account",style:{margin:10},onPress:g,children:e.jsx(Tt,{width:20,height:20})})}),padding:0,style:{paddingBottom:Me},children:[t.length===0&&e.jsx(pn,{}),e.jsx(Re,{onRefresh:h,children:e.jsxs(r,{style:{margin:10},children:[y.length>0&&e.jsx(ze,{name:"For Budget",amount:a()}),y.map(o=>e.jsx(Fe,{account:o,updated:n&&n.includes(o.id),connected:!!o.bank,pending:f.includes(o.id),failed:b&&b.has(o.id),getBalanceQuery:i,onSelect:d},o.id)),p.length>0&&e.jsx(ze,{name:"Off Budget",amount:u(),style:{marginTop:30}}),p.map(o=>e.jsx(Fe,{account:o,updated:n&&n.includes(o.id),connected:!!o.bank,pending:f.includes(o.id),failed:b&&b.has(o.id),getBalanceQuery:i,onSelect:d},o.id))]})})]})}function In(){const t=ne(),n=vt(),i=Te(y=>y.queries.updatedAccounts),[a]=q("numberFormat"),u=a||"comma-dot",[g]=q("hideFraction"),d=ve(),h=y=>{d(`/accounts/${y}`)},b=()=>{t(Bt("add-account"))},f=()=>{t(Ye())};return e.jsx(r,{style:{flex:1},children:e.jsx(yn,{accounts:n.filter(y=>!y.closed),updatedAccounts:i,getBalanceQuery:_e,getOnBudgetBalance:Qe,getOffBudgetBalance:Ue,onAddAccount:b,onSelectAccount:h,onSync:f},u+g)})}function jn({account:t,accountId:n,accountName:i}){const a=At(n);return e.jsx(we,{header:e.jsx(ke,{title:t?e.jsx(Sn,{account:t}):e.jsx(Cn,{accountName:i}),leftContent:e.jsx(zt,{}),rightContent:e.jsx(Ft,{accountId:n})}),padding:0,children:e.jsx(Rt,{transform:a,children:e.jsx(wn,{account:t,accountName:i,accountId:n})})})}function Sn({account:t}){const n=qe(),i=Te(o=>o.account.accountsSyncing),a=c.useMemo(()=>i.includes(t.id),[i,t.id]),u=c.useMemo(()=>n.has(t.id),[n,t.id]),g=ne(),d=o=>{g(Ut(o))},h=async(o,S)=>{await ee("notes-save",{id:o,note:S})},b=o=>{g(F("notes",{id:`account-${o}`,name:t.name,onSave:h}))},f=()=>{g(qt(t.id))},y=()=>{g(Yt(t.id))},p=()=>{g(F("account-menu",{accountId:t.id,onSave:d,onEditNotes:b,onCloseAccount:f,onReopenAccount:y}))};return e.jsxs(r,{style:{flexDirection:"row"},children:[t.bank&&e.jsx("div",{style:{margin:"auto",marginRight:5,width:8,height:8,borderRadius:8,flexShrink:0,backgroundColor:a?x.sidebarItemBackgroundPending:u?x.sidebarItemBackgroundFailed:x.sidebarItemBackgroundPositive,transition:"transform .3s"}}),e.jsx(R,{variant:"bare",onPress:p,children:e.jsx(z,{style:{fontSize:17,fontWeight:500,...D.underlinedText,...D.lineClamp(2)},children:`${t.closed?"Closed: ":""}${t.name}`})})]})}function Cn({accountName:t}){return e.jsx(r,{style:{flexDirection:"row"},children:e.jsx(z,{style:{...D.lineClamp(2)},children:t})})}function wn({account:t,accountId:n,accountName:i}){const[a,u]=c.useState(),[g,d]=c.useState(!1),[h,b]=c.useState(!0),[f,y]=c.useState([]),p=Kt(),o=c.useMemo(()=>g?f:p.concat(f),[g,p,f]),S=Mt()||"MM/dd/yyyy",T=ne(),s=ve(),v=()=>{T(Ye(n))},C=c.useCallback(()=>$t(n).options({splits:"none"}),[n]),$=c.useRef(),w=c.useCallback(I=>{$.current?.unsubscribe(),b(!0),$.current=Wt(I.options({splits:"none"}).select("*"),Q=>{y(Q),b(!1)},{pageCount:50})},[]),A=c.useCallback(()=>{const I=C();u(I),w(I)},[C,w]),_=()=>{$.current?.run()};c.useEffect(()=>{const I=Ve("sync-event",({type:Q,tables:H})=>{Q==="applied"&&((H.includes("transactions")||H.includes("category_mapping")||H.includes("payee_mapping"))&&_(),(H.includes("payees")||H.includes("payee_mapping"))&&T(Dt()))});return A(),T(Lt(n)),()=>I()},[n,T,A]);const B=Gt(c.useCallback(I=>{I===""&&a?w(a):I&&a&&w(Et(a,I,S)),d(I!=="")},[a,S,w]),150),P=I=>{B(I)},W=I=>{Qt(I.id)?T(F("scheduled-transaction-menu",{transactionId:I.id,onPost:async Q=>{const H=Q.split("/");await ee("schedule/post-transaction",{id:H[1]}),T(N("scheduled-transaction-menu"))},onSkip:async Q=>{const H=Q.split("/");await ee("schedule/skip-next-date",{id:H[1]}),T(N("scheduled-transaction-menu"))}})):s(`/transactions/${I.id}`)},U=()=>{$.current?.fetchNext()},X=c.useMemo(()=>kn(n,t),[n,t]);return e.jsx(Ht,{isLoading:h,transactions:o,balance:X.balance,balanceCleared:X.cleared,balanceUncleared:X.uncleared,onLoadMore:U,searchPlaceholder:`Search ${i}`,onSearch:P,onOpenTransaction:W,onRefresh:v})}function kn(t,n){switch(t){case"budgeted":return{balance:Qe()};case"offbudget":return{balance:Ue()};case"uncategorized":return{balance:_t()};default:return n?{balance:_e(n),cleared:Nt(n),uncleared:Ot(n)}:{balance:Vt()}}}function An(){const[t]=q("numberFormat"),n=t||"comma-dot",[i]=q("hideFraction"),{id:a}=Zt(),u=Jt(a);return e.jsx(jn,{account:u,accountId:a,accountName:u?u.name:vn(a)},n+i)}function vn(t){switch(t){case"budgeted":return"Budgeted Accounts";case"offbudget":return"Off Budget Accounts";case"uncategorized":return"Uncategorized";default:return"All Accounts"}}export{An as Account,In as Accounts,Pn as Budget};
//# sourceMappingURL=narrow.fsUHmZZ7.chunk.js.map
