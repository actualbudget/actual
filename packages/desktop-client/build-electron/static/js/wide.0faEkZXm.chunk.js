import{j as e,r as d,E as Tt,O as ct,_ as es,D as tt,ca as fn,V as x,af as ts,cb as ns,t as y,s as pe,cc as Bt,cd as pn,bE as At,bF as Rt,a9 as de,ac as nt,a5 as K,ce as Mt,z as ve,M as we,cf as It,cg as Ve,ch as Dt,ci as lt,aw as De,cj as dt,a$ as gn,T as se,ck as qt,ap as re,b1 as Pe,cl as mn,cm as ss,cn as as,aa as xn,co as os,cp as is,au as Pt,cq as Zt,cr as rs,cs as Kt,A as cs,ct as ls,aO as le,cu as ds,cv as us,cw as hs,cx as fs,cy as ps,cz as gs,cA as ms,cB as xs,cC as ys,cD as bs,cE as ws,cF as Ss,cG as js,cH as vs,cI as Cs,cJ as ks,cK as Ts,a4 as Bs,aj as Ue,x as yn,aH as He,cL as As,br as vt,Z as X,cM as Rs,bs as Ms,cN as Is,cO as Ds,cP as Ps,bC as Yt,bv as Es,by as Ls,bm as Ee,bz as Xt,bu as Fs,bw as Ns,bx as Jt,bt as en,bA as _s,bB as Hs,as as Os,aN as Et,cQ as Us,ae as Ws,cR as bn,cS as Gs,al as $s,cT as wn,cU as Qs,cV as zs,cW as Vs,ar as tn,bH as Qe,c5 as Te,cX as Sn,cY as jn,cZ as et,c_ as vn,c$ as qs,d0 as Je,d1 as Lt,d2 as nn,d3 as Ft,d4 as fe,d5 as Zs,d6 as ze,d7 as Nt,d8 as Ks,d9 as Cn,da as kn,L as _t,db as Ys,dc as Xs,dd as sn,de as Js,ax as Oe,v as ea,o as Tn,df as ta,dg as na,dh as sa,di as Ht,dj as aa,H as oa,dk as ia,n as ut,dl as ht,dm as ra,dn as ca,dp as la,aI as an,dq as da,dr as Bn,ds as ua,dt as ha,du as fa,dv as on,ay as pa,dw as An,dx as ga,dy as ma,dz as Rn,aW as xa,aY as ft,aZ as ya,a_ as ba,C as Ot,aJ as bt,dA as wa,dB as Sa,ba as ja,bP as va,bf as qe,q as ke,b8 as Ut,aq as Ca,dC as ka,bI as Ta,I as Mn,dD as Ba,dE as In,dF as Aa,bM as Ra,bD as Ma,dG as Ia,a6 as Da,ah as Pa,av as Ea,aG as La,bL as Fa,bV as Na,dH as _a,bS as Ha,bU as Oa,dI as Ua,W as je,bW as Wa,bX as Ga,dJ as $a,b$ as Qa,dK as Me,bk as Dn,dL as za,dM as Va,dN as qa,dO as Za,dP as rn,dQ as Ka,dR as Ya}from"./index.QBmZrK2W.js";import{u as Xa}from"./usePreviewTransactions.wSNV9Sg-.chunk.js";import{A as Ja,F as eo,M as cn}from"./AppliedFilters.17tc5E9n.chunk.js";const to=n=>e.jsx("svg",{...n,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 91 51",style:{color:"inherit",...n.style},children:e.jsx("path",{fill:"currentColor",d:"M30.256 48.614a3.14 3.14 0 0 0-.989-2.153L10.803 29.063h76.915a3.2 3.2 0 0 0 .315 0c1.584-.084 2.95-1.64 2.867-3.266-.082-1.625-1.598-3.028-3.182-2.943H10.803L29.267 5.49c1.284-1.099 1.456-3.057.385-4.373a2.972 2.972 0 0 0-4.48-.187L.971 23.695a3.163 3.163 0 0 0 0 4.56l24.2 22.766a2.98 2.98 0 0 0 2.205.84c1.669-.08 2.958-1.534 2.88-3.247Z"})}),no=n=>e.jsx("svg",{...n,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",style:{color:"inherit",...n.style},children:e.jsx("path",{d:"m9 16.172-6.071-6.071-1.414 1.414L10 20l.707-.707 7.778-7.778-1.414-1.414L11 16.172V0H9z",fill:"currentColor"})}),so=n=>e.jsx("svg",{...n,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",style:{color:"inherit",...n.style},children:e.jsx("path",{d:"M9 3.828 2.929 9.899 1.515 8.485 10 0l.707.707 7.778 7.778-1.414 1.414L11 3.828V20H9V3.828z",fill:"currentColor"})}),ao=n=>e.jsxs("svg",{...n,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",style:{color:"inherit",...n.style},children:[e.jsx("path",{d:"M13.584 12a2.643 2.643 0 0 1-.775 1.875l-9.541 9.541a1.768 1.768 0 0 1-2.5-2.5l8.739-8.739a.25.25 0 0 0 0-.354L.768 3.084a1.768 1.768 0 0 1 2.5-2.5l9.541 9.541A2.643 2.643 0 0 1 13.584 12Z",fill:"currentColor"}),e.jsx("path",{d:"M23.75 12a2.643 2.643 0 0 1-.775 1.875l-9.541 9.541a1.768 1.768 0 0 1-2.5-2.5l8.739-8.739a.25.25 0 0 0 0-.354l-8.739-8.739a1.768 1.768 0 0 1 2.5-2.5l9.541 9.541A2.643 2.643 0 0 1 23.75 12Z",fill:"currentColor"})]}),oo=n=>e.jsx("svg",{...n,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",style:{color:"inherit",...n.style},children:e.jsx("path",{fill:"currentColor",d:"M19.611 2.571h-3.754a1.286 1.286 0 1 1 0-2.571h6.857A1.286 1.286 0 0 1 24 1.286v6.857a1.286 1.286 0 0 1-2.571 0V4.39L15.48 10.34a1.286 1.286 0 0 1-1.817-1.817l5.948-5.95ZM1.286 14.571a1.286 1.286 0 0 1 1.285 1.286v3.754l5.949-5.946a1.286 1.286 0 0 1 1.817 1.817L4.39 21.429h3.753a1.285 1.285 0 1 1 0 2.571H1.286A1.286 1.286 0 0 1 0 22.714v-6.857a1.286 1.286 0 0 1 1.286-1.286Z"})}),io=n=>e.jsx("svg",{...n,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",style:{color:"inherit",...n.style},children:e.jsx("path",{fill:"currentColor",d:"M14.143 1.714A1.286 1.286 0 0 1 15.429 3v3.753L21.806.377a1.286 1.286 0 0 1 1.817 1.817l-6.376 6.377H21a1.286 1.286 0 1 1 0 2.572h-6.857a1.286 1.286 0 0 1-1.286-1.286V3a1.286 1.286 0 0 1 1.286-1.286ZM9.857 22.286A1.285 1.285 0 0 1 8.571 21v-3.753l-6.377 6.376a1.286 1.286 0 0 1-1.817-1.817l6.376-6.377H3a1.286 1.286 0 0 1 0-2.572h6.857a1.286 1.286 0 0 1 1.286 1.286V21a1.286 1.286 0 0 1-1.286 1.286Z"})}),ro=n=>e.jsxs("svg",{...n,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",style:{color:"inherit",...n.style},children:[e.jsx("path",{d:"M8.616 1.741A1.455 1.455 0 0 1 10.07.287h3.392a1.455 1.455 0 0 1 1.453 1.454v8.228a.25.25 0 0 0 .25.25h2.9a1.138 1.138 0 0 1 .827 2l-6.1 6.1a1.489 1.489 0 0 1-2.056 0l-6.1-6.1a1.137 1.137 0 0 1 .827-2h2.9a.249.249 0 0 0 .25-.25Z",fill:"currentColor"}),e.jsx("path",{d:"M0 19.677a4.039 4.039 0 0 0 4.035 4.035h15.93A4.039 4.039 0 0 0 24 19.677V17.8a1.225 1.225 0 0 0-2.449 0v1.874a1.588 1.588 0 0 1-1.586 1.586H4.035a1.588 1.588 0 0 1-1.586-1.586V17.8A1.225 1.225 0 0 0 0 17.8Z",fill:"currentColor"})]}),co=n=>e.jsxs("svg",{...n,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",style:{color:"inherit",...n.style},children:[e.jsx("path",{d:"M12.406 14.905a1 1 0 0 0-.543 1.307 1 1 0 0 1-.217 1.09l-2.828 2.829a2 2 0 0 1-2.828 0L3.868 18.01a2 2 0 0 1 0-2.829L6.7 12.353a1.013 1.013 0 0 1 1.091-.217 1 1 0 0 0 .763-1.849 3.034 3.034 0 0 0-3.268.652l-2.832 2.828a4.006 4.006 0 0 0 0 5.657l2.122 2.121a4 4 0 0 0 5.656 0l2.829-2.828a3.008 3.008 0 0 0 .651-3.27 1 1 0 0 0-1.306-.542Z",fill:"currentColor"}),e.jsx("path",{d:"M7.757 16.241a1.011 1.011 0 0 0 1.414 0l7.779-7.778a1 1 0 0 0-1.414-1.414l-7.779 7.778a1 1 0 0 0 0 1.414Z",fill:"currentColor"}),e.jsx("path",{d:"m21.546 4.574-2.121-2.121a4.006 4.006 0 0 0-5.657 0l-2.829 2.828a3.006 3.006 0 0 0-.651 3.269 1 1 0 1 0 1.849-.764 1 1 0 0 1 .217-1.086l2.828-2.828a2 2 0 0 1 2.829 0l2.121 2.121a2 2 0 0 1 0 2.829L17.3 11.645a1.015 1.015 0 0 1-1.091.217 1 1 0 0 0-.765 1.849 3.026 3.026 0 0 0 3.27-.651l2.828-2.828a4.007 4.007 0 0 0 .004-5.658Z",fill:"currentColor"})]}),ln=n=>e.jsx("svg",{...n,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",style:{color:"inherit",...n.style},children:e.jsx("path",{d:"M12 0a12 12 0 1 0 12 12A12.013 12.013 0 0 0 12 0Zm.25 5a1.5 1.5 0 1 1-1.5 1.5 1.5 1.5 0 0 1 1.5-1.5Zm2.25 13.5h-4a1 1 0 0 1 0-2h.75a.25.25 0 0 0 .25-.25v-4.5a.25.25 0 0 0-.25-.25h-.75a1 1 0 0 1 0-2h1a2 2 0 0 1 2 2v4.75a.25.25 0 0 0 .25.25h.75a1 1 0 1 1 0 2Z",fill:"currentColor"})}),lo=({startMonth:n,numDisplayed:t,monthBounds:s,style:i,onSelect:o})=>{const[r,c]=d.useState(null),[a,l]=d.useState(12),u=Tt(),p=n,m=ct(p,t-1),j=es(tt(p,a/2-t/2),ct(m,a/2-t/2)),g=Math.floor(j.length/2)-Math.floor(t/2),b=g+t-1,[S,f]=d.useState("small"),M=fn(k=>{f(k.width<=400?"small":"big"),l(Math.min(Math.max(Math.floor(k.width/50),12),24))}),w=[];return e.jsx(x,{style:{flexDirection:"row",alignItems:"center",justifyContent:"space-between",...i},children:e.jsx(x,{innerRef:M,style:{flexDirection:"row",flex:1,alignItems:"center",justifyContent:"center"},children:j.map((k,E)=>{const B=ts(k,"MMM"),N=E>=g&&E<=b,W=r+t-1,I=r===null?!1:E>=r&&E<=W,A=u===k,C=ns(k);let O=!1;w.includes(C)||(w.push(C),O=!0);const G=k>=s.start&&k<=s.end;return e.jsxs(x,{style:{padding:"3px 3px",width:S==="big"?"35px":"20px",textAlign:"center",userSelect:"none",cursor:"default",borderRadius:2,border:"none",...!G&&{textDecoration:"line-through",color:y.pageTextSubdued},...pe.smallText,...N&&{backgroundColor:y.tableBorderHover,color:y.buttonPrimaryText},...(I||N)&&{borderRadius:0,cursor:"pointer"},...r!==null&&!I&&N&&{filter:"brightness(65%)"},...I&&!N&&{backgroundColor:y.buttonBareBackgroundHover},...!I&&!N&&A&&{backgroundColor:y.buttonBareBackgroundHover,filter:"brightness(120%)"},...I&&N&&A&&{filter:"brightness(120%)"},...I&&N&&{backgroundColor:y.tableBorderHover},...(E===g||E===r&&!N)&&{borderTopLeftRadius:2,borderBottomLeftRadius:2},...(E===b||E===W&&!N)&&{borderTopRightRadius:2,borderBottomRightRadius:2},...A&&{fontWeight:"bold"}},onClick:()=>o(k),onMouseEnter:()=>c(E),onMouseLeave:()=>c(null),children:[S==="small"?B[0]:B,O&&e.jsx(x,{style:{position:"absolute",top:-14,left:0,fontSize:10,fontWeight:"bold",color:G?y.pageText:y.pageTextSubdued},children:C})]},k)})})})},Pn=d.memo(({startMonth:n,onMonthSelect:t,numMonths:s,monthBounds:i})=>e.jsx(x,{style:{marginLeft:205,flexShrink:0},children:e.jsx(x,{style:{marginRight:5+Bt()},children:e.jsx(lo,{startMonth:n,numDisplayed:s,monthBounds:i,style:{paddingTop:5},onSelect:o=>t(o)})})}));Pn.displayName="BudgetPageHeader";function Ze({component:n,editingMonth:t,args:s,style:i}){const{months:o}=d.useContext(pn);return o.map((r,c)=>{const a=t===r;return e.jsx(At.Provider,{value:Rt(r),children:e.jsx(x,{style:{flex:1,borderLeft:"1px solid "+y.tableBorder,...i},children:e.jsx(n,{month:r,editing:a,...s})})},c)})}function Wt({innerRef:n,category:t,categoryGroup:s,dragPreview:i,dragging:o,editing:r,style:c,isLast:a,onEditName:l,onSave:u,onDelete:p,onHideNewCategory:m}){const{t:j}=de(),g=t.id==="new",[b,S]=d.useState(!1),f=d.useRef(null),M=nt("contextMenus"),w=e.jsxs(x,{style:{flexDirection:"row",alignItems:"center",userSelect:"none",WebkitUserSelect:"none",opacity:t.hidden||s?.hidden?.33:void 0,backgroundColor:"transparent",height:20},ref:f,onContextMenu:k=>{M&&(k.preventDefault(),S(!0))},children:[e.jsx("div",{"data-testid":"category-name",style:{textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",minWidth:0},children:t.name}),e.jsxs(x,{style:{flexShrink:0,marginLeft:5},children:[e.jsx(K,{variant:"bare",className:"hover-visible",style:{color:"currentColor",padding:3},onPress:()=>S(!0),children:e.jsx(Mt,{width:14,height:14,style:{color:"currentColor"}})}),e.jsx(ve,{triggerRef:f,placement:"bottom start",isOpen:b,onOpenChange:()=>S(!1),style:{width:200},isNonModal:!0,children:e.jsx(we,{onMenuSelect:k=>{k==="rename"?l(t.id):k==="delete"?p(t.id):k==="toggle-visibility"&&u({...t,hidden:!t.hidden}),S(!1)},items:[{name:"rename",text:"Rename"},!s?.hidden&&{name:"toggle-visibility",text:t.hidden?"Show":"Hide"},{name:"delete",text:"Delete"}]})})]}),e.jsx(x,{style:{flex:1}}),e.jsx(x,{style:{flexShrink:0},children:e.jsx(It,{id:t.id,style:o&&{color:"currentColor"},defaultColor:y.pageTextLight})})]});return e.jsx(x,{innerRef:n,style:{width:200,overflow:"hidden","& .hover-visible":{display:"none"},...!o&&!i&&{"&:hover .hover-visible":{display:"flex"}},...o&&{color:y.formInputTextPlaceholderSelected},...i&&{backgroundColor:y.tableBackground,zIndex:1e4,borderRadius:6,overflow:"hidden"},...c},onKeyDown:k=>{k.key==="Enter"&&(l(null),k.stopPropagation())},children:e.jsx(Ve,{value:t.name,formatter:()=>w,width:"flex",exposed:r||g,onUpdate:k=>{g?k===""?m():k!==""&&u({...t,name:k}):k!==t.name&&u({...t,name:k})},onBlur:()=>l(null),style:{paddingLeft:13,...a&&{borderBottomWidth:0}},inputProps:{placeholder:g?j("New Category Name"):""}})})}function uo({cat:n,categoryGroup:t,editingCell:s,dragState:i,MonthComponent:o,onEditName:r,onEditMonth:c,onSave:a,onDelete:l,onBudgetAction:u,onShowActivity:p,onDragChange:m,onReorder:j}){let g=i&&i.item===n;i&&i.item.id===n.cat_group&&(g=!0);const{dragRef:b}=Dt({type:"category",onDragChange:m,item:n,canDrag:s===null}),{dropRef:S,dropPos:f}=lt({types:"category",id:n.id,onDrop:j});return e.jsxs(De,{innerRef:S,collapsed:!0,style:{backgroundColor:y.tableBackground,opacity:n.hidden||t?.hidden?.5:void 0},children:[e.jsx(dt,{pos:f,offset:{top:1}}),e.jsxs(x,{style:{flex:1,flexDirection:"row"},children:[e.jsx(Wt,{innerRef:b,category:n,categoryGroup:t,dragPreview:g&&i.preview,dragging:g&&!i.preview,editing:s&&s.cell==="name"&&s.id===n.id,onEditName:r,onSave:a,onDelete:l}),e.jsx(Ze,{component:o,editingMonth:s&&s.id===n.id&&s.cell,args:{category:n,onEdit:c,onBudgetAction:u,onShowActivity:p}})]})]})}function Gt({group:n,editing:t,collapsed:s,dragPreview:i,innerRef:o,style:r,onEdit:c,onSave:a,onDelete:l,onApplyBudgetTemplatesInGroup:u,onShowNewCategory:p,onHideNewGroup:m,onToggleCollapse:j}){const{t:g}=de(),b=nt("goalTemplatesEnabled"),S=n.id==="new",[f,M]=d.useState(!1),w=d.useRef(null),k=nt("contextMenus"),E=e.jsxs(x,{style:{flexDirection:"row",alignItems:"center",userSelect:"none",WebkitUserSelect:"none",height:20},ref:w,onClick:()=>{j(n.id)},onContextMenu:B=>{k&&(B.preventDefault(),M(!0))},children:[!i&&e.jsx(gn,{width:8,height:8,style:{marginRight:5,marginLeft:5,flexShrink:0,transition:"transform .1s",transform:s?"rotate(-90deg)":""}}),e.jsxs("div",{style:{textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",minWidth:0},children:[i&&e.jsx(se,{style:{fontWeight:500},children:"Group: "}),n.name]}),!i&&e.jsxs(e.Fragment,{children:[e.jsxs(x,{style:{marginLeft:5,flexShrink:0},children:[e.jsx(K,{variant:"bare",className:"hover-visible",onPress:()=>M(!0),style:{padding:3},children:e.jsx(Mt,{width:14,height:14})}),e.jsx(ve,{triggerRef:w,placement:"bottom start",isOpen:f,onOpenChange:()=>M(!1),style:{width:200},isNonModal:!0,children:e.jsx(we,{onMenuSelect:B=>{B==="rename"?c(n.id):B==="add-category"?p(n.id):B==="delete"?l(n.id):B==="toggle-visibility"?a({...n,hidden:!n.hidden}):B==="apply-multiple-category-template"&&u?.(n.categories.filter(N=>!N.hidden).map(N=>N.id)),M(!1)},items:[{name:"add-category",text:g("Add category")},{name:"rename",text:g("Rename")},!n.is_income&&{name:"toggle-visibility",text:n.hidden?g("Show"):g("Hide")},l&&{name:"delete",text:g("Delete")},...b?[{name:"apply-multiple-category-template",text:g("Apply budget templates")}]:[]]})})]}),e.jsx(x,{style:{flex:1}}),e.jsx(x,{style:{flexShrink:0},children:e.jsx(It,{id:n.id,style:i&&{color:"currentColor"},defaultColor:y.pageTextLight})})]})]});return e.jsx(x,{innerRef:o,style:{...r,width:200,backgroundColor:y.tableRowHeaderBackground,overflow:"hidden","& .hover-visible":{display:"none"},...!i&&{"&:hover .hover-visible":{display:"flex"}},...i&&{paddingLeft:10,zIndex:1e4,borderRadius:6,overflow:"hidden"}},onKeyDown:B=>{B.key==="Enter"&&(c(null),B.stopPropagation())},children:e.jsx(Ve,{value:n.name,formatter:()=>E,width:"flex",exposed:t,onUpdate:B=>{S?B===""?m():B!==""&&a({id:n.id,name:B}):a({id:n.id,name:B})},onBlur:()=>c(null),style:{fontWeight:600},inputProps:{style:{marginLeft:20},placeholder:S?g("New Group Name"):""}})})}function ho({group:n,collapsed:t,editingCell:s,dragState:i,MonthComponent:o,onEditName:r,onSave:c,onDelete:a,onApplyBudgetTemplatesInGroup:l,onDragChange:u,onReorderGroup:p,onReorderCategory:m,onToggleCollapse:j,onShowNewCategory:g}){const b=i&&i.item===n,{dragRef:S}=Dt({type:"group",onDragChange:u,item:n,canDrag:s===null}),{dropRef:f,dropPos:M}=lt({types:"group",id:n.id,onDrop:p}),{dropRef:w,dropPos:k}=lt({types:"category",id:n.id,onDrop:m,onLongHover:()=>{t&&j(n.id)}});return e.jsxs(De,{collapsed:!0,style:{fontWeight:600,opacity:n.hidden?.33:void 0,backgroundColor:y.tableRowHeaderBackground},children:[i&&!i.preview&&i.type==="group"&&e.jsx(x,{innerRef:f,style:{position:"absolute",left:0,right:0,height:t?qt-1:(1+n.categories.length)*(qt-1)+1,zIndex:1e4},children:e.jsx(dt,{pos:M,offset:{top:1}})}),e.jsx(dt,{pos:k,offset:{top:1}}),e.jsxs(x,{innerRef:w,style:{flex:1,flexDirection:"row",opacity:b&&!i.preview?.3:1},children:[e.jsx(Gt,{innerRef:S,group:n,editing:s&&s.cell==="name"&&s.id===n.id,dragPreview:b&&i.preview,collapsed:t,onToggleCollapse:j,onEdit:r,onSave:c,onDelete:a,onApplyBudgetTemplatesInGroup:l,onShowNewCategory:g}),e.jsx(Ze,{component:o,args:{group:n}})]})]})}function fo({cat:n,isLast:t,editingCell:s,MonthComponent:i,onEditName:o,onEditMonth:r,onSave:c,onDelete:a,onDragChange:l,onBudgetAction:u,onReorder:p,onShowActivity:m}){const{dragRef:j}=Dt({type:"income-category",onDragChange:l,item:n,canDrag:s===null}),{dropRef:g,dropPos:b}=lt({types:"income-category",id:n.id,onDrop:p});return e.jsxs(De,{innerRef:g,collapsed:!0,style:{opacity:n.hidden?.5:void 0},children:[e.jsx(dt,{pos:b,offset:{top:1}}),e.jsx(Wt,{innerRef:j,category:n,isLast:t,editing:s&&s.cell==="name"&&s.id===n.id,onEditName:o,onSave:c,onDelete:a}),e.jsx(Ze,{component:i,editingMonth:s&&s.id===n.id&&s.cell,args:{category:n,onEdit:r,isLast:t,onShowActivity:m,onBudgetAction:u}})]})}function po({group:n,editingCell:t,collapsed:s,MonthComponent:i,onEditName:o,onSave:r,onToggleCollapse:c,onShowNewCategory:a}){return e.jsxs(De,{collapsed:!0,style:{fontWeight:600,backgroundColor:y.tableRowHeaderBackground},children:[e.jsx(Gt,{group:n,collapsed:s,editing:t&&t.cell==="name"&&t.id===n.id,onEdit:o,onSave:r,onToggleCollapse:c,onShowNewCategory:a}),e.jsx(Ze,{component:i,args:{group:n}})]})}function go({MonthComponent:n,onShowNewGroup:t}){return e.jsxs(x,{style:{flexDirection:"row",flex:1},children:[e.jsx(x,{style:{width:200,alignItems:"flex-start",justifyContent:"flex-start"},children:e.jsx(K,{onPress:t,style:{fontSize:12,margin:10},children:e.jsx(re,{children:"Add Group"})})}),e.jsx(Ze,{component:n,style:{border:0,justifyContent:"flex-end"}})]})}const En=d.memo(({categoryGroups:n,editingCell:t,dataComponents:s,onBudgetAction:i,onShowActivity:o,onEditName:r,onEditMonth:c,onSaveCategory:a,onSaveGroup:l,onDeleteCategory:u,onDeleteGroup:p,onApplyBudgetTemplatesInGroup:m,onReorderCategory:j,onReorderGroup:g})=>{const[b=[],S]=Pe("budget.collapsed"),[f]=Pe("budget.showHiddenCategories");function M(h){S(h)}const[w,k]=d.useState(!1),[E,B]=d.useState(null),N=d.useMemo(()=>{const[h,D]=mn(n);let R=Array.prototype.concat.apply([],h.map(P=>{if(P.hidden&&!f)return[];const z=P.categories.filter(he=>f||!he.hidden),J=[{type:"expense-group",value:{...P}}];return E===P.id&&J.push({type:"new-category"}),[...J,...(b.includes(P.id)?[]:z).map(he=>({type:"expense-category",value:he,group:P}))]}));return w&&R.push({type:"new-group"}),D&&(R=R.concat([{type:"income-separator"},{type:"income-group",value:D},E===D.id&&{type:"new-category"},...(b.includes(D.id)?[]:D.categories.filter(P=>f||!P.hidden)).map(P=>({type:"income-category",value:P}))].filter(P=>P))),R},[n,b,E,w,f]),[W,I]=d.useState(null),[A,C]=d.useState(null);function O(h){const{state:D}=h;D==="start-preview"?I({type:h.type,item:h.item,preview:!0}):D==="start"?W&&(I({...W,preview:!1}),C(b)):D==="hover"?I({...W,hoveredId:h.id,hoveredPos:h.pos}):D==="end"&&(I(null),M(A||[]))}function G(h){b.includes(h)?M(b.filter(D=>D!==h)):M([...b,h])}function Y(){k(!0)}function q(){k(!1)}function $(h){l?.(h),h.id==="new"&&q()}function oe(h){M(b.filter(D=>D!==h)),B(h)}function ne(){B(null)}function U(h){a?.(h),h.id==="new"&&ne()}return e.jsx(x,{style:{marginBottom:10,backgroundColor:y.tableBackground,overflow:"hidden",boxShadow:pe.cardShadow,borderRadius:"0 0 4px 4px",flex:1},children:N.map((h,D)=>{let R;switch(h.type){case"new-group":R=e.jsx(De,{style:{backgroundColor:y.tableRowHeaderBackground},children:e.jsx(Gt,{group:{id:"new",name:""},editing:!0,onSave:$,onHideNewGroup:q,onEdit:r})});break;case"new-category":R=e.jsx(De,{children:e.jsx(Wt,{category:{name:"",cat_group:E,is_income:E===n.find(z=>z.is_income).id,id:"new"},editing:!0,onSave:U,onHideNewCategory:ne,onEditName:r})});break;case"expense-group":R=e.jsx(ho,{group:h.value,editingCell:t,collapsed:b.includes(h.value.id),MonthComponent:s.ExpenseGroupComponent,dragState:W,onEditName:r,onSave:$,onDelete:p,onDragChange:O,onReorderGroup:g,onReorderCategory:j,onToggleCollapse:G,onShowNewCategory:oe,onApplyBudgetTemplatesInGroup:m});break;case"expense-category":R=e.jsx(uo,{cat:h.value,categoryGroup:h.group,editingCell:t,MonthComponent:s.ExpenseCategoryComponent,dragState:W,onEditName:r,onEditMonth:c,onSave:U,onDelete:u,onDragChange:O,onReorder:j,onBudgetAction:i,onShowActivity:o});break;case"income-separator":R=e.jsx(x,{style:{height:pe.incomeHeaderHeight,backgroundColor:y.tableBackground},children:e.jsx(go,{MonthComponent:s.IncomeHeaderComponent,onShowNewGroup:Y})});break;case"income-group":R=e.jsx(po,{group:h.value,editingCell:t,MonthComponent:s.IncomeGroupComponent,collapsed:b.includes(h.value.id),onEditName:r,onSave:$,onToggleCollapse:G,onShowNewCategory:oe});break;case"income-category":R=e.jsx(fo,{cat:h.value,editingCell:t,isLast:D===N.length-1,MonthComponent:s.IncomeCategoryComponent,onEditName:r,onEditMonth:c,onSave:U,onDelete:u,onDragChange:O,onReorder:j,onBudgetAction:i,onShowActivity:o});break;default:throw new Error("Unknown item type: "+h.type)}const P=D===0?"first":D===N.length-1?"last":null;return e.jsx(ss.Provider,{value:P,children:e.jsx(x,{style:!W&&{":hover":{backgroundColor:y.tableBackground}},children:R})},h.value?h.value.id:h.type==="income-separator"?"separator":D)})})});En.displayName="BudgetCategories";function mo({SummaryComponent:n}){const{months:t}=d.useContext(pn),[s,i]=d.useState(0),[o,r]=as(()=>({x:0,config:{mass:3,tension:600,friction:80}})),c=fn(d.useCallback(p=>{i(p.width)},[])),a=d.useRef(t[0]),l=[...t];l.unshift(tt(t[0],1)),l.push(ct(t[t.length-1],1));const u=s/t.length;return d.useLayoutEffect(()=>{const p=a.current,m=p>t[0],j=u;let g=m?-j*2:0;p!==l[0]&&p!==l[2]&&(g=-j);const b=-j;r.start({from:{x:g},x:b})},[t[0]]),d.useLayoutEffect(()=>{a.current=t[0]},[t[0]]),d.useLayoutEffect(()=>{r.start({from:{x:-u},to:{x:-u}})},[u]),e.jsx("div",{className:xn([{flex:1,overflow:"hidden"},t.length===1&&{marginLeft:-4,marginRight:-4}]),ref:c,children:e.jsx(os.div,{className:"view",style:{flexDirection:"row",width:s,willChange:"transform",transform:o.x.to(p=>`translateX(${p}px)`)},children:l.map(p=>e.jsx(x,{style:{flex:`0 0 ${u}px`,paddingLeft:4,paddingRight:4},children:e.jsx(n,{month:p})},p))})})}const xo=d.memo(function({MonthComponent:t,toggleHiddenCategories:s,expandAllCategories:i,collapseAllCategories:o}){const{t:r}=de(),[c,a]=d.useState(!1),l=d.useRef(null);return e.jsxs(x,{"data-testid":"budget-totals",style:{backgroundColor:y.tableBackground,flexDirection:"row",flexShrink:0,boxShadow:pe.cardShadow,marginLeft:5,marginRight:5+Bt(),borderRadius:"4px 4px 0 0",borderBottom:"1px solid "+y.tableBorder},children:[e.jsxs(x,{style:{width:200,color:y.pageTextLight,justifyContent:"center",paddingLeft:15,paddingRight:5,display:"flex",flexDirection:"row",alignItems:"center",userSelect:"none",WebkitUserSelect:"none"},children:[e.jsx(x,{style:{flexGrow:"1"},children:e.jsx(re,{children:"Category"})}),e.jsx(K,{ref:l,variant:"bare","aria-label":r("Menu"),onPress:()=>a(!0),style:{color:"currentColor",padding:3},children:e.jsx(is,{width:15,height:15,style:{color:y.pageTextLight}})}),e.jsx(ve,{triggerRef:l,isOpen:c,onOpenChange:()=>a(!1),style:{width:200},children:e.jsx(we,{onMenuSelect:u=>{u==="toggle-visibility"?s():u==="expandAllCategories"?i():u==="collapseAllCategories"&&o(),a(!1)},items:[{name:"toggle-visibility",text:r("Toggle hidden categories")},{name:"expandAllCategories",text:r("Expand all")},{name:"collapseAllCategories",text:r("Collapse all")}]})})]}),e.jsx(Ze,{component:t})]})});function Ln(n){const{type:t,prewarmStartMonth:s,startMonth:i,numMonths:o,monthBounds:r,dataComponents:c,onSaveCategory:a,onDeleteCategory:l,onSaveGroup:u,onDeleteGroup:p,onApplyBudgetTemplatesInGroup:m,onReorderCategory:j,onReorderGroup:g,onShowActivity:b,onBudgetAction:S}=n,{grouped:f}=Pt(),[M=[],w]=Pe("budget.collapsed"),[k,E]=Pe("budget.showHiddenCategories"),[B,N]=d.useState(null),W=(U,h)=>{N(U?{id:U,cell:h}:null)},I=U=>{N(U?{id:U,cell:"name"}:null)},A=(U,h,D)=>{if(!!f.find(P=>P.id===D)){const{targetId:P}=rs(f,h,D),z=f.find(J=>J.id===P);if(z){const{categories:J}=z;j({id:U,groupId:z.id,targetId:J.length===0||h==="top"?null:J[0].id})}}else{let P;for(const z of f)if(z.categories.find(J=>J.id===D)){P=z;break}j({id:U,groupId:P.id,...Kt(P.categories,h,D)})}},C=(U,h,D)=>{const[R]=mn(f);g({id:U,...Kt(R,h,D)})},O=U=>{const h=f.reduce((D,R)=>M.includes(R.id)?D.concat({id:R.id,isGroup:!0}):D.concat([{id:R.id,isGroup:!0},...R.categories]),[]);if(B){let R=h.findIndex(P=>P.id===B.id)+U;for(;R>=0&&R<h.length;){const P=h[R];if(P.isGroup){R+=U;continue}else if(t==="report"||!P.is_income){W(P.id,B.cell);return}else break}}},G=U=>{if(!B)return null;(U.key==="Enter"||U.key==="Tab")&&(U.preventDefault(),O(U.shiftKey?-1:1))},Y=U=>{w(U)},q=()=>{E(!k)},$=()=>{q()},oe=()=>{Y([])},ne=()=>{Y(f.map(U=>U.id))};return e.jsxs(x,{"data-testid":"budget-table",style:{flex:1,...pe.lightScrollbar&&{"& ::-webkit-scrollbar":{backgroundColor:"transparent"},"& ::-webkit-scrollbar-thumb:vertical":{backgroundColor:y.tableHeaderBackground}}},children:[e.jsxs(x,{style:{flexDirection:"row",overflow:"hidden",flexShrink:0,paddingLeft:5,paddingRight:5+Bt()},children:[e.jsx(x,{style:{width:200}}),e.jsx(Zt,{startMonth:s,numMonths:o,monthBounds:r,type:t,children:e.jsx(mo,{SummaryComponent:c.SummaryComponent})})]}),e.jsxs(Zt,{startMonth:i,numMonths:o,monthBounds:r,type:t,children:[e.jsx(xo,{MonthComponent:c.BudgetTotalsComponent,toggleHiddenCategories:$,expandAllCategories:oe,collapseAllCategories:ne}),e.jsx(x,{style:{overflowY:"scroll",overflowAnchor:"none",flex:1,paddingLeft:5,paddingRight:5},children:e.jsx(x,{style:{flexShrink:0},onKeyDown:G,children:e.jsx(En,{categoryGroups:f,editingCell:B,dataComponents:c,onEditMonth:W,onEditName:I,onSaveCategory:a,onSaveGroup:u,onDeleteCategory:l,onDeleteGroup:p,onReorderCategory:A,onReorderGroup:C,onBudgetAction:S,onShowActivity:b,onApplyBudgetTemplatesInGroup:m})})})]})]})}Ln.displayName="BudgetTable";function yo(n){const t=n-200;return t<500?1:t<750?2:t<1e3?3:t<1250?4:t<1500?5:6}const Fn=({type:n,width:t,height:s,prewarmStartMonth:i,startMonth:o,maxMonths:r=3,monthBounds:c,onMonthSelect:a,...l})=>{const{setDisplayMax:u}=ls(),p=yo(t),m=Math.min(p,r),j=200+500*m;d.useEffect(()=>{u(p)},[p]);function g(S){const f=c.start,M=tt(c.end,m-1);return S<f?f:S>M?M:S}function b(S){a(g(S),m)}return le("left",()=>{b(ds(o))},{preventDefault:!0,scopes:["app"]},[b,o]),le("right",()=>{b(us(o))},{preventDefault:!0,scopes:["app"]},[b,o]),le("0",()=>{b(tt(Tt(),n==="rollover"?Math.floor((m-1)/2):m===2?1:Math.max(m-2,0)))},{preventDefault:!0,scopes:["app"]},[b,o,m]),e.jsx(x,{style:{width:t,height:s,alignItems:"center",opacity:t<=0||s<=0?0:1},children:e.jsxs(x,{style:{width:"100%",maxWidth:j},children:[e.jsx(Pn,{startMonth:i,numMonths:m,monthBounds:c,onMonthSelect:b}),e.jsx(Ln,{prewarmStartMonth:i,startMonth:o,numMonths:m,monthBounds:c,...l})]})})};Fn.displayName="DynamicBudgetTableInner";const Ct=n=>e.jsx(cs,{children:({width:t,height:s})=>e.jsx(Fn,{width:t,height:s,...n})});Ct.displayName="DynamicBudgetTable";function bo(n){const{t}=de(),s=Tt(),i=Bs(),o=Ue(),r=yn(),[c,a]=Pe("budget.summaryCollapsed"),[l,u]=Pe("budget.startMonth"),p=l||s,[m,j]=d.useState({start:p,end:p}),[g="rollover"]=He("budgetType"),[b]=As("maxMonths"),S=b||1,[f,M]=d.useState(!1),{grouped:w}=Pt();function k(){o(Ms())}d.useEffect(()=>{async function h(){k();const{start:R,end:P}=await X("get-budget-bounds");j({start:R,end:P}),await Is(g,i,{start:R,end:P},p),M(!0)}h();const D=[vt("sync-event",({type:R,tables:P})=>{R==="success"&&(P.includes("categories")||P.includes("category_mapping")||P.includes("category_groups"))&&k()}),vt("undo-event",({tables:R})=>{R.includes("categories")&&k()})];return()=>{D.forEach(R=>R())}},[]),d.useEffect(()=>{X("get-budget-bounds").then(({start:h,end:D})=>{(m.start!==h||m.end!==D)&&j({start:h,end:D})})},[n.accountId]);const E=async(h,D)=>{u(h);const R=h;h<p?await Yt(g,i,tt(h,1)):h>p&&await Yt(g,i,ct(h,D)),R===h&&u(h)},B=h=>{o(Os({type:"error",message:t("Category ‘{{name}}‘ already exists in group (May be Hidden)",{name:h})}))},N=async h=>{if((await X("get-categories")).grouped.filter(P=>P.id===h.cat_group)[0].categories.filter(P=>P.name.toUpperCase()===h.name.toUpperCase()).filter(P=>h.id==="new"?!0:P.id!==h.id).length>0){B(h.name);return}h.id==="new"?o(Es(h.name,h.cat_group,h.is_income,h.hidden)):o(Ls(h))},W=async h=>{const D=await X("must-category-transfer",{id:h});o(D?Ee("confirm-category-delete",{category:h,onDelete:R=>{h!==R&&o(Xt(h,R))}}):Xt(h))},I=h=>{h.id==="new"?o(Fs(h.name)):o(Ns(h))},A=async h=>{const D=w.find(P=>P.id===h);let R=!1;for(const P of D.categories)if(await X("must-category-transfer",{id:P.id})){R=!0;break}o(R?Ee("confirm-category-delete",{group:h,onDelete:P=>{o(Jt(h,P))}}):Jt(h))},C=async h=>{o(en(p,"apply-multiple-templates",{month:p,categories:h}))},O=(h,D,R)=>{o(en(h,D,R))},G=(h,D)=>{r("/accounts",{state:{goBack:!0,filterConditions:[{field:"category",op:"is",value:h,type:"id"},{field:"date",op:"is",value:D,options:{month:!0},type:"date"}],categoryId:h}})},Y=async h=>{const D=await X("get-categories"),R=D.list.filter(z=>z.id===h.id)[0];if(D.grouped.filter(z=>z.id===h.groupId)[0].categories.filter(z=>z.name.toUpperCase()===R.name.toUpperCase()).filter(z=>z.id!==R.id).length>0){B(R.name);return}o(_s(h.id,h.groupId,h.targetId))},q=async h=>{o(Hs(h.id,h.targetId))},$=()=>{a(!c)},{trackingComponents:oe,envelopeComponents:ne}=n;if(!f||!w)return null;let U;return g==="report"?U=e.jsx(Ds,{summaryCollapsed:c,onBudgetAction:O,onToggleSummaryCollapse:$,children:e.jsx(Ct,{type:g,prewarmStartMonth:p,startMonth:p,monthBounds:m,maxMonths:S,dataComponents:oe,onMonthSelect:E,onDeleteCategory:W,onDeleteGroup:A,onSaveCategory:N,onSaveGroup:I,onBudgetAction:O,onShowActivity:G,onReorderCategory:Y,onReorderGroup:q})}):U=e.jsx(Ps,{summaryCollapsed:c,onBudgetAction:O,onToggleSummaryCollapse:$,children:e.jsx(Ct,{type:g,prewarmStartMonth:p,startMonth:p,monthBounds:m,maxMonths:S,dataComponents:ne,onMonthSelect:E,onDeleteCategory:W,onDeleteGroup:A,onApplyBudgetTemplatesInGroup:C,onSaveCategory:N,onSaveGroup:I,onBudgetAction:O,onShowActivity:G,onReorderCategory:Y,onReorderGroup:q})}),e.jsx(At.Provider,{value:Rt(p),children:e.jsx(x,{style:{flex:1},children:U})})}const Nn=d.memo(n=>e.jsx(Rs,{...n}));Nn.displayName="EnvelopeBudgetSummary";function ni(){const n=d.useMemo(()=>({SummaryComponent:hs,ExpenseCategoryComponent:fs,ExpenseGroupComponent:ps,IncomeCategoryComponent:gs,IncomeGroupComponent:ms,BudgetTotalsComponent:xs,IncomeHeaderComponent:ys}),[bs]),t=d.useMemo(()=>({SummaryComponent:Nn,ExpenseCategoryComponent:ws,ExpenseGroupComponent:Ss,IncomeCategoryComponent:js,IncomeGroupComponent:vs,BudgetTotalsComponent:Cs,IncomeHeaderComponent:ks}),[Ts]);return e.jsx(x,{style:{...pe.page,paddingLeft:8,paddingRight:8,overflow:"hidden"},children:e.jsx(bo,{trackingComponents:n,envelopeComponents:t})})}function wo({label:n,textWidth:t}){const s=Et(),[i,o]=d.useState(s.hash==="#info"),r=t||So(n);return i?e.jsxs(x,{style:{userSelect:"none"},children:[e.jsx(ln,{style:{height:"15px",cursor:"pointer"},onClick:()=>o(!1),onMouseLeave:()=>o(!1)}),e.jsx(x,{style:{position:"absolute",left:"20px",top:"-7px",color:y.buttonNormalText,backgroundColor:y.buttonNormalBackground,padding:5,borderRadius:4,border:"1px solid "+y.buttonNormalBorder,zIndex:300,boxShadow:y.buttonPrimaryShadow},children:e.jsx(se,{style:{width:r},children:n})})]}):e.jsx(x,{style:{userSelect:"none"},children:e.jsx(ln,{style:{height:"15px",cursor:"pointer"},onClick:()=>o(!0),onMouseOver:()=>setTimeout(()=>o(!0),500)})})}function So(n){const s=document.createElement("canvas").getContext("2d");return s.font=getComputedStyle(document.body).font,Math.ceil(s.measureText(n).width)}const dn=[{value:"1",label:"1 Day"},{value:"7",label:"1 Week"},{value:"14",label:"2 Weeks"},{value:"30",label:"1 Month"}];function jo(){const[n,t]=He("upcomingScheduledTransactionLength"),s=n||"7",i=nt("upcomingLengthAdjustment"),o=Et(),[r,c]=d.useState(o.hash==="#upcomingLength");return i?r?e.jsx(Us,{primaryAction:e.jsx(x,{style:{flexDirection:"row",gap:"1em"},children:e.jsxs(x,{style:{flexDirection:"row",alignItems:"center",gap:20},children:[e.jsx(x,{title:"Upcoming Length",children:e.jsx(Ws,{options:dn.map(a=>[a.value||"7",a.label]),value:s,onChange:a=>t(a)})}),e.jsx(wo,{label:"Only the first instance of a recurring transaction will be shown."})]})}),children:e.jsxs(x,{style:{flexDirection:"row",gap:20},children:[e.jsxs(se,{children:[e.jsx("strong",{children:"Upcoming Length"})," does not affect how budget data is stored, and can be changed at any time."]}),e.jsx(K,{onPress:()=>c(!1),"aria-label":"Close upcoming length settings",children:"Close"})]})}):e.jsx(x,{children:e.jsx(K,{"aria-label":"Edit upcoming length settings",variant:"primary",onPress:()=>c(!0),children:e.jsxs(re,{children:["Edit Upcoming Length (",dn.find(a=>a.value===s)?.label??"1 Week",")"]})})}):null}function si(){const{t:n}=de(),{pushModal:t}=bn(),[s,i]=d.useState(""),o=Gs();if(o==null)return null;const{schedules:r,statuses:c}=o;function a(m){t("schedule-edit",{id:m})}function l(){t("schedule-edit")}function u(){t("schedules-discover")}async function p(m,j){switch(m){case"post-transaction":await X("schedule/post-transaction",{id:j});break;case"skip":await X("schedule/skip-next-date",{id:j});break;case"complete":await X("schedule/update",{schedule:{id:j,completed:!0}});break;case"restart":await X("schedule/update",{schedule:{id:j,completed:!1},resetNextDate:!0});break;case"delete":await X("schedule/delete",{id:j});break}}return e.jsxs($s,{header:n("Schedules"),children:[e.jsxs(x,{style:{flexDirection:"row",alignItems:"center",padding:"0 0 15px"},children:[e.jsx(x,{style:{flexDirection:"row",alignItems:"center",padding:"15px 0 0"},children:e.jsx(jo,{})}),e.jsx(x,{style:{flex:1,flexDirection:"row",justifyContent:"flex-end"},children:e.jsx(wn,{placeholder:n("Filter schedules…"),value:s,onChange:i})})]}),e.jsx(Qs,{schedules:r,filter:s,statuses:c,allowCompleted:!0,onSelect:a,onAction:p,style:{backgroundColor:y.tableBackground}}),e.jsxs(x,{style:{flexDirection:"row",justifyContent:"space-between",margin:"20px 0",flexShrink:0},children:[e.jsx(K,{onPress:u,children:e.jsx(re,{children:"Find schedules"})}),e.jsx(K,{variant:"primary",onPress:l,children:e.jsx(re,{children:"Add new schedule"})})]})]})}function ai(){return window.close(),e.jsxs(zs,{name:"gocardless-link",isDismissable:!1,children:[e.jsx(Vs,{title:"Account sync"}),e.jsxs(x,{style:{maxWidth:500},children:[e.jsx(tn,{children:e.jsx(re,{children:"Please wait..."})}),e.jsx(tn,{children:e.jsx(re,{children:"The window should close automatically. If nothing happened you can close this window or tab."})})]})]})}function _n(n,t){return!!([n,t].every(s=>s.transfer_id==null&&s.is_child===!1)&&n.account!==t.account&&n.amount+t.amount===0)}const Hn=d.createContext(null);function $t(){const n=d.useContext(Hn);return d.useMemo(()=>({...n,expanded:t=>n.state.mode==="collapse"?!n.state.ids.has(t):n.state.ids.has(t)}),[n])}function vo({children:n,initialMode:t="expand"}){const s=Qe(a=>a.app.lastSplitState),i=Ue(),[o,r]=d.useReducer((a,l)=>{switch(l.type){case"toggle-split":{const u=new Set([...a.ids]),{id:p}=l;return u.has(p)?u.delete(p):u.add(p),{...a,ids:u}}case"open-split":{const u=new Set([...a.ids]),{id:p}=l;return a.mode==="collapse"?u.delete(p):u.add(p),{...a,ids:u}}case"close-splits":{const u=new Set([...a.ids]);return l.ids.forEach(p=>{a.mode==="collapse"?u.add(p):u.delete(p)}),{...a,ids:u}}case"set-mode":return{...a,mode:l.mode,ids:new Set,transitionId:null};case"switch-mode":return a.transitionId!=null?a:{...a,mode:a.mode==="expand"?"collapse":"expand",transitionId:l.id,ids:new Set};case"finish-switch-mode":return{...a,transitionId:null};default:throw new Error("Unknown action type: "+l.type)}},s.current||{ids:new Set,mode:t});d.useEffect(()=>{o.transitionId!=null&&setTimeout(()=>{r({type:"finish-switch-mode"})},250)},[o.transitionId]),d.useEffect(()=>{o.transitionId==null&&i({type:"SET_LAST_SPLIT_STATE",splitState:o})},[i,o]);const c=d.useMemo(()=>({state:o,dispatch:r}),[o,r]);return e.jsx(Hn.Provider,{value:c,children:n})}function Co({transaction:n,onDuplicate:t,onDelete:s,onLinkSchedule:i,onUnlinkSchedule:o,onCreateRule:r,onScheduleAction:c,onMakeAsNonSplitTransactions:a,closeMenu:l,...u}){const{t:p}=de(),m=Ue(),j=Te(n.id),g=!!n.schedule,b=!n.reconciled&&(n.is_parent||n.is_child);function S(){const f=n.id;let M;Te(f)?M=f.split("/")[1]:M=n.schedule,M&&m(Ee("schedule-edit",{id:M}))}return e.jsx(we,{...u,onMenuSelect:f=>{switch(f){case"duplicate":t(n.id);break;case"delete":s(n.id);break;case"unsplit-transactions":a(n.id);break;case"post-transaction":case"skip":c(f,n.id);break;case"view-schedule":S();break;case"link-schedule":i(n.id);break;case"unlink-schedule":o(n.id);break;case"create-rule":r(n.id);break;default:throw new Error(`Unrecognized menu option: ${f}`)}l()},items:j?[{name:"view-schedule",text:p("View schedule")},{name:"post-transaction",text:p("Post transaction")},{name:"skip",text:p("Skip scheduled date")}]:[{name:"duplicate",text:p("Duplicate")},{name:"delete",text:p("Delete")},...g?[{name:"view-schedule",text:p("View schedule")},{name:"unlink-schedule",text:p("Unlink schedule")}]:[{name:"link-schedule",text:p("Link schedule")},{name:"create-rule",text:p("Create rule")}],...b?[{name:"unsplit-transactions",text:p("Unsplit transaction")}]:[]]})}function ko(n,t){return n?n[t]:""}function wt(n,t){let{amount:s,date:i}=n;Te(n.id)&&(s=(n._inverse?-1:1)*ht(s));let o=s<0?-s:null,r=s>0?s:null;return s===0&&(t?r=0:o=0),ra(Tn(i))||(i=null),{...n,date:i,debit:o!=null?ut(o):"",credit:r!=null?ut(r):""}}function To(n,t){const{debit:s,credit:i,date:o,...r}=n;let c;if(s!==""){const l=on(s,null);c=l!=null?-l:null}else c=on(i,null);c=c!=null?pa(c):t.amount;let a=o;return a==null&&(a=t.date||_t()),{...r,date:a,amount:c}}function On(n,t){const s=n[t];return s&&s.is_child&&(n[t+1]==null||n[t+1].parent_id!==s.parent_id)}function Ie(n,t,s,i="asc"){return n===s?t==="asc"?"desc":"asc":i}const Un=d.memo(({hasSelected:n,showAccount:t,showCategory:s,showBalance:i,showCleared:o,scrollWidth:r,onSort:c,ascDesc:a,field:l})=>{const u=Sn();return le("ctrl+a, cmd+a, meta+a",p=>u({type:"select-all",event:p}),{preventDefault:!0,scopes:["app"]},[u]),e.jsxs(De,{style:{fontWeight:300,zIndex:200,color:y.tableHeaderText,backgroundColor:y.tableBackground,paddingRight:`${5+(r??0)}px`,borderTopWidth:1,borderBottomWidth:1,borderColor:y.tableBorder},children:[e.jsx(jn,{exposed:!0,focused:!1,selected:n,width:20,style:{borderTopWidth:0,borderBottomWidth:0},onSelect:p=>u({type:"select-all",isRangeSelect:p.shiftKey})}),e.jsx(Ce,{value:"Date",width:110,alignItems:"flex",marginLeft:-5,id:"date",icon:l==="date"?a:"clickable",onClick:()=>c("date",Ie(l,a,"date","desc"))}),t&&e.jsx(Ce,{value:"Account",width:"flex",alignItems:"flex",marginLeft:-5,id:"account",icon:l==="account"?a:"clickable",onClick:()=>c("account",Ie(l,a,"account","asc"))}),e.jsx(Ce,{value:"Payee",width:"flex",alignItems:"flex",marginLeft:-5,id:"payee",icon:l==="payee"?a:"clickable",onClick:()=>c("payee",Ie(l,a,"payee","asc"))}),e.jsx(Ce,{value:"Notes",width:"flex",alignItems:"flex",marginLeft:-5,id:"notes",icon:l==="notes"?a:"clickable",onClick:()=>c("notes",Ie(l,a,"notes","asc"))}),s&&e.jsx(Ce,{value:"Category",width:"flex",alignItems:"flex",marginLeft:-5,id:"category",icon:l==="category"?a:"clickable",onClick:()=>c("category",Ie(l,a,"category","asc"))}),e.jsx(Ce,{value:"Payment",width:100,alignItems:"flex-end",marginRight:-5,id:"payment",icon:l==="payment"?a:"clickable",onClick:()=>c("payment",Ie(l,a,"payment","asc"))}),e.jsx(Ce,{value:"Deposit",width:100,alignItems:"flex-end",marginRight:-5,id:"deposit",icon:l==="deposit"?a:"clickable",onClick:()=>c("deposit",Ie(l,a,"deposit","desc"))}),i&&e.jsx(Ce,{value:"Balance",width:103,alignItems:"flex-end",marginRight:-5,id:"balance"}),o&&e.jsx(Ce,{value:"✓",width:38,alignItems:"center",id:"cleared",icon:l==="cleared"?a:"clickable",onClick:()=>{c("cleared",Ie(l,a,"cleared","asc"))}})]})});Un.displayName="TransactionHeader";function Wn(n,t,s,i=0){const o=c=>i>0?`${c} (+${i} more)`:c,{payee:r}=n;return s?e.jsx(x,{style:{flexDirection:"row",alignItems:"center"},children:e.jsx("div",{style:{overflow:"hidden",textOverflow:"ellipsis"},children:o(s.name)})}):t?o(t.name):r&&r.startsWith("new:")?o(r.slice(4)):""}function Bo({id:n,focused:t,selected:s,status:i,isChild:o,isPreview:r,onEdit:c,onUpdate:a}){const l=i==="cleared"||i==="reconciled"||i==null,u=ca(i),p=i==="cleared"?y.noticeTextLight:i==="reconciled"?y.noticeTextLight:i==="missed"?y.errorText:i==="due"?y.warningText:s?y.pageTextLinkLight:y.pageTextSubdued;function m(){l&&a("cleared",i!=="cleared")}return e.jsx(Oe,{name:"cleared",width:38,alignItems:"center",focused:t,style:{padding:1},plain:!0,children:e.jsx(Ht,{style:{padding:3,backgroundColor:"transparent",border:"1px solid transparent",borderRadius:50,":focus":{...r?{boxShadow:"none"}:{border:"1px solid "+y.formInputBorderSelected,boxShadow:"0 1px 2px "+y.formInputBorderSelected}},cursor:l?"pointer":"default",...o&&{visibility:"hidden"}},disabled:r||o,onEdit:()=>c(n,"cleared"),onSelect:m,children:d.createElement(u.Icon,{style:{width:13,height:13,color:p,marginTop:i==="due"?-1:0}})})})}function Ce({value:n,id:t,width:s,alignItems:i,marginLeft:o,marginRight:r,icon:c,onClick:a}){const l={whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",color:y.tableHeaderText,fontWeight:300,marginLeft:o,marginRight:r};return e.jsx(et,{width:s,name:t,alignItems:i,value:n,style:{borderTopWidth:0,borderBottomWidth:0},unexposedContent:({value:u})=>a?e.jsxs(K,{variant:"bare",onPress:a,style:l,children:[e.jsx(vn,{value:u}),c==="asc"&&e.jsx(no,{width:10,height:10,style:{marginLeft:5}}),c==="desc"&&e.jsx(so,{width:10,height:10,style:{marginLeft:5}})]}):e.jsx(se,{style:l,children:u})})}const Ao=(n,t,s)=>d.useMemo(()=>{if(!t)return null;const{counts:i,mostCommonPayeeTransaction:o}=t?.reduce(({counts:a,...l},u)=>u.payee&&(a[u.payee]=(a[u.payee]||0)+1,a[u.payee]>l.maxCount)?{counts:a,maxCount:a[u.payee],mostCommonPayeeTransaction:u}:{counts:a,...l},{counts:{},maxCount:0,mostCommonPayeeTransaction:null})||{};if(!o)return"Split (no payee)";const r=Lt(n)[o.payee],c=Object.keys(i).length;return Wn(o,r,s[o.id],c-1)},[t,n,s]);function Ro({id:n,payee:t,focused:s,payees:i,accounts:o,transferAccountsByTransaction:r,valueStyle:c,transaction:a,subtransactions:l,importedPayee:u,isPreview:p,onEdit:m,onUpdate:j,onCreatePayee:g,onManagePayees:b,onNavigateToTransferAccount:S,onNavigateToSchedule:f}){const M=d.useRef(!1),w=Ue(),k=Ao(i,l,r),E=r[a.id];return a.is_parent?e.jsx(Oe,{name:"payee",width:"flex",focused:s,style:{padding:0},plain:!0,children:e.jsx(Ht,{bare:!0,style:{alignSelf:"flex-start",borderRadius:4,border:"1px solid transparent",":hover":p?{}:{border:"1px solid "+y.buttonNormalBorder}},disabled:p,onSelect:()=>w(Ee("payee-autocomplete",{onSelect:B=>{j("payee",B)}})),children:e.jsxs(x,{style:{flexDirection:"row",alignItems:"center",alignSelf:"stretch",borderRadius:4,flex:1,padding:4,color:y.pageTextSubdued},children:[e.jsx(un,{transaction:a,transferAccount:E,onNavigateToTransferAccount:S,onNavigateToSchedule:f}),e.jsx(la,{style:{color:"inherit",width:14,height:14,marginRight:5}}),e.jsx(se,{style:{fontStyle:"italic",fontWeight:300,userSelect:"none",borderBottom:u?`1px dashed ${y.pageTextSubdued}`:"none"},children:u?e.jsx(an,{content:e.jsxs(x,{style:{padding:10},children:[e.jsx(se,{style:{fontWeight:"bold"},children:"Imported Payee"}),e.jsx(se,{style:{fontWeight:"normal"},children:u})]}),style:{...pe.tooltip,borderRadius:"0px 5px 5px 0px"},placement:"bottom",triggerProps:{delay:750},children:k}):k})]})})}):e.jsx(et,{width:"flex",name:"payee",textAlign:"flex",value:t?.id,valueStyle:c,exposed:s,onExpose:B=>!p&&m(n,B),onUpdate:async B=>{if(j("payee",B),B&&B.startsWith("new:")&&!M.current){M.current=!0;const N=await g(B.slice(4));j("payee",N),M.current=!1}},formatter:()=>Wn(a,t,E),unexposedContent:B=>{const N=e.jsx(vn,{...B,style:u?{borderBottom:`1px dashed ${y.pageTextSubdued}`}:{}});return e.jsxs(e.Fragment,{children:[e.jsx(un,{transaction:a,transferAccount:E,onNavigateToTransferAccount:S,onNavigateToSchedule:f}),u?e.jsx(an,{content:e.jsxs(x,{style:{padding:10},children:[e.jsx(se,{style:{fontWeight:"bold"},children:"Imported Payee"}),e.jsx(se,{style:{fontWeight:"normal"},children:u})]}),style:{...pe.tooltip,borderRadius:"0px 5px 5px 0px"},placement:"bottom",triggerProps:{delay:750},children:N}):N]})},children:({onBlur:B,onKeyDown:N,onUpdate:W,onSave:I,shouldSaveFromKey:A,inputStyle:C})=>e.jsx(da,{payees:i,accounts:o,value:t?.id,shouldSaveFromKey:A,inputProps:{onBlur:B,onKeyDown:N,style:C},showManagePayees:!0,clearOnBlur:!1,focused:!0,onUpdate:(O,G)=>W?.(G),onSelect:I,onManagePayees:()=>b(t?.id)})})}function un({transaction:n,transferAccount:t,onNavigateToTransferAccount:s,onNavigateToSchedule:i}){const o=n.schedule,r=Bn(),c=o&&r?r.schedules.find(m=>m.id===o):null,a=d.useMemo(()=>({marginLeft:-5,marginRight:2,width:23,height:23,color:"inherit"}),[]),l=d.useMemo(()=>({width:13,height:13}),[]),u=d.useMemo(()=>({width:10,height:10}),[]);if(c==null&&t==null)return null;const p=c&&c._date&&!!c._date.frequency;return e.jsxs(e.Fragment,{children:[c&&e.jsx(K,{variant:"bare","aria-label":"See schedule details",style:a,onPress:()=>{i(o)},children:p?e.jsx(ua,{style:l}):e.jsx(ha,{style:l})}),t&&e.jsx(K,{variant:"bare","aria-label":"See transfer account",style:a,onPress:()=>{fe(n.id)||s(t.id)},children:(n._inverse?-1:1)*n.amount>0?e.jsx(to,{style:u}):e.jsx(fa,{style:u})})]})}const Gn=d.memo(function({allTransactions:t,transaction:s,subtransactions:i,transferAccountsByTransaction:o,editing:r,showAccount:c,showBalance:a,showCleared:l,showZeroInDeposit:u,style:p,selected:m,highlighted:j,added:g,matched:b,expanded:S,focusedField:f,categoryGroups:M,payees:w,accounts:k,balance:E,dateFormat:B="MM/dd/yyyy",hideFraction:N,onSave:W,onEdit:I,onDelete:A,onDuplicate:C,onLinkSchedule:O,onUnlinkSchedule:G,onCreateRule:Y,onScheduleAction:q,onMakeAsNonSplitTransactions:$,onSplit:oe,onManagePayees:ne,onCreatePayee:U,onToggleSplit:h,onNavigateToTransferAccount:D,onNavigateToSchedule:R,onNotesTagClick:P,splitError:z,listContainerRef:J}){const he=Ue(),v=Sn(),L=d.useRef(null),[_,V]=d.useState(u),[te,ue]=d.useState(s),[Q,Se]=d.useState(()=>wt(s,u)),H=Te(Q.id);(s!==te||u!==_)&&(Se(wt(s,u)),ue(s),V(u));const[Z,be]=d.useState(!1);function ie(T,ee){Q[T]!==ee&&(Q.reconciled===!0&&(T==="credit"||T==="debit"||T==="payee"||T==="account"||T==="date")?Z===!1&&(be(!0),he(Ee("confirm-transaction-edit",{onCancel:()=>{be(!1)},onConfirm:()=>{be(!1),ce(T,ee)},confirmReason:"editReconciled"}))):ce(T,ee)),T==="cleared"&&Q.reconciled&&he(Ee("confirm-transaction-edit",{onConfirm:()=>{ce("reconciled",!1)},confirmReason:"unlockReconciled"}))}function ce(T,ee){const ye={...Q,[T]:ee};if(!(T==="note"&&ee===""&&Q.note==null))if(T==="account"&&ee&&Je(k)[ee].offbudget&&(ye.category=null),T==="credit"?ye.debit="":T==="debit"&&(ye.credit=""),T==="account"&&Q.account!==ee&&(ye.reconciled=!1),T==="payee"&&ee&&ee.startsWith("new:"))Se(ye);else{const Re=To(ye,s);Se(wt(Re,u));const _e=["credit","debit"].includes(T)?"amount":T;W(Re,i,_e)}}const{id:F,amount:Be,debit:ge,credit:Le,payee:We,imported_payee:Ge,notes:Fe,date:Ke,account:me,category:xe,cleared:st,reconciled:Ye,is_parent:Ne,_unmatched:gt=!1,_inverse:$e=!1}=Q,at=w&&We&&Lt(w)[We],ot=k&&me&&Je(k)[me],ae=Q.is_child,it=fe(F)?Je(k)[at?.transfer_acct]:o[F],Qt=it&&it.offbudget===0,zt=ot&&ot.offbudget===1,Ae=g?{fontWeight:600}:null,Vt=f==="select",mt=N?{letterSpacing:-.5}:null,xt=fe(F)?E+($e?-1:1)*Be:E,[zn,Vn]=d.useState(1);d.useEffect(()=>{z&&setTimeout(()=>{Vn(T=>T+1)},1)},[z,t]);const[qn,yt]=d.useState(!1),[Zn,Kn]=d.useState(0),[Yn,Xn]=d.useState(0),Jn=nt("contextMenus");return e.jsxs(De,{ref:L,style:{backgroundColor:m?y.tableRowBackgroundHighlight:Vt?y.tableRowBackgroundHover:y.tableBackground,":hover":!(Vt||m)&&{backgroundColor:y.tableRowBackgroundHover},"& .hover-visible":{opacity:0},":hover .hover-visible":{opacity:1},...j||m?{color:y.tableRowBackgroundHighlightText}:{color:y.tableText},...p,...H&&{color:y.tableTextInactive,fontStyle:"italic"},...gt&&{opacity:.5}},onContextMenu:T=>{if(!Jn||Q.id==="temp")return;T.preventDefault();const ee=T.currentTarget.getBoundingClientRect();Kn(T.clientX-ee.left),Xn(T.clientY-ee.bottom),yt(!0)},children:[e.jsx(ve,{triggerRef:L,placement:"bottom start",isOpen:qn,onOpenChange:()=>yt(!1),crossOffset:Zn,offset:Yn,style:{width:200,margin:1},isNonModal:!0,children:e.jsx(Co,{transaction:Q,onDelete:()=>A?.(Q.id),onDuplicate:()=>C?.(Q.id),onLinkSchedule:()=>O?.(Q.id),onUnlinkSchedule:()=>G?.(Q.id),onCreateRule:()=>Y?.(Q.id),onScheduleAction:T=>q?.(T,Q.id),onMakeAsNonSplitTransactions:()=>$?.(Q.id),closeMenu:()=>yt(!1)})}),z&&J.current&&e.jsx(ve,{arrowSize:zn,triggerRef:L,isOpen:!0,isNonModal:!0,style:{width:375,padding:5,maxHeight:"38px !important"},shouldFlip:!1,placement:"bottom end",UNSTABLE_portalContainer:J.current,children:z}),ae&&e.jsx(sn,{width:110,style:{width:110,backgroundColor:y.tableRowBackgroundHover,border:0}}),ae&&c&&e.jsx(sn,{style:{flex:1,backgroundColor:y.tableRowBackgroundHover,border:0}}),fe(Q.id)?ae?e.jsx(Js,{onDelete:()=>A&&A(Q.id),exposed:r,style:{...ae&&{borderLeftWidth:1},lineHeight:0}}):e.jsx(Oe,{width:20}):H&&ae?e.jsx(Oe,{width:20}):e.jsx(jn,{exposed:!0,buttonProps:{className:m||r?null:"hover-visible"},focused:f==="select",onSelect:T=>{v({type:"select",id:Q.id,isRangeSelect:T.shiftKey})},onEdit:()=>I(F,"select"),selected:m,style:{...ae&&{borderLeftWidth:1}},value:b&&e.jsx(co,{style:{width:13,height:13,color:"inherit"}})}),!ae&&e.jsx(et,{name:"date",width:110,textAlign:"flex",exposed:f==="date",value:Ke,valueStyle:Ae,formatter:T=>T?ea(Tn(T),B):"",onExpose:T=>!H&&I(F,T),onUpdate:T=>{ie("date",T)},children:({onBlur:T,onKeyDown:ee,onUpdate:ye,onSave:Re,shouldSaveFromKey:_e,inputStyle:Xe})=>e.jsx(ta,{value:Ke||"",dateFormat:B,inputProps:{onBlur:T,onKeyDown:ee,style:Xe},shouldSaveFromKey:_e,clearOnBlur:!0,onUpdate:ye,onSelect:Re})}),!ae&&c&&e.jsx(et,{name:"account",width:"flex",textAlign:"flex",value:me,formatter:T=>{const ee=T&&Je(k)[T];return ee?ee.name:""},valueStyle:Ae,exposed:f==="account",onExpose:T=>!H&&I(F,T),onUpdate:async T=>{T&&ie("account",T)},children:({onBlur:T,onKeyDown:ee,onUpdate:ye,onSave:Re,shouldSaveFromKey:_e,inputStyle:Xe})=>e.jsx(na,{includeClosedAccounts:!1,value:me,accounts:k,shouldSaveFromKey:_e,clearOnBlur:!1,focused:!0,inputProps:{onBlur:T,onKeyDown:ee,style:Xe},onUpdate:ye,onSelect:Re,menuPortalTarget:void 0})}),e.jsx(Ro,{id:F,payee:at,focused:f==="payee",accounts:k.filter(T=>T.id!==me),payees:w.filter(T=>!T.transfer_acct||T.transfer_acct!==me),valueStyle:Ae,transaction:Q,subtransactions:i,transferAccountsByTransaction:o,importedPayee:Ge,isPreview:H,onEdit:I,onUpdate:ie,onCreatePayee:U,onManagePayees:ne,onNavigateToTransferAccount:D,onNavigateToSchedule:R}),e.jsx(Ve,{width:"flex",name:"notes",textAlign:"flex",exposed:f==="notes",focused:f==="notes",value:Fe||"",valueStyle:Ae,formatter:T=>Do(T,P),onExpose:T=>!H&&I(F,T),inputProps:{value:Fe||"",onUpdate:ie.bind(null,"notes")}}),H&&!ae||Ne?e.jsxs(Oe,{name:"category",width:"flex",focused:f==="category",style:{padding:0,flexDirection:"row",alignItems:"center",justifyContent:"flex-start",height:"100%"},plain:!0,children:[H&&e.jsx(x,{style:{color:xe==="missed"?y.errorText:xe==="due"?y.warningText:m?y.formLabelText:y.upcomingText,backgroundColor:xe==="missed"?y.errorBackground:xe==="due"?y.warningBackground:m?y.formLabelBackground:y.upcomingBackground,margin:"0 5px",padding:"3px 7px",borderRadius:4},children:sa(xe)}),e.jsx(Ht,{bare:!0,style:{borderRadius:4,border:"1px solid transparent",":hover":{border:"1px solid "+y.buttonNormalBorder}},disabled:fe(Q.id),onEdit:()=>!H&&I(F,"category"),onSelect:()=>h(F),children:e.jsxs(x,{style:{flexDirection:"row",alignItems:"center",alignSelf:"stretch",borderRadius:4,flex:1,padding:4,color:y.pageTextSubdued},children:[Ne&&e.jsx(Mt,{style:{color:"inherit",width:14,height:14,transition:"transform .08s",transform:S?"rotateZ(0)":"rotateZ(-90deg)"}}),!H&&e.jsx(se,{style:{fontStyle:"italic",fontWeight:300,userSelect:"none"},children:"Split"})]})})]}):Qt||zt?e.jsx(Ve,{name:"category",width:"flex",exposed:f==="category",focused:f==="category",onExpose:T=>I(F,T),value:Ne?"Split":zt?"Off Budget":Qt?"Transfer":"",valueStyle:Ae,style:{fontStyle:"italic",color:y.pageTextSubdued,fontWeight:300},inputProps:{readOnly:!0,style:{fontStyle:"italic"}}}):e.jsx(et,{name:"category",width:"flex",textAlign:"flex",value:xe,formatter:T=>T?ko(aa(M)[T],"name"):Q.id?"Categorize":"",exposed:f==="category",onExpose:T=>!H&&I(F,T),valueStyle:xe?Ae:{fontStyle:"italic",fontWeight:300,color:y.formInputTextHighlight},onUpdate:async T=>{T==="split"?oe(Q.id):ie("category",T)},children:({onBlur:T,onKeyDown:ee,onUpdate:ye,onSave:Re,shouldSaveFromKey:_e,inputStyle:Xe})=>e.jsx(At.Provider,{value:Rt(oa(Q.date)),children:e.jsx(ia,{categoryGroups:M,value:xe,focused:!0,clearOnBlur:!1,showSplitOption:!ae&&!Ne,shouldSaveFromKey:_e,inputProps:{onBlur:T,onKeyDown:ee,style:Xe},onUpdate:ye,onSelect:Re,menuPortalTarget:void 0,showHiddenCategories:!1})})}),e.jsx(Ve,{type:"input",width:100,name:"debit",exposed:f==="debit",focused:f==="debit",value:ge===""&&Le===""?"0.00":ge,valueStyle:Ae,textAlign:"right",title:ge,onExpose:T=>!H&&I(F,T),style:{...Ne&&{fontStyle:"italic"},...pe.tnum,...mt},inputProps:{value:ge===""&&Le===""?"0.00":ge,onUpdate:ie.bind(null,"debit")},privacyFilter:{activationFilters:[!fe(Q.id)]}}),e.jsx(Ve,{type:"input",width:100,name:"credit",exposed:f==="credit",focused:f==="credit",value:Le,valueStyle:Ae,textAlign:"right",title:Le,onExpose:T=>!H&&I(F,T),style:{...Ne&&{fontStyle:"italic"},...pe.tnum,...mt},inputProps:{value:Le,onUpdate:ie.bind(null,"credit")},privacyFilter:{activationFilters:[!fe(Q.id)]}}),a&&e.jsx(Oe,{name:"balance",value:xt==null||ae?"":ut(xt),valueStyle:{color:xt<0?y.errorText:y.noticeTextLight},style:{...pe.tnum,...mt},width:103,textAlign:"right",privacyFilter:!0}),l&&e.jsx(Bo,{id:F,focused:f==="cleared",selected:m,isPreview:H,status:H?xe:Ye?"reconciled":st?"cleared":null,isChild:ae,onEdit:I,onUpdate:ie}),e.jsx(Oe,{width:5})]})});function $n({error:n,isDeposit:t,onAddSplit:s,onDistributeRemainder:i,style:o,canDistributeRemainder:r}){switch(n.type){case"SplitTransactionError":if(n.version===1)return e.jsxs(x,{style:{flexDirection:"row",alignItems:"center",padding:"0 5px",...o},"data-testid":"transaction-error",children:[e.jsxs(se,{children:["Amount left:"," ",e.jsx(se,{style:{fontWeight:500},children:ut(t?n.difference:-n.difference)})]}),e.jsx(x,{style:{flex:1}}),e.jsx(K,{variant:"normal",style:{marginLeft:15},onPress:i,"data-testid":"distribute-split-button",isDisabled:!r,children:"Distribute"}),e.jsx(K,{variant:"primary",style:{marginLeft:10,padding:"4px 10px"},onPress:s,"data-testid":"add-split-button",children:"Add Split"})]});break;default:return null}}function St(n,t,s){return[{id:"temp",date:s||_t(),account:n||null,category:t||null,cleared:!1,amount:null}]}function Mo({transactions:n,accounts:t,categoryGroups:s,payees:i,transferAccountsByTransaction:o,editingTransaction:r,focusedField:c,showAccount:a,showCategory:l,showBalance:u,showCleared:p,dateFormat:m,hideFraction:j,onClose:g,onSplit:b,onEdit:S,onDelete:f,onSave:M,onAdd:w,onAddSplit:k,onDistributeRemainder:E,onManagePayees:B,onCreatePayee:N,onNavigateToTransferAccount:W,onNavigateToSchedule:I,onNotesTagClick:A,balance:C}){const O=n[0].error,G=n[0].amount>0,Y=n.filter($=>$.parent_id===n[0].id),q=Y.filter($=>$.amount===0);return e.jsxs(x,{style:{borderBottom:"1px solid "+y.tableBorderHover,paddingBottom:6,backgroundColor:y.tableBackground},"data-testid":"new-transaction",onKeyDown:$=>{$.key==="Escape"&&g()},children:[n.map($=>e.jsx(Gn,{isNew:!0,editing:r===$.id,transaction:$,subtransactions:$.is_parent?Y:null,transferAccountsByTransaction:o,showAccount:a,showCategory:l,showBalance:u,showCleared:p,focusedField:r===$.id&&c,showZeroInDeposit:G,accounts:t,categoryGroups:s,payees:i,dateFormat:m,hideFraction:j,expanded:!0,onEdit:S,onSave:M,onSplit:b,onDelete:f,onAdd:w,onManagePayees:B,onCreatePayee:N,style:{marginTop:-1},onNavigateToTransferAccount:W,onNavigateToSchedule:I,onNotesTagClick:A,balance:C},$.id)),e.jsxs(x,{style:{flexDirection:"row",alignItems:"center",justifyContent:"flex-end",marginTop:6,marginRight:20},children:[e.jsx(K,{style:{marginRight:10,padding:"4px 10px"},onPress:()=>g(),"data-testid":"cancel-button",children:"Cancel"}),O?e.jsx($n,{error:O,isDeposit:G,onAddSplit:()=>k(n[0].id),onDistributeRemainder:()=>E(n[0].id),canDistributeRemainder:q.length>0}):e.jsx(K,{variant:"primary",style:{padding:"4px 10px"},onPress:w,"data-testid":"add-button",children:"Add"})]})]})}function Io({tableNavigator:n,tableRef:t,listContainerRef:s,dateFormat:i="MM/dd/yyyy",newNavigator:o,renderEmpty:r,onScroll:c,...a}){const l=d.createRef(),u=Ys(a.isAdding),[p,m]=d.useState(0);function j(w,k){const E=w>0&&k>0&&w-k;m(E||0)}const g=d.useCallback(w=>{a.onCloseAddTransaction(),a.onNavigateToTransferAccount(w)},[a.onCloseAddTransaction,a.onNavigateToTransferAccount]),b=d.useCallback(w=>{a.onCloseAddTransaction(),a.onNavigateToSchedule(w)},[a.onCloseAddTransaction,a.onNavigateToSchedule]),S=d.useCallback(w=>{a.onCloseAddTransaction(),a.onNotesTagClick(w)},[a.onCloseAddTransaction,a.onNotesTagClick]);d.useEffect(()=>{!u&&a.isAdding&&o.onEdit("temp","date")},[u,a.isAdding,o]);const f=d.useMemo(()=>a.showReconciled?a.transactions:a.transactions.filter(w=>!w.reconciled),[a.transactions,a.showReconciled]),M=({item:w,index:k,editing:E})=>{const{transactions:B,selectedItems:N,accounts:W,categoryGroups:I,payees:A,showCleared:C,showAccount:O,showCategory:G,showBalances:Y,balances:q,hideFraction:$,isNew:oe,isMatched:ne,isExpanded:U}=a,h=w,D=N.has(h.id),R=a.transactionMap.get(h.parent_id),P=R&&R.amount>0,z=U&&U((R||h).id),J=z&&R&&R.error||h.error,he=(!z||On(B,k))&&J&&J.type==="SplitTransactionError",v=h.is_parent?a.transactionsByParent[h.id]:null,L=a.transactionsByParent[h.is_parent?h.id:h.parent_id]?.filter(_=>_.amount===0);return e.jsx(Gn,{allTransactions:a.transactions,editing:E,transaction:h,transferAccountsByTransaction:a.transferAccountsByTransaction,subtransactions:v,showAccount:O,showCategory:G,showBalance:Y,showCleared:C,selected:D,highlighted:!1,added:oe?.(h.id),expanded:U?.(h.id),matched:ne?.(h.id),showZeroInDeposit:P,balance:q?.[h.id]?.balance,focusedField:E&&n.focusedField,accounts:W,categoryGroups:I,payees:A,dateFormat:i,hideFraction:$,onEdit:n.onEdit,onSave:a.onSave,onDelete:a.onDelete,onDuplicate:a.onDuplicate,onLinkSchedule:a.onLinkSchedule,onUnlinkSchedule:a.onUnlinkSchedule,onCreateRule:a.onCreateRule,onScheduleAction:a.onScheduleAction,onMakeAsNonSplitTransactions:a.onMakeAsNonSplitTransactions,onSplit:a.onSplit,onManagePayees:a.onManagePayees,onCreatePayee:a.onCreatePayee,onToggleSplit:a.onToggleSplit,onNavigateToTransferAccount:g,onNavigateToSchedule:b,onNotesTagClick:S,splitError:he&&e.jsx($n,{error:J,isDeposit:P,onAddSplit:()=>a.onAddSplit(h.id),onDistributeRemainder:()=>a.onDistributeRemainder(h.id),canDistributeRemainder:L.length>0}),listContainerRef:s})};return e.jsxs(x,{innerRef:l,style:{flex:1,cursor:"default",...a.style},children:[e.jsxs(x,{children:[e.jsx(Un,{hasSelected:a.selectedItems.size>0,showAccount:a.showAccount,showCategory:a.showCategory,showBalance:a.showBalances,showCleared:a.showCleared,scrollWidth:p,onSort:a.onSort,ascDesc:a.ascDesc,field:a.sortField}),a.isAdding&&e.jsx(x,{...o.getNavigatorProps({onKeyDown:w=>a.onCheckNewEnter(w)}),children:e.jsx(Mo,{transactions:a.newTransactions,transferAccountsByTransaction:a.transferAccountsByTransaction,editingTransaction:o.editingId,focusedField:o.focusedField,accounts:a.accounts,categoryGroups:a.categoryGroups,payees:a.payees||[],showAccount:a.showAccount,showCategory:a.showCategory,showBalance:a.showBalances,showCleared:a.showCleared,dateFormat:i,hideFraction:a.hideFraction,onClose:a.onCloseAddTransaction,onAdd:a.onAddTemporary,onAddSplit:a.onAddSplit,onSplit:a.onSplit,onEdit:o.onEdit,onSave:a.onSave,onDelete:a.onDelete,onManagePayees:a.onManagePayees,onCreatePayee:a.onCreatePayee,onNavigateToTransferAccount:g,onNavigateToSchedule:b,onNotesTagClick:S,onDistributeRemainder:a.onDistributeRemainder,balance:a.transactions?.length>0?a.balances?.[a.transactions[0]?.id]?.balance:0})})]}),e.jsxs(x,{style:{flex:1,overflow:"hidden"},"data-testid":"transaction-table",children:[e.jsx(Xs,{navigator:n,ref:t,listContainerRef:s,items:f,renderItem:M,renderEmpty:r,loadMore:a.loadMoreTransactions,isSelected:w=>a.selectedItems.has(w),onKeyDown:w=>a.onCheckEnter(w),onScroll:c,saveScrollWidth:j}),a.isAdding&&e.jsx("div",{style:{position:"absolute",top:-20,left:0,right:0,height:20,backgroundColor:y.errorText,boxShadow:"0 0 6px rgba(0, 0, 0, .20)"}},"shadow")]})]})}const Qn=d.forwardRef((n,t)=>{const[s,i]=d.useState(null),[o,r]=d.useState(!1),c=$t(),a=d.useRef(null),l=d.useRef(null),u=d.useRef(null),p=qs(l,t),m=d.useMemo(()=>{let v;if(c.state.transitionId!=null){const L=n.transactions.findIndex(_=>_.id===c.state.transitionId);v=n.transactions.filter((_,V)=>{if(_.parent_id){if(V>=L)return c.expanded(_.parent_id);if(a.current)return a.current.expanded(_.parent_id)}return!0})}else a.current&&a.current.state.transitionId!=null&&(l.current.anchor(),l.current.setRowAnimation(!1)),a.current=c,v=n.transactions.filter(L=>L.parent_id?c.expanded(L.parent_id):!0);return a.current=c,v},[n.transactions,c]),j=d.useMemo(()=>new Map(m.map(v=>[v.id,v])),[m]),g=d.useMemo(()=>n.transactions.reduce((v,L)=>(L.is_child&&(v[L.parent_id]=[...v[L.parent_id]??[],L]),v),{}),[n.transactions]),b=d.useMemo(()=>{if(!n.accounts)return{};const v=Je(n.accounts),L=Lt(n.payees);return Object.fromEntries(n.transactions.map(_=>{if(!n.accounts)return[_.id,null];const V=_.payee&&L[_.payee];let te;return _._inverse?te=_.account&&v[_.account]:te=V?.transfer_acct&&v[V.transfer_acct],[_.id,te||null]}))},[n.transactions,n.payees,n.accounts]);d.useEffect(()=>{l.current.isAnchored()&&(l.current.unanchor(),l.current.setRowAnimation(!0))},[a.current]);const S=nn(s,I),f=nn(m,I),M=d.useRef(!1),w=d.useRef({newTransactions:s,newNavigator:S,tableNavigator:f}),k=d.useRef(!1),E=d.useRef(!1),[B,N]=d.useState({}),W=Ft();d.useLayoutEffect(()=>{w.current={newTransactions:s,newNavigator:S,tableNavigator:f,transactions:n.transactions}}),o!==n.isAdding&&(!o&&n.isAdding&&i(St(n.currentAccountId,n.currentCategoryId)),r(n.isAdding)),d.useEffect(()=>{if(M.current){if(s[0].account==null)n.addNotification({type:"error",message:"Account is a required field"}),S.onEdit("temp","account");else{const v=w.current.newTransactions,L=v.length>0?v[0].date:null;i(St(n.currentAccountId,n.currentCategoryId,L)),S.onEdit("temp","date"),n.onAdd(v)}M.current=!1}}),d.useEffect(()=>{k.current&&E.current&&(E.current(n),E.current=null),k.current=!1},[s,n.transactions]);function I(v){let L=["select","date","account","payee","notes","category","debit","credit","cleared"];return L=v.is_child?["select","payee","notes","category","debit","credit"]:L.filter(_=>(n.showAccount||_!=="account")&&(n.showCategory||_!=="category")),Te(v.id)&&(L=["select"]),fe(v.id)&&(L=L.slice(1)),L}function A(v){k.current?E.current=v:v(n)}function C(v){if(v.key==="Enter"){if(v.metaKey)v.stopPropagation(),G();else if(!v.shiftKey){let L=function(_){const{newTransactions:V}=_.current;return V[V.length-1]};S.editingId===L(w).id&&v.stopPropagation(),A(()=>{const _=L(w),V=_.parent_id||_.is_parent;w.current.newTransactions[0].error&&S.editingId===_.id?P(_.id):S.editingId===_.id&&(!V||!_.error)&&G()})}}}function O(v){if(v.key==="Enter"&&!v.shiftKey){const{editingId:L,focusedField:_}=f;A(()=>{const V=w.current.transactions,te=V.findIndex(Q=>Q.id===L),ue=V.find(Q=>Q.id===V[te]?.parent_id);On(V,te)&&ue&&ue.error&&_!=="select"&&(v.stopPropagation(),P(L))})}}const G=d.useCallback(()=>{M.current=!0,N({})},[n.onAdd,S.onEdit]),Y=d.useCallback(async(v,L=null,_=null)=>{k.current=!0;let V=L?Zs([v,...L]):v;if(fe(v.id)){n.onApplyRules&&(V=await n.onApplyRules(V,_));const te=w.current.newTransactions;i(ze(Nt(te,V).data))}else n.onSave(V)},[n.onSave]),q=d.useCallback(v=>{if(fe(v)){const _=w.current.newTransactions;if(v===_[0].id)return;i(Ks(_,v).data)}else n.onBatchDelete([v])},[]),$=d.useCallback(v=>{n.onBatchDuplicate([v])},[]),oe=d.useCallback(v=>{n.onBatchLinkSchedule([v])},[]),ne=d.useCallback(v=>{n.onBatchUnlinkSchedule([v])},[]),U=d.useCallback(v=>{n.onCreateRule([v])},[]),h=d.useCallback((v,L)=>{n.onScheduleAction(v,[L])},[]),D=d.useCallback(v=>{n.onMakeAsNonSplitTransactions([v])},[]),R=d.useMemo(()=>v=>{if(fe(v)){const{newNavigator:L}=w.current,_=w.current.newTransactions,{data:V,diff:te}=Cn(_,v);i(V),_[0].amount===null?L.onEdit(_[0].id,"debit"):L.onEdit(te.added[0].id,w.current.newNavigator.focusedField)}else{const L=w.current.transactions.find(te=>te.id===v),_=n.onSplit(v);c.dispatch({type:"open-split",id:L.id});const{tableNavigator:V}=w.current;L.amount===null?V.onEdit(L.id,"debit"):V.onEdit(_,V.focusedField)}},[n.onSplit,c.dispatch]),P=d.useCallback(v=>{if(fe(v)){const L=w.current.newTransactions,{data:_,diff:V}=kn(L,v);i(_),S.onEdit(V.added[0].id,w.current.newNavigator.focusedField)}else{const L=n.onAddSplit(v);f.onEdit(L,w.current.tableNavigator.focusedField)}},[n.onAddSplit]),z=d.useCallback(async v=>{const{transactions:L,tableNavigator:_,newTransactions:V}=w.current,te=fe(v)?V:L,ue=te.find(F=>F.id===v),Q=ue.is_parent?ue:te.find(F=>F.id===ue.parent_id),Se=te.filter(F=>F.parent_id===(ue.is_parent?ue.id:ue.parent_id)),H=Se.filter(F=>F.amount===0),Z=Q.amount-Se.reduce((F,Be)=>F+Be.amount,0),be=Math.floor(Z/H.length);let ie=Z-be*H.length;const ce=new Array(H.length).fill(be);for(const F in ce){if(ie===0)break;ce[F]+=1,ie--}fe(v)?S.onEdit(null):_.onEdit(null);for(const F in H)await Y({...H[F],amount:ce[F]})},[w]);function J(){i(St(n.currentAccountId,n.currentCategoryId)),n.onCloseAddTransaction()}const he=d.useCallback(v=>c.dispatch({type:"toggle-split",id:v}),[c.dispatch]);return e.jsx(Io,{tableRef:p,listContainerRef:u,...n,transactions:m,transactionMap:j,transactionsByParent:g,transferAccountsByTransaction:b,selectedItems:W,isExpanded:c.expanded,onSave:Y,onDelete:q,onDuplicate:$,onLinkSchedule:oe,onUnlinkSchedule:ne,onCreateRule:U,onScheduleAction:h,onMakeAsNonSplitTransactions:D,onSplit:R,onCheckNewEnter:C,onCheckEnter:O,onAddTemporary:G,onAddSplit:P,onDistributeRemainder:z,onCloseAddTransaction:J,onToggleSplit:he,newTransactions:s,tableNavigator:f,newNavigator:S})});Qn.displayName="TransactionTable";function Do(n,t){const s=n.split(" ");return e.jsx(e.Fragment,{children:s.map((i,o,r)=>{const c=r.length-1===o?"":" ";if(i.includes("#")&&i.length>1){let a=-1;return i.split("#").map((l,u)=>{if(u===0)return l;if(!l)return a=u,"#";if(a===u-1)return`${l} `;a=-1;const p=`#${l}`;return e.jsxs("span",{children:[e.jsx(K,{variant:"bare",className:xn({display:"inline-flex",padding:"3px 7px",borderRadius:16,userSelect:"none",backgroundColor:y.noteTagBackground,color:y.noteTagText,cursor:"pointer","&[data-hovered]":{backgroundColor:y.noteTagBackgroundHover}}),onPress:()=>{t?.(p)},children:p},o),c]},`${p}${u}`)})}return`${i}${c}`})})}async function kt(n){const t=await X("transactions-batch-update",{...n,learnCategories:!0});return t.length>0?{updates:t}:{}}async function jt(n,t,s){const i=await kt(n);s(ma(t.newTransaction,i),Rn(i,t.data))}function Po({tableRef:n,transactions:t,allTransactions:s,loadMoreTransactions:i,account:o,accounts:r,category:c,categoryGroups:a,payees:l,balances:u,showBalances:p,showReconciled:m,showCleared:j,showAccount:g,headerContent:b,isAdding:S,isNew:f,isMatched:M,isFiltered:w,dateFormat:k,hideFraction:E,addNotification:B,renderEmpty:N,onSort:W,sortField:I,ascDesc:A,onChange:C,onRefetch:O,onCloseAddTransaction:G,onCreatePayee:Y,onApplyFilter:q,onBatchDelete:$,onBatchDuplicate:oe,onBatchLinkSchedule:ne,onBatchUnlinkSchedule:U,onCreateRule:h,onScheduleAction:D,onMakeAsNonSplitTransactions:R}){const P=Ue(),z=d.useRef(),J=yn();d.useLayoutEffect(()=>{z.current=t},[t]);const he=d.useCallback(async H=>{H=An(H),await kt({added:H}),O()},[]),v=d.useCallback(async H=>{const Z=Nt(z.current,H);z.current=Z.data,Z.diff.updated.length>0&&(!!Z.diff.updated[0].date?(Z.diff.updated[0].sort_order=Date.now(),await kt(Z.diff),O()):(C(Z.newTransaction,Z.data),jt(Z.diff,Z,C)))},[]),L=d.useCallback(H=>{const Z=kn(z.current,H);return C(Z.newTransaction,Z.data),jt(Z.diff,Z,C),Z.diff.added[0].id},[]),_=d.useCallback(H=>{const Z=Cn(z.current,H);return C(Z.newTransaction,Z.data),jt(Z.diff,Z,C),Z.diff.added[0].id},[]),V=d.useCallback(async(H,Z=null)=>{const be=await X("rules-run",{transaction:H}),ie=ga(H,be),ce={...H};return ie&&(Object.keys(ie).forEach(F=>{(ce[F]==null||ce[F]===""||ce[F]===0||ce[F]===!1)&&(ce[F]=ie[F])}),H.is_parent&&ie.subtransactions!==void 0&&Z!==null&&(ce.subtransactions=ie.subtransactions.map((F,Be)=>({...ce.subtransactions[Be]||F,...F[Z]!=null&&{[Z]:F[Z]}})))),ce},[]),te=d.useCallback(H=>{J("/payees",{state:{selectedPayee:H}})}),ue=d.useCallback(H=>{J(`/accounts/${H}`)}),Q=d.useCallback(H=>{P(Ee("schedule-edit",{id:H}))}),Se=d.useCallback(H=>{q({field:"notes",op:"hasTags",value:H,type:"string"})});return e.jsx(Qn,{ref:n,transactions:s,loadMoreTransactions:i,accounts:r,categoryGroups:a,payees:l,balances:u,showBalances:p,showReconciled:m,showCleared:j,showAccount:g,showCategory:!0,currentAccountId:o&&o.id,currentCategoryId:c&&c.id,isAdding:S,isNew:f,isMatched:M,isFiltered:w,dateFormat:k,hideFraction:E,addNotification:B,headerContent:b,renderEmpty:N,onSave:v,onApplyRules:V,onSplit:_,onCloseAddTransaction:G,onAdd:he,onAddSplit:L,onManagePayees:te,onCreatePayee:Y,style:{backgroundColor:y.tableBackground},onNavigateToTransferAccount:ue,onNavigateToSchedule:Q,onNotesTagClick:Se,onSort:W,sortField:I,ascDesc:A,onBatchDelete:$,onBatchDuplicate:oe,onBatchLinkSchedule:ne,onBatchUnlinkSchedule:U,onCreateRule:h,onScheduleAction:D,onMakeAsNonSplitTransactions:R})}function Eo({filterId:n,onFilterMenuSelect:t}){const{t:s}=de();return e.jsx(we,{onMenuSelect:i=>{t(i)},items:n?.id?n?.id!==null&&n?.status==="saved"?[{name:"rename-filter",text:s("Rename")},{name:"delete-filter",text:s("Delete")},we.line,{name:"save-filter",text:s("Save new filter"),disabled:!0},{name:"clear-filter",text:s("Clear all conditions")}]:[{name:"rename-filter",text:s("Rename")},{name:"update-filter",text:s("Update condtions")},{name:"reload-filter",text:s("Revert changes")},{name:"delete-filter",text:s("Delete")},we.line,{name:"save-filter",text:s("Save new filter")},{name:"clear-filter",text:s("Clear all conditions")}]:[{name:"save-filter",text:s("Save new filter")},{name:"clear-filter",text:s("Clear all conditions")}]})}function Lo({menuItem:n,name:t,setName:s,adding:i,onAddUpdate:o,err:r}){const{t:c}=de(),a=d.useRef(null);return d.useEffect(()=>{a.current&&a.current.focus()},[]),e.jsxs(e.Fragment,{children:[n!=="update-filter"&&e.jsx(xa,{onSubmit:l=>{l.preventDefault(),o()},children:e.jsxs(ft,{direction:"row",justify:"flex-end",align:"center",style:{padding:10},children:[e.jsxs(ya,{style:{flex:1},children:[e.jsx(ba,{title:c("Filter Name"),htmlFor:"name-field",style:{userSelect:"none"}}),e.jsx(Ot,{id:"name-field",inputRef:a,defaultValue:t||"",onChangeValue:s})]}),e.jsx(K,{variant:"primary",type:"submit",style:{marginTop:18},children:c(i?"Add":"Update")})]})}),r&&e.jsx(ft,{direction:"row",align:"center",style:{padding:10},children:e.jsx(se,{style:{color:y.errorText},children:r})})]})}function Fo({conditions:n,conditionsOp:t,filterId:s,onClearFilters:i,onReloadSavedFilter:o,savedFilters:r}){const{t:c}=de(),[a,l]=d.useState(!1),[u,p]=d.useState(!1),[m,j]=d.useState(!1),g=d.useRef(null),[b,S]=d.useState(null),[f,M]=d.useState(""),[w,k]=d.useState(s?.name??""),E=s?.id;let B;const N=async I=>{switch(M(I),I){case"rename-filter":S(null),p(!1),j(!1),l(!0);break;case"delete-filter":j(!1),await X("filter-delete",E),i();break;case"update-filter":S(null),p(!1),j(!1),B={conditions:n,conditionsOp:t,id:s?.id,name:s?.name??"",status:"saved"};const A=await bt("filter-update",{state:B,filters:[...r]});if(A.error){S(A.error.message),l(!0);return}o(B,"update");break;case"save-filter":S(null),p(!0),j(!1),l(!0);break;case"reload-filter":j(!1),B={...B,status:"saved"},o(B,"reload");break;case"clear-filter":j(!1),i();break}};async function W(){if(u){const C={conditions:n,conditionsOp:t,name:w,status:"saved"},O=await bt("filter-create",{state:C,filters:[...r]});if(O.error){S(O.error.message),l(!0);return}l(!1),o({...C,id:O.data});return}const I={conditions:s?.conditions,conditionsOp:s?.conditionsOp,id:s?.id,name:w},A=await bt("filter-update",{state:I,filters:[...r]});if(A.error){S(A.error.message),l(!0);return}l(!1),o(I)}return e.jsxs(x,{children:[n.length>0&&e.jsxs(K,{ref:g,variant:"bare",style:{marginTop:10},onPress:()=>{j(!0)},children:[e.jsxs(se,{style:{maxWidth:150,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",flexShrink:0},children:[s?.id?s?.name:c("Unsaved filter")," "]}),s?.id&&s?.status!=="saved"&&e.jsxs(se,{children:[e.jsx(re,{children:"(modified)"})," "]}),e.jsx(gn,{width:8,height:8,style:{marginRight:5}})]}),e.jsx(ve,{triggerRef:g,isOpen:m,onOpenChange:()=>j(!1),style:{width:200},children:e.jsx(Eo,{filterId:s,onFilterMenuSelect:N})}),e.jsx(ve,{triggerRef:g,isOpen:a,onOpenChange:()=>l(!1),style:{width:325},children:e.jsx(Lo,{menuItem:f,name:w,setName:k,adding:u,onAddUpdate:W,err:b})})]})}function No({conditions:n,conditionsOp:t,onUpdateFilter:s,onDeleteFilter:i,onClearFilters:o,onReloadSavedFilter:r,filterId:c,savedFilters:a,onConditionsOpChange:l}){return e.jsx(x,{children:e.jsxs(ft,{spacing:2,direction:"row",justify:"flex-start",align:"flex-start",children:[e.jsx(Ja,{conditions:n,conditionsOp:t,onConditionsOpChange:l,onUpdate:s,onDelete:i}),e.jsx(x,{style:{flex:1}}),e.jsx(Fo,{conditions:n,conditionsOp:t,filterId:c,onClearFilters:o,onReloadSavedFilter:r,savedFilters:a})]})})}function _o({getTransaction:n,onShow:t,onDuplicate:s,onDelete:i,onEdit:o,onLinkSchedule:r,onUnlinkSchedule:c,onCreateRule:a,onSetTransfer:l,onScheduleAction:u,showMakeTransfer:p,onMakeAsSplitTransaction:m,onMakeAsNonSplitTransactions:j}){const{t:g}=de(),b=Ue(),S=Ft(),f=d.useMemo(()=>[...S],[S]),M=d.useMemo(()=>{const A=f;return{preview:!!A.find(C=>Te(C)),trans:!!A.find(C=>!Te(C))}},[f]),w=d.useMemo(()=>f.map(C=>n(C)).some(C=>C&&C.is_child),[f,n]),k=d.useMemo(()=>!M.preview&&f.every(A=>{const C=n(A);return C&&C.schedule}),[M.preview,f,n]),E=d.useMemo(()=>{if(f.length!==2)return!1;const A=n(f[0]),C=n(f[1]);return!A||!C?!1:_n(A,C)},[f,n]),B=d.useMemo(()=>{if(f.length<=1||M.preview)return!1;const A=f.map(q=>n(q)),[C]=A,O=A.every(q=>q&&q.date===C?.date&&q.account===C?.account),G=A.every(q=>q&&!q.is_parent&&!q.is_child),Y=A.every(q=>q&&!q.reconciled);return O&&G&&Y},[f,M,n]),N=d.useMemo(()=>{if(f.length===0||M.preview)return!1;const A=f.map(G=>n(G)),C=A.every(G=>G&&!G.reconciled),O=A.every(G=>G&&(G.is_parent||G.is_child));return C&&O},[f,M,n]);function W(){const A=f[0];let C;if(Te(A))C=A.split("/")[1];else{const O=n(A);C=O&&O.schedule}C&&b(Ee("schedule-edit",{id:C}))}const I={enabled:M.trans,scopes:["app"]};return le("f",()=>t(f),I,[t,f]),le("d",()=>i(f),I,[i,f]),le("a",()=>o("account",f),I,[o,f]),le("p",()=>o("payee",f),I,[o,f]),le("n",()=>o("notes",f),I,[o,f]),le("c",()=>o("category",f),I,[o,f]),le("l",()=>o("cleared",f),I,[o,f]),le("s",()=>!M.trans||k?W():r(f),{scopes:["app"]},[r,W,k,f]),e.jsx(wa,{id:"transactions",name:A=>g("{{count}} transactions",{count:A}),items:[...M.trans?[{name:"show",text:g("Show"),key:"F"},{name:"duplicate",text:g("Duplicate"),disabled:w},{name:"delete",text:g("Delete"),key:"D"},...k?[{name:"view-schedule",text:g("View schedule"),key:"S",disabled:f.length>1},{name:"unlink-schedule",text:g("Unlink schedule")}]:[{name:"link-schedule",text:g("Link schedule"),key:"S"},{name:"create-rule",text:g("Create rule")}],...p?[{name:"set-transfer",text:g("Make transfer"),disabled:!E}]:[],...B?[{name:"make-as-split-transaction",text:g("Make as split transaction")}]:[],...N?[{name:"unsplit-transactions",text:g("Unsplit {{count}} transactions",{count:f.length})}]:[],we.line,{type:we.label,name:g("Edit field"),text:""},{name:"date",text:g("Date")},{name:"account",text:g("Account"),key:"A"},{name:"payee",text:g("Payee"),key:"P"},{name:"notes",text:g("Notes"),key:"N"},{name:"category",text:g("Category"),key:"C"},{name:"amount",text:g("Amount")},{name:"cleared",text:g("Cleared"),key:"L"}]:[{name:"view-schedule",text:g("View schedule"),key:"S"},{name:"post-transaction",text:g("Post transaction")},{name:"skip",text:g("Skip scheduled date")}]],onSelect:A=>{switch(A){case"show":t(f);break;case"duplicate":s(f);break;case"delete":i(f);break;case"make-as-split-transaction":m(f);break;case"unsplit-transactions":j(f);break;case"post-transaction":case"skip":u(A,f);break;case"view-schedule":W();break;case"link-schedule":r(f);break;case"unlink-schedule":c(f);break;case"create-rule":a(f);break;case"set-transfer":l(f);break;default:o(A,f)}}})}function pt({name:n,balance:t,isExactBalance:s=!0}){const i=Ut();return e.jsxs(se,{style:{marginLeft:15,borderRadius:4,padding:"4px 6px",color:y.pillText,backgroundColor:y.pillBackground},children:[n," ",e.jsx(Ca,{children:e.jsxs(se,{style:{fontWeight:600},children:[!s&&"~ ",i(t,"financial")]})})]})}function Ho({selectedItems:n,account:t}){const{t:s}=de(),i=`selected-balance-${[...n].join("-")}`,o=qe({name:i,query:ke("transactions").filter({id:{$oneof:[...n]},parent_id:{$oneof:[...n]}}).select("id")}),r=new Set((o||[]).map(g=>g.id)),c=[...n].filter(g=>!r.has(g));let a=qe({name:i+"-sum",query:ke("transactions").filter({id:{$oneof:c}}).options({splits:"all"}).calculate({$sum:"$amount"})}),l=null;const u=Bn(),p=u?u.schedules:[],m=[...n].filter(g=>Te(g)).map(g=>g.slice(8));let j=!0;for(const g of p)m.includes(g.id)&&(g._amountOp==="isbetween"&&(j=!1),!t||t.id===g._account?l+=ht(g._amount):l-=ht(g._amount));if(a==null){if(l==null)return null;a=l}else l!=null&&(a+=l);return e.jsx(pt,{name:s("Selected balance:"),balance:a,isExactBalance:j})}function Oo({filteredAmount:n}){const{t}=de();return e.jsx(pt,{name:t("Filtered balance:"),balance:n||0,isExactBalance:!0})}function Uo({balanceQuery:n}){const{t}=de(),s=qe({name:n.name+"-cleared",query:n.query.filter({cleared:!0})}),i=qe({name:n.name+"-uncleared",query:n.query.filter({cleared:!1})});return e.jsxs(x,{style:{flexDirection:"row"},children:[e.jsx(pt,{name:t("Cleared total:"),balance:s}),e.jsx(pt,{name:t("Uncleared total:"),balance:i})]})}function Wo({balanceQuery:n,showExtraBalances:t,onToggleExtraBalances:s,account:i,isFiltered:o,filteredAmount:r}){const c=Ft(),a=d.useRef(null),l=Sa(a);return e.jsxs(x,{style:{flexDirection:"row",alignItems:"center",marginTop:-5,marginLeft:-5},children:[e.jsxs(K,{ref:a,"data-testid":"account-balance",variant:"bare",onPress:s,style:{paddingTop:1,paddingBottom:1},children:[e.jsx(ja,{binding:{...n,value:0},type:"financial",children:u=>e.jsx(va,{...u,style:{fontSize:22,fontWeight:400,color:u.value<0?y.errorText:u.value>0?y.noticeTextLight:y.pageTextSubdued}})}),e.jsx(ao,{style:{width:10,height:10,marginLeft:10,color:y.pillText,transform:t?"rotateZ(180deg)":"rotateZ(0)",opacity:l||c.size>0||t?1:0}})]}),t&&e.jsx(Uo,{balanceQuery:n}),c.size>0&&e.jsx(Ho,{selectedItems:c,account:i}),o&&e.jsx(Oo,{filteredAmount:r})]})}function Go({balanceQuery:n,targetBalance:t,onDone:s,onCreateTransaction:i}){const o=qe({name:n.name+"-cleared",value:0,query:n.query.filter({cleared:!0})}),r=Ut(),c=t-o,a=r(o,"financial"),l=r(t,"financial"),u=(c>0?"+":"")+r(c,"financial");return e.jsx(x,{style:{flexDirection:"row",alignSelf:"center",backgroundColor:y.tableBackground,...pe.shadow,borderRadius:4,marginTop:5,marginBottom:15,padding:10},children:e.jsxs(x,{style:{flexDirection:"row",alignItems:"center"},children:[c===0?e.jsxs(x,{style:{color:y.noticeTextLight,flex:1,flexDirection:"row",alignItems:"center",justifyContent:"center"},children:[e.jsx(ka,{style:{width:13,height:13,color:"inherit",marginRight:3}}),e.jsx(re,{children:"All reconciled!"})]}):e.jsx(x,{style:{color:y.tableText},children:e.jsx(se,{style:{fontStyle:"italic",textAlign:"center"},children:e.jsxs(re,{children:["Your cleared balance ",e.jsx("strong",{children:a})," needs"," ",e.jsx("strong",{children:u})," to match",e.jsx("br",{})," your bank's balance of"," ",e.jsx(se,{style:{fontWeight:700},children:l})]})})}),e.jsx(x,{style:{marginLeft:15},children:e.jsx(K,{variant:"primary",onPress:s,children:e.jsx(re,{children:"Done Reconciling"})})}),c!==0&&e.jsx(x,{style:{marginLeft:15},children:e.jsx(K,{onPress:()=>i(c),children:e.jsx(re,{children:"Create Reconciliation Transaction"})})})]})})}function $o({account:n,onReconcile:t,onClose:s}){const i=Ta(n),o=qe({name:i.name+"-cleared",value:null,query:i.query.filter({cleared:!0})}),r=Ut(),[c,a]=d.useState(null),[l,u]=d.useState(!1);function p(){if(c===""){u(!0);return}const m=c!=null?Ba(c):o;t(m),s()}return e.jsxs(x,{style:{padding:"5px 8px"},children:[e.jsx(se,{children:e.jsx(re,{children:"Enter the current balance of your bank account that you want to reconcile with:"})}),o!=null&&e.jsx(Mn,{children:e.jsx(Ot,{defaultValue:r(o,"financial"),onChangeValue:a,style:{margin:"7px 0"},focused:l,onEnter:p})}),e.jsx(K,{variant:"primary",onPress:p,children:e.jsx(re,{children:"Reconcile"})})]})}function Qo({tableRef:n,editingName:t,isNameEditable:s,workingHard:i,accountName:o,account:r,filterId:c,savedFilters:a,accountsSyncing:l,failedAccounts:u,accounts:p,transactions:m,showBalances:j,showExtraBalances:g,showCleared:b,showReconciled:S,showEmptyMessage:f,balanceQuery:M,reconcileAmount:w,canCalculateBalance:k,isFiltered:E,filteredAmount:B,isSorted:N,search:W,filterConditions:I,filterConditionsOp:A,onSearch:C,onAddTransaction:O,onShowTransactions:G,onDoneReconciling:Y,onCreateReconciliationTransaction:q,onToggleExtraBalances:$,onSaveName:oe,saveNameError:ne,onExposeName:U,onSync:h,onImport:D,onMenuSelect:R,onReconcile:P,onBatchDelete:z,onBatchDuplicate:J,onBatchEdit:he,onBatchLinkSchedule:v,onBatchUnlinkSchedule:L,onCreateRule:_,onApplyFilter:V,onUpdateFilter:te,onClearFilters:ue,onReloadSavedFilter:Q,onConditionsOpChange:Se,onDeleteFilter:H,onScheduleAction:Z,onSetTransfer:be,onMakeAsSplitTransaction:ie,onMakeAsNonSplitTransactions:ce}){const{t:F}=de(),[Be,ge]=d.useState(!1),[Le,We]=d.useState(!1),Ge=d.useRef(null),Fe=d.useRef(null),Ke=d.useRef(null),me=$t(),xe=In(),st=xe!=="no-server",Ye=xe==="offline",[Ne,gt]=Pe("expand-splits");let $e=!!(r?.account_id&&st);r||($e=!!p.find(ae=>!!ae.account_id)&&st);const at=!r;function ot(){n.current&&(me.dispatch({type:"switch-mode",id:n.current.getScrolledItem()}),gt(me.state.mode!=="expand"))}return le("ctrl+f, cmd+f, meta+f",()=>{Ge.current&&Ge.current.focus()},{enableOnFormTags:!0,preventDefault:!0,scopes:["app"]},[Ge]),le("t",()=>O(),{preventDefault:!0,scopes:["app"]},[O]),le("ctrl+i, cmd+i, meta+i",()=>D(),{scopes:["app"]},[D]),le("ctrl+b, cmd+b, meta+b",()=>h(),{enabled:$e&&!Ye,preventDefault:!0,scopes:["app"]},[h]),e.jsxs(e.Fragment,{children:[e.jsxs(x,{style:{...pe.pageContent,paddingBottom:10,flexShrink:0},children:[e.jsx(x,{style:{marginTop:2,marginBottom:10,alignItems:"flex-start"},children:e.jsxs(x,{style:{flexDirection:"row",alignItems:"center",gap:3},children:[!!r?.bank&&e.jsx(zo,{account:r,failedAccounts:u,accountsSyncing:l}),e.jsx(Vo,{account:r,accountName:o,isNameEditable:s,editingName:t,saveNameError:ne,onSaveName:oe,onExposeName:U})]})}),e.jsx(Wo,{balanceQuery:M,showExtraBalances:g,onToggleExtraBalances:$,account:r,isFiltered:E,filteredAmount:B}),e.jsxs(ft,{spacing:2,direction:"row",align:"center",style:{marginTop:12},children:[$e&&e.jsxs(K,{variant:"bare",onPress:h,isDisabled:Ye,children:[e.jsx(Aa,{width:13,height:13,animating:r?l.includes(r.id):l.length>0})," ",F(Ye?"Bank Sync Offline":"Bank Sync")]}),r&&!r.closed&&e.jsxs(K,{variant:"bare",onPress:D,children:[e.jsx(ro,{width:13,height:13,style:{marginRight:4}})," ",e.jsx(re,{children:"Import"})]}),!f&&e.jsxs(K,{variant:"bare",onPress:O,children:[e.jsx(Ra,{width:10,height:10,style:{marginRight:3}}),e.jsx(re,{children:"Add New"})]}),e.jsx(x,{style:{flexShrink:0},children:e.jsx(eo,{onApply:V})}),e.jsx(x,{style:{flex:1}}),e.jsx(wn,{placeholder:F("Search"),value:W,onChange:C,inputRef:Ge}),i?e.jsx(x,{children:e.jsx(Ma,{style:{width:16,height:16}})}):e.jsx(_o,{getTransaction:ae=>m.find(it=>it.id===ae),onShow:G,onDuplicate:J,onDelete:z,onEdit:he,onLinkSchedule:v,onUnlinkSchedule:L,onCreateRule:_,onSetTransfer:be,onScheduleAction:Z,showMakeTransfer:at,onMakeAsSplitTransaction:ie,onMakeAsNonSplitTransactions:ce}),e.jsx(x,{children:r&&e.jsxs(e.Fragment,{children:[e.jsx(K,{ref:Ke,variant:"bare","aria-label":F("Reconcile"),style:{padding:6,marginLeft:10},onPress:()=>{We(!0)},children:e.jsx(x,{title:F("Reconcile"),children:e.jsx(Ia,{width:14,height:14})})}),e.jsx(ve,{placement:"bottom",triggerRef:Ke,style:{width:275},isOpen:Le,onOpenChange:()=>We(!1),children:e.jsx($o,{account:r,onClose:()=>We(!1),onReconcile:P})})]})}),e.jsx(K,{variant:"bare","aria-label":me.state.mode==="collapse"?F("Collapse split transactions"):F("Expand split transactions"),isDisabled:W!==""||I.length>0,style:{padding:6},onPress:ot,children:e.jsx(x,{title:me.state.mode==="collapse"?F("Collapse split transactions"):F("Expand split transactions"),children:me.state.mode==="collapse"?e.jsx(io,{style:{width:14,height:14}}):e.jsx(oo,{style:{width:14,height:14}})})}),r?e.jsxs(x,{children:[e.jsx(cn,{"aria-label":"Account menu",ref:Fe,onPress:()=>ge(!0)}),e.jsx(ve,{triggerRef:Fe,style:{width:275},isOpen:Be,onOpenChange:()=>ge(!1),children:e.jsx(qo,{account:r,canSync:$e,canShowBalances:k(),isSorted:N,showBalances:j,showCleared:b,showReconciled:S,onMenuSelect:ae=>{ge(!1),R(ae)}})})]}):e.jsxs(x,{children:[e.jsx(cn,{"aria-label":"Account menu",ref:Fe,onPress:()=>ge(!0)}),e.jsx(ve,{triggerRef:Fe,isOpen:Be,onOpenChange:()=>ge(!1),children:e.jsx(we,{onMenuSelect:ae=>{ge(!1),R(ae)},items:[...N?[{name:"remove-sorting",text:F("Remove all sorting")}]:[],{name:"export",text:F("Export")}]})})]})]}),I?.length>0&&e.jsx(No,{conditions:I,conditionsOp:A,onUpdateFilter:te,onDeleteFilter:H,onClearFilters:ue,onReloadSavedFilter:Q,filterId:c,savedFilters:a,onConditionsOpChange:Se})]}),w!=null&&e.jsx(Go,{targetBalance:w,balanceQuery:M,onDone:Y,onCreateTransaction:q})]})}function zo({account:n,failedAccounts:t,accountsSyncing:s}){return e.jsx(x,{style:{backgroundColor:s.includes(n.id)?y.sidebarItemBackgroundPending:t.has(n.id)?y.sidebarItemBackgroundFailed:y.sidebarItemBackgroundPositive,marginRight:"4px",width:8,height:8,borderRadius:8}})}function Vo({account:n,accountName:t,isNameEditable:s,editingName:i,saveNameError:o,onSaveName:r,onExposeName:c}){const{t:a}=de();return i?e.jsxs(d.Fragment,{children:[e.jsx(Mn,{children:e.jsx(Ot,{defaultValue:t,onEnter:l=>r(l.currentTarget.value),onBlur:l=>r(l.target.value),onEscape:()=>c(!1),style:{fontSize:25,fontWeight:500,marginTop:-3,marginBottom:-4,marginLeft:-6,paddingTop:2,paddingBottom:2,width:Math.max(20,t.length)+"ch"}})}),o&&e.jsx(x,{style:{color:y.warningText},children:o})]}):s?e.jsxs(x,{style:{flexDirection:"row",alignItems:"center",gap:3,"& .hover-visible":{opacity:0,transition:"opacity .25s"},"&:hover .hover-visible":{opacity:1}},children:[e.jsx(x,{style:{fontSize:25,fontWeight:500,marginRight:5,marginBottom:-1},"data-testid":"account-name",children:n&&n.closed?a("Closed: {{ accountName }}",{accountName:t}):t}),n&&e.jsx(It,{id:`account-${n.id}`,defaultColor:y.pageTextSubdued}),e.jsx(K,{variant:"bare","aria-label":a("Edit account name"),className:"hover-visible",onPress:()=>c(!0),children:e.jsx(Da,{style:{width:11,height:11,color:y.pageTextSubdued}})})]}):e.jsx(x,{style:{fontSize:25,fontWeight:500,marginBottom:-1},"data-testid":"account-name",children:n&&n.closed?a("Closed: {{ accountName }}",{accountName:t}):t})}function qo({account:n,canSync:t,showBalances:s,canShowBalances:i,showCleared:o,showReconciled:r,isSorted:c,onMenuSelect:a}){const{t:l}=de(),u=In();return e.jsx(we,{onMenuSelect:p=>{a(p)},items:[...c?[{name:"remove-sorting",text:l("Remove all sorting")}]:[],...i?[{name:"toggle-balance",text:l(s?"Hide running balance":"Show running balance")}]:[],{name:"toggle-cleared",text:l(o?"Hide “cleared” checkboxes":"Show “cleared” checkboxes")},{name:"toggle-reconciled",text:l(r?"Hide reconciled transactions":"Show reconciled transactions")},{name:"export",text:l("Export")},...n&&!n.closed?t?[{name:"unlink",text:l("Unlink account")}]:u==="online"?[{name:"link",text:l("Link account")}]:[]:[],...n.closed?[{name:"reopen",text:l("Reopen account")}]:[{name:"close",text:l("Close account")}]]})}function rt(n){return"id"in n}function Zo({onAdd:n}){return e.jsx(x,{style:{color:y.tableText,backgroundColor:y.tableBackground,flex:1,alignItems:"center",borderTopWidth:1,borderColor:y.tableBorder},children:e.jsxs(x,{style:{width:550,marginTop:75,fontSize:15,alignItems:"center"},children:[e.jsx(se,{style:{textAlign:"center",lineHeight:"1.4em"},children:e.jsxs(re,{children:["For Actual to be useful, you need to ",e.jsx("strong",{children:"add an account"}),". You can link an account to automatically download transactions, or manage it locally yourself."]})}),e.jsx(K,{variant:"primary",style:{marginTop:20},autoFocus:!0,onPress:n,children:e.jsx(re,{children:"Add account"})}),e.jsx(x,{style:{marginTop:20,fontSize:13,color:y.tableTextLight},children:e.jsx(re,{children:"In the future, you can add accounts from the sidebar."})})]})})}function Ko({account:n,transactions:t,balances:s,showBalances:i,filtered:o,children:r,collapseTransactions:c}){const a=n?.id,l=Xa(c).map(g=>({...g,_inverse:a?a!==g.account:!1}));t??=[];let u=d.useMemo(()=>i&&s&&t?.length>0?s[t[0].id]?.balance??0:0,[i,s,t]);const p=d.useMemo(()=>{if(!i)return null;const g=[...l].reverse().map(b=>{const S=(b._inverse?-1:1)*ht(b.amount);return{balance:u+=S,id:b.id}});return Dn(g)},[i,l,u]),m=d.useMemo(()=>!o&&l.length>0?l.concat(t):t,[o,l,t]),j=d.useMemo(()=>!o&&p&&s?{...p,...s}:s,[o,p,s]);return l?r(m,j):r(t,s)}function hn(n){if(!n)return"date";switch(n){case"account":return"account.name";case"payee":return"payee.name";case"category":return"category.name";case"payment":return"amount";case"deposit":return"amount";default:return n}}class Yo extends d.PureComponent{paged;rootQuery;currentQuery;table;unlisten;dispatchSelected;constructor(t){super(t),this.paged=null,this.table=d.createRef(),this.state={search:"",filterConditions:t.filterConditions||[],filterId:void 0,filterConditionsOp:"and",loading:!0,workingHard:!1,reconcileAmount:null,transactions:[],transactionCount:0,showBalances:t.showBalances,balances:null,showCleared:t.showCleared,showReconciled:t.showReconciled,editingName:!1,nameError:"",isAdding:!1,sort:null,filteredAmount:null}}async componentDidMount(){const t=o=>{if(o.includes("transactions")||o.includes("category_mapping")||o.includes("payee_mapping"))return this.refetchTransactions()},s=async({tables:o,messages:r})=>{await t(o);let c;if(r.every(a=>a.dataset==="transactions")&&!r.find(a=>a.column==="tombstone")){const a=r.filter(l=>l.dataset==="transactions"&&l.column!=="tombstone");c=a.length===1?a[0].row:null}this.table.current&&(this.table.current.edit(null),c&&this.table.current.scrollTo(c)),this.props.setLastUndoState(null)},i=[vt("undo-event",s)];this.unlisten=()=>{i.forEach(o=>o())},await this.props.initiallyLoadPayees(),await this.fetchTransactions(this.state.filterConditions),this.props.lastUndoState&&this.props.lastUndoState.current&&s(this.props.lastUndoState.current)}componentDidUpdate(t){this.state.isAdding&&this.props.accountId!==t.accountId&&this.setState({isAdding:!1}),t.modalShowing&&!this.props.modalShowing&&setTimeout(()=>{this.refetchTransactions()},100),this.props.accountId!==t.accountId&&this.setState({sort:null,search:"",filterConditions:[]})}componentWillUnmount(){this.unlisten&&this.unlisten(),this.paged&&this.paged.unsubscribe()}fetchAllIds=async()=>{const{data:t}=await je(this.paged?.getQuery().select("id"));return t.reduce((s,i)=>(s.push(i.id),i.subtransactions?.forEach(o=>s.push(o.id)),s),[])};refetchTransactions=async()=>{this.paged?.run()};fetchTransactions=t=>{const s=this.makeRootQuery();this.rootQuery=this.currentQuery=s,t?this.applyFilters(t):this.updateQuery(s),this.props.accountId&&this.props.markAccountRead(this.props.accountId)};makeRootQuery=()=>{const t=this.props.accountId;return Wa(t)};updateQuery(t,s=!1){this.paged&&this.paged.unsubscribe(),!this.state.showReconciled&&(!this.state.showBalances||!this.canCalculateBalance())&&(t=t.filter({reconciled:{$eq:!1}})),this.paged=Ga(t.select("*"),async(i,o)=>{const r=o==null;r&&(this.table.current?.setRowAnimation(!1),s?this.props.splitsExpandedDispatch({type:"set-mode",mode:"collapse"}):this.props.splitsExpandedDispatch({type:"set-mode",mode:this.props.expandSplits?"expand":"collapse"})),this.setState({transactions:i,transactionCount:this.paged?.getTotalCount(),transactionsFiltered:s,loading:!1,workingHard:!1,balances:this.state.showBalances?await this.calculateBalances():null,filteredAmount:await this.getFilteredAmount()},()=>{r&&this.table.current?.scrollToTop(),setTimeout(()=>{this.table.current?.setRowAnimation(!0)},0)})},{pageCount:150,onlySync:!0,mapper:ze})}UNSAFE_componentWillReceiveProps(t){this.props.accountId!==t.accountId&&this.setState({editingName:!1,loading:!0,search:"",showBalances:t.showBalances,balances:null,showCleared:t.showCleared,showReconciled:t.showReconciled,reconcileAmount:null},()=>{this.fetchTransactions()})}onSearch=t=>{this.paged?.unsubscribe(),this.setState({search:t},this.onSearchDone)};onSearchDone=$a.debounce(()=>{this.state.search===""?this.updateQuery(this.currentQuery,this.state.filterConditions.length>0):this.updateQuery(Qa(this.currentQuery,this.state.search,this.props.dateFormat),!0)},150);onSync=async()=>{const t=this.props.accountId,s=this.props.accounts.find(i=>i.id===t);await this.props.syncAndDownload(s?s.id:void 0)};onImport=async()=>{const t=this.props.accountId,s=this.props.accounts.find(o=>o.id===t),i=await this.props.getCategories();if(s){const o=await window.Actual?.openFileDialog({filters:[{name:Me("Financial Files"),extensions:["qif","ofx","qfx","csv","tsv","xml"]}]});o&&this.props.pushModal("import-transactions",{accountId:t,categories:i,filename:o[0],onImported:r=>{r&&this.fetchTransactions()}})}};onExport=async t=>{const s=await X("transactions-export-query",{query:this.currentQuery.serialize()}),o=`${t&&t.replace(/[()]/g,"").replace(/\s+/g,"-")||"transactions"}.csv`;window.Actual?.saveFile(s,o,Me("Export Transactions"))};onTransactionsChange=(t,s)=>{this.paged?.optimisticUpdate(i=>t._deleted?i.filter(o=>o.id!==t.id):i.map(o=>o.id===t.id?t:o),()=>s),this.props.updateNewTransactions(t.id)};canCalculateBalance=()=>{const t=this.props.accountId;return this.props.accounts.find(i=>i.id===t)&&this.state.search===""&&this.state.filterConditions.length===0&&(this.state.sort===null||this.state.sort.field==="date"&&this.state.sort.ascDesc==="desc")};async calculateBalances(){if(!this.canCalculateBalance())return null;const{data:t}=await je(this.paged?.getQuery().options({splits:"none"}).select([{balance:{$sumOver:"$amount"}}]));return Dn(t)}onAddTransaction=()=>{this.setState({isAdding:!0})};onExposeName=t=>{this.setState({editingName:t})};onSaveName=t=>{const s=za(t,this.props.accountId,this.props.accounts);if(s)this.setState({nameError:s});else{const i=this.props.accounts.find(o=>o.id===this.props.accountId);this.props.updateAccount({...i,name:t}),this.setState({editingName:!1,nameError:""})}};onToggleExtraBalances=()=>{this.props.setShowExtraBalances(!this.props.showExtraBalances)};onMenuSelect=async t=>{const s=this.props.accountId,i=this.props.accounts.find(o=>o.id===s);switch(t){case"link":this.props.pushModal("add-account",{upgradingAccountId:s});break;case"unlink":this.props.pushModal("confirm-unlink-account",{accountName:i.name,onUnlink:()=>{this.props.unlinkAccount(s)}});break;case"close":this.props.openAccountCloseModal(s);break;case"reopen":this.props.reopenAccount(s);break;case"export":const o=this.getAccountTitle(i,s);this.onExport(o);break;case"toggle-balance":this.state.showBalances?(this.props.setShowBalances(!1),this.setState({showBalances:!1,balances:null})):(this.props.setShowBalances(!0),this.setState({transactions:[],transactionCount:0,filterConditions:[],search:"",sort:null,showBalances:!0},()=>{this.fetchTransactions()}));break;case"remove-sorting":{this.setState({sort:null},()=>{const r=this.state.filterConditions;r.length>0?this.applyFilters([...r]):this.fetchTransactions(),this.state.search!==""&&this.onSearch(this.state.search)});break}case"toggle-cleared":this.state.showCleared?(this.props.setShowCleared(!1),this.setState({showCleared:!1})):(this.props.setShowCleared(!0),this.setState({showCleared:!0}));break;case"toggle-reconciled":this.state.showReconciled?(this.props.setShowReconciled(!1),this.setState({showReconciled:!1},()=>this.fetchTransactions(this.state.filterConditions))):(this.props.setShowReconciled(!0),this.setState({showReconciled:!0},()=>this.fetchTransactions(this.state.filterConditions)));break}};getAccountTitle(t,s){const{filterName:i}=this.props.location.state||{};return i||(t?t.name:s==="budgeted"?Me("Budgeted Accounts"):s==="offbudget"?Me("Off Budget Accounts"):s==="uncategorized"?Me("Uncategorized"):s?null:Me("All Accounts"))}getBalanceQuery(t){return{name:`balance-query-${t}`,query:this.makeRootQuery().calculate({$sum:"$amount"})}}getFilteredAmount=async()=>{const{data:t}=await je(this.paged?.getQuery().calculate({$sum:"$amount"}));return t};isNew=t=>this.props.newTransactions.includes(t);isMatched=t=>this.props.matchedTransactions.includes(t);onCreatePayee=t=>t.trim()!==""?this.props.createPayee(t):null;lockTransactions=async()=>{this.setState({workingHard:!0});const{accountId:t}=this.props,{data:s}=await je(ke("transactions").filter({cleared:!0,reconciled:!1,account:t}).select("*").options({splits:"grouped"}));let i=ze(s);const o={updated:[]};i.forEach(r=>{const{diff:c}=Nt(i,{...r,reconciled:!0});i=Rn(c,i),o.updated=o.updated?o.updated.concat(c.updated):c.updated}),await X("transactions-batch-update",o),await this.refetchTransactions()};onReconcile=async t=>{this.setState(({showCleared:s})=>({reconcileAmount:t,showCleared:!0,prevShowCleared:s}))};onDoneReconciling=async()=>{const{accountId:t}=this.props,{reconcileAmount:s}=this.state,{data:i}=await je(ke("transactions").filter({cleared:!0,account:t}).select("*").options({splits:"grouped"})),o=ze(i);let r=0;o.forEach(a=>{a.is_parent||(r+=a.amount)}),(s||0)-r===0&&await this.lockTransactions(),this.setState({reconcileAmount:null,showCleared:this.state.prevShowCleared})};onCreateReconciliationTransaction=async t=>{const s=An([{id:"temp",account:this.props.accountId,cleared:!0,reconciled:!1,amount:t,date:_t(),notes:Me("Reconciliation balance adjustment")}]);this.setState({transactions:[...s,...this.state.transactions]});const i=await Promise.all(s.map(o=>X("rules-run",{transaction:o})));await X("transactions-batch-update",{added:i}),await this.refetchTransactions()};onShowTransactions=async t=>{this.onApplyFilter({customName:Me("Selected transactions"),queryFilter:{id:{$oneof:t}}})};onBatchEdit=(t,s)=>{this.props.onBatchEdit({name:t,ids:s,onSuccess:i=>{this.refetchTransactions(),this.table.current&&this.table.current.edit(i[0],"select",!1)}})};onBatchDuplicate=t=>{this.props.onBatchDuplicate({ids:t,onSuccess:this.refetchTransactions})};onBatchDelete=t=>{this.props.onBatchDelete({ids:t,onSuccess:this.refetchTransactions})};onMakeAsSplitTransaction=async t=>{this.setState({workingHard:!0});const{data:s}=await je(ke("transactions").filter({id:{$oneof:t}}).select("*").options({splits:"none"})),i=s;if(!i||i.length===0)return;const[o]=i,r={id:Va(),is_parent:!0,cleared:i.every(a=>!!a.cleared),date:o.date,account:o.account,amount:i.map(a=>a.amount).reduce((a,l)=>a+l,0)},c=i.map(a=>qa(r,a));await X("transactions-batch-update",{added:[r],updated:c}),this.refetchTransactions()};onMakeAsNonSplitTransactions=async t=>{this.setState({workingHard:!0});const{data:s}=await je(ke("transactions").filter({id:{$oneof:t}}).select("*").options({splits:"grouped"})),i=s;let o={updated:[],deleted:[]};const r=i.filter(a=>a.is_parent);for(const a of r){const l=Za(a),[u,...p]=l;if(t.includes(u.id)){const g=rn(p,l);o={updated:[...o.updated,...g.updated],deleted:[...o.deleted,...g.deleted]};continue}const m=p.filter(g=>t.includes(g.id));if(m.length===0)continue;const j=rn(m,l);o={updated:[...o.updated,...j.updated],deleted:[...o.deleted,...j.deleted]}}await X("transactions-batch-update",o),this.refetchTransactions();const c=o.updated.map(a=>a.id);this.dispatchSelected?.({type:"select-all",ids:c})};checkForReconciledTransactions=async(t,s,i)=>{const{data:o}=await je(ke("transactions").filter({id:{$oneof:t},reconciled:!0}).select("*").options({splits:"grouped"}));ze(o).length>0?this.props.pushModal("confirm-transaction-edit",{onConfirm:()=>{i(t)},confirmReason:s}):i(t)};onBatchLinkSchedule=t=>{this.props.onBatchLinkSchedule({ids:t,account:this.props.accounts.find(s=>s.id===this.props.accountId),onSuccess:this.refetchTransactions})};onBatchUnlinkSchedule=t=>{this.props.onBatchUnlinkSchedule({ids:t,onSuccess:this.refetchTransactions})};onCreateRule=async t=>{const{data:s}=await je(ke("transactions").filter({id:{$oneof:t}}).select("*").options({splits:"grouped"})),i=ze(s),o=i[0],r=i.filter(u=>u.parent_id===o.id),c=o.imported_payee?{field:"imported_payee",op:"is",value:o.imported_payee,type:"string"}:{field:"payee",op:"is",value:o.payee,type:"id"},a={field:"amount",op:"isapprox",value:o.amount,type:"number"},l={stage:null,conditionsOp:"and",conditions:[c,a],actions:[...r.length===0?[{op:"set",field:"category",value:o.category,type:"id",options:{splitIndex:0}}]:[],...r.flatMap((u,p)=>[{op:"set-split-amount",value:u.amount,options:{splitIndex:p+1,method:"fixed-amount"}},{op:"set",field:"category",value:u.category,type:"id",options:{splitIndex:p+1}}])]};this.props.pushModal("edit-rule",{rule:l})};onSetTransfer=async t=>{const s=async i=>{this.setState({workingHard:!0});const o=await this.props.getPayees(),{data:r}=await je(ke("transactions").filter({id:{$oneof:i}}).select("*")),[c,a]=r;if(r.length===2&&_n(c,a)){const l=o.find(m=>m.transfer_acct===c.account),u=o.find(m=>m.transfer_acct===a.account),p={updated:[{...c,payee:u?.id,transfer_id:a.id},{...a,payee:l?.id,transfer_id:c.id}]};await X("transactions-batch-update",p)}await this.refetchTransactions()};await this.checkForReconciledTransactions(t,"batchEditWithReconciled",s)};onConditionsOpChange=t=>{this.setState({filterConditionsOp:t}),this.setState({filterId:{...this.state.filterId,status:"changed"}}),this.applyFilters([...this.state.filterConditions]),this.state.search!==""&&this.onSearch(this.state.search)};onReloadSavedFilter=(t,s)=>{if(s==="reload"){const[i]=this.props.savedFilters.filter(o=>o.id===this.state.filterId?.id);this.setState({filterConditionsOp:i.conditionsOp??"and"}),this.applyFilters([...i.conditions])}else t.status&&(this.setState({filterConditionsOp:t.conditionsOp??"and"}),this.applyFilters([...t.conditions]));this.setState({filterId:{...this.state.filterId,...t}})};onClearFilters=()=>{this.setState({filterConditionsOp:"and"}),this.setState({filterId:void 0}),this.applyFilters([]),this.state.search!==""&&this.onSearch(this.state.search)};onUpdateFilter=(t,s)=>{this.applyFilters(this.state.filterConditions.map(i=>i===t?s:i)),this.setState({filterId:{...this.state.filterId,status:this.state.filterId&&"changed"}}),this.state.search!==""&&this.onSearch(this.state.search)};onDeleteFilter=t=>{this.applyFilters(this.state.filterConditions.filter(s=>s!==t)),this.state.filterConditions.length===1?(this.setState({filterId:void 0}),this.setState({filterConditionsOp:"and"})):this.setState({filterId:{...this.state.filterId,status:this.state.filterId&&"changed"}}),this.state.search!==""&&this.onSearch(this.state.search)};onApplyFilter=async t=>{let s=this.state.filterConditions;if("customName"in t&&t.customName&&(s=s.filter(i=>!rt(i)&&i.customName!==t.customName)),rt(t)){const i=t;this.setState({filterId:{...i,status:"saved"}}),this.setState({filterConditionsOp:i.conditionsOp}),this.applyFilters([...i.conditions])}else{const i=t;this.setState({filterId:{...this.state.filterId,status:this.state.filterId&&"changed"}}),this.applyFilters([...s,i])}this.state.search!==""&&this.onSearch(this.state.search)};onScheduleAction=async(t,s)=>{switch(t){case"post-transaction":for(const i of s){const o=i.split("/");await X("schedule/post-transaction",{id:o[1]})}this.refetchTransactions();break;case"skip":for(const i of s){const o=i.split("/");await X("schedule/skip-next-date",{id:o[1]})}break}};applyFilters=async t=>{if(t.length>0){const i=t.filter(c=>!rt(c)).map(c=>c.queryFilter),{filters:o}=await X("make-filters-from-conditions",{conditions:t.filter(c=>rt(c)||!c.customName)}),r=this.state.filterConditionsOp==="or"?"$or":"$and";this.currentQuery=this.rootQuery.filter({[r]:[...o,...i]}),this.setState({filterConditions:t},()=>{this.updateQuery(this.currentQuery,!0)})}else this.setState({transactions:[],transactionCount:0,filterConditions:t},()=>{this.fetchTransactions()});this.state.sort!==null&&this.applySort()};applySort=(t,s,i,o)=>{const r=this.state.filterConditions,c=r.length>0,a=hn(t||this.state.sort?.field),l=s||this.state.sort?.ascDesc,u=hn(i||this.state.sort?.prevField),p=i?o:this.state.sort?.prevAscDesc,m=function(b,S,f){S==="cleared"&&(b.currentQuery=b.currentQuery.orderBy({reconciled:f})),b.currentQuery=b.currentQuery.orderBy({[S]:f})},j=function(b,S,f){S==="cleared"?(b.currentQuery=b.rootQuery.orderBy({reconciled:f}),b.currentQuery=b.currentQuery.orderBy({cleared:f})):b.currentQuery=b.rootQuery.orderBy({[S]:f})},g=function(b,S,f){S&&(S==="cleared"&&(b.currentQuery=b.currentQuery.orderBy({reconciled:f})),b.currentQuery=b.currentQuery.orderBy({[S]:f}))};switch(!0){case!t:m(this,a,l);break;case c:this.applyFilters([...r]),m(this,a,l);break;case!c:j(this,a,l);break}g(this,u,p),this.updateQuery(this.currentQuery,c)};onSort=(t,s)=>{let i,o;t===this.state.sort?.field?(i=this.state.sort.prevField,o=this.state.sort.prevAscDesc,this.setState({sort:{...this.state.sort,ascDesc:s}})):(i=this.state.sort?.field,o=this.state.sort?.ascDesc,this.setState({sort:{field:t,ascDesc:s,prevField:this.state.sort?.field,prevAscDesc:this.state.sort?.ascDesc}})),this.applySort(t,s,i,o),this.state.search!==""&&this.onSearch(this.state.search)};render(){const{accounts:t,categoryGroups:s,payees:i,dateFormat:o,hideFraction:r,addNotification:c,accountsSyncing:a,failedAccounts:l,replaceModal:u,showExtraBalances:p,accountId:m,categoryId:j}=this.props,{transactions:g,loading:b,workingHard:S,filterId:f,reconcileAmount:M,transactionsFiltered:w,editingName:k,showBalances:E,balances:B,showCleared:N,showReconciled:W,filteredAmount:I}=this.state,A=t.find($=>$.id===m),C=this.getAccountTitle(A,m);if(!C&&!b)return e.jsx(Ka,{to:"/accounts",replace:!0});const O=s.flatMap($=>$.categories).find($=>$?.id===j),G=!b&&!m&&t.length===0,Y=m&&m!=="budgeted"&&m!=="offbudget"&&m!=="uncategorized",q=this.getBalanceQuery(m);return e.jsx(Ko,{account:A,transactions:g,balances:B,showBalances:E,filtered:w,collapseTransactions:$=>this.props.splitsExpandedDispatch({type:"close-splits",ids:$}),children:($,oe)=>e.jsx(Ya,{name:"transactions",items:$,fetchAllIds:this.fetchAllIds,registerDispatch:ne=>this.dispatchSelected=ne,selectAllFilter:ne=>!ne._unmatched&&!ne.is_parent,children:e.jsxs(x,{style:pe.page,children:[e.jsx(Qo,{tableRef:this.table,editingName:k,isNameEditable:Y,workingHard:S,account:A,filterId:f,savedFilters:this.props.savedFilters,accountName:C,accountsSyncing:a,failedAccounts:l,accounts:t,transactions:g,showBalances:E,showExtraBalances:p,showCleared:N,showReconciled:W,showEmptyMessage:G,balanceQuery:q,canCalculateBalance:this.canCalculateBalance,filteredAmount:I,isFiltered:w,isSorted:this.state.sort!==null,reconcileAmount:M,search:this.state.search,filterConditions:this.state.filterConditions,filterConditionsOp:this.state.filterConditionsOp,onSearch:this.onSearch,onShowTransactions:this.onShowTransactions,onMenuSelect:this.onMenuSelect,onAddTransaction:this.onAddTransaction,onToggleExtraBalances:this.onToggleExtraBalances,onSaveName:this.onSaveName,saveNameError:this.state.nameError,onExposeName:this.onExposeName,onReconcile:this.onReconcile,onDoneReconciling:this.onDoneReconciling,onCreateReconciliationTransaction:this.onCreateReconciliationTransaction,onSync:this.onSync,onImport:this.onImport,onBatchDelete:this.onBatchDelete,onBatchDuplicate:this.onBatchDuplicate,onBatchEdit:this.onBatchEdit,onBatchLinkSchedule:this.onBatchLinkSchedule,onBatchUnlinkSchedule:this.onBatchUnlinkSchedule,onCreateRule:this.onCreateRule,onUpdateFilter:this.onUpdateFilter,onClearFilters:this.onClearFilters,onReloadSavedFilter:this.onReloadSavedFilter,onConditionsOpChange:this.onConditionsOpChange,onDeleteFilter:this.onDeleteFilter,onApplyFilter:this.onApplyFilter,onScheduleAction:this.onScheduleAction,onSetTransfer:this.onSetTransfer,onMakeAsSplitTransaction:this.onMakeAsSplitTransaction,onMakeAsNonSplitTransactions:this.onMakeAsNonSplitTransactions}),e.jsx(x,{style:{flex:1},children:e.jsx(Po,{headerContent:void 0,tableRef:this.table,account:A,transactions:g,allTransactions:$,loadMoreTransactions:()=>this.paged&&this.paged.fetchNext(),accounts:t,category:O,categoryGroups:s,payees:i,balances:oe,showBalances:!!oe,showReconciled:W,showCleared:N,showAccount:!m||m==="offbudget"||m==="budgeted"||m==="uncategorized",isAdding:this.state.isAdding,isNew:this.isNew,isMatched:this.isMatched,isFiltered:w,dateFormat:o,hideFraction:r,addNotification:c,renderEmpty:()=>G?e.jsx(Zo,{onAdd:()=>u("add-account")}):b?null:e.jsx(x,{style:{color:y.tableText,marginTop:20,textAlign:"center",fontStyle:"italic"},children:"No transactions"}),onSort:this.onSort,sortField:this.state.sort?.field,ascDesc:this.state.sort?.ascDesc,onChange:this.onTransactionsChange,onBatchDelete:this.onBatchDelete,onBatchDuplicate:this.onBatchDuplicate,onBatchLinkSchedule:this.onBatchLinkSchedule,onBatchUnlinkSchedule:this.onBatchUnlinkSchedule,onCreateRule:this.onCreateRule,onScheduleAction:this.onScheduleAction,onMakeAsNonSplitTransactions:this.onMakeAsNonSplitTransactions,onRefetch:this.refetchTransactions,onCloseAddTransaction:()=>this.setState({isAdding:!1}),onCreatePayee:this.onCreatePayee,onApplyFilter:this.onApplyFilter})})]})})})}}function Xo(n){const{dispatch:t}=$t(),{onBatchEdit:s,onBatchDuplicate:i,onBatchLinkSchedule:o,onBatchUnlinkSchedule:r,onBatchDelete:c}=Ua();return e.jsx(Yo,{splitsExpandedDispatch:t,onBatchEdit:s,onBatchDuplicate:i,onBatchLinkSchedule:o,onBatchUnlinkSchedule:r,onBatchDelete:c,...n})}function oi(){const n=Pa(),t=Et(),{grouped:s}=Pt(),i=Qe(C=>C.queries.newTransactions),o=Qe(C=>C.queries.matchedTransactions),r=Ea(),c=La(),a=Fa(),l=Na()||"MM/dd/yyyy",[u]=He("hideFraction"),[p]=Pe("expand-splits"),[m,j]=He(`show-balances-${n.id}`),[g,b]=He(`hide-cleared-${n.id}`),[S,f]=He(`hide-reconciled-${n.id}`),[M,w]=He(`show-extra-balances-${n.id||"all-accounts"}`),k=Qe(C=>C.modals.modalStack.length>0),E=Qe(C=>C.account.accountsSyncing),B=Qe(C=>C.app.lastUndoState),N=t?.state?.filterConditions||[],W=_a(),I=bn(),A=Ha(n.id);return e.jsx(Oa,{transform:A,children:e.jsx(vo,{initialMode:p?"collapse":"expand",children:e.jsx(Xo,{newTransactions:i,matchedTransactions:o,accounts:r,failedAccounts:a,dateFormat:l,hideFraction:String(u)==="true",expandSplits:p,showBalances:String(m)==="true",setShowBalances:C=>j(String(C)),showCleared:String(g)!=="true",setShowCleared:C=>b(String(!C)),showReconciled:String(S)!=="true",setShowReconciled:C=>f(String(!C)),showExtraBalances:String(M)==="true",setShowExtraBalances:C=>w(String(C)),payees:c,modalShowing:k,accountsSyncing:E,lastUndoState:B,filterConditions:N,categoryGroups:s,...I,accountId:n.id,categoryId:t?.state?.categoryId,location:t,savedFilters:W})})})}export{oi as Account,oi as Accounts,ni as Budget,ai as GoCardlessLink,si as Schedules};
//# sourceMappingURL=wide.0faEkZXm.chunk.js.map
